<properties
 pageTitle="Высокий уровень доступности и аварийное восстановление центра IoT | Microsoft Azure"
 description="В статье описывается ряд возможностей для создания высокодоступных решений IoT с функциями аварийного восстановления."
 services="iot-hub"
 documentationCenter=""
 authors="fsautomata"
 manager="timlt"
 editor=""/>

<tags
 ms.service="iot-hub"
 ms.devlang="na"
 ms.topic="article"
 ms.tgt_pltfrm="na"
 ms.workload="na"
 ms.date="02/03/2016"
 ms.author="elioda"/>

# Высокая доступность и аварийное восстановление центра IoT

Будучи службой Azure, центр IoT отличается высоким уровнем доступности, который достигается за счет использования избыточности в одном регионе Azure. При этом к решению не выдвигаются никакие дополнительные требования. Кроме того, Azure предоставляет ряд возможностей для создания решений с функциями аварийного восстановления или межрегиональной доступностью. Используйте эти функции при разработке и подготовке решений, чтобы обеспечивать глобальную, межрегиональную высокую доступность для устройств или пользователей. В [техническом руководстве по непрерывности бизнес-процессов для Azure](../resiliency/resiliency-technical-guidance.md) описаны встроенные функции Azure, которые позволяют обеспечить непрерывность бизнес-процессов и возможности аварийного восстановления. В статье [Аварийное восстановление и высокая доступность для приложений на платформе Azure][] содержатся требования к архитектуре, которая позволяет обеспечить высокий уровень доступности приложений Azure и реализовать для них возможности аварийного восстановления.

## Аварийное восстановление центра IoT Azure
В дополнение к обеспечению высокой доступности внутри регионов центр IoT реализует механизмы отказоустойчивости для аварийного восстановления, которые не требуют вмешательства пользователя. Аварийное восстановление центра IoT является самоинициируемым, целевое время восстановления (RTO) составляет от 2 до 26 часов, и доступны следующие целевые точки восстановления (RPO).

| Функции | RPO |
| ------------- | --- |
| Доступность службы для операций с реестром и операций взаимодействия | Возможна потеря записи CName |
| Данные удостоверений в реестре удостоверений устройства | Потеря 0–5 мин данных |
| Отправка сообщений с устройства в облако | Теряются все непрочитанные сообщения |
| Отправка сообщений о мониторинге операций | Теряются все непрочитанные сообщения |
| Получение сообщений из облака на устройство | Потеря 0–5 мин данных |
| Очередь отзывов из облака на устройство | Теряются все непрочитанные сообщения |

## Отработка отказа между регионами с помощью центра IoT

Полное освещение топологий развертывания в решениях IoT выходит за рамки этой статьи, но чтобы раскрыть тему высокого уровня доступности и аварийного восстановления, мы рассмотрим модель развертывания с *отработкой отказа между регионами*.

В модели с отработкой отказа между регионами серверная часть решения работает преимущественно в одном центре обработки данных. Чтобы реализовать возможности отработки отказа, еще один центр IoT и еще одна серверная часть развертываются в другом ЦОД в другом регионе. Если в основном ЦОД произойдет сбой или подключение устройства к основному ЦОД по какой-то причине будет нарушено, будут задействованы резервные ресурсы. Устройства используют дополнительную конечную точку службы всякий раз, когда основной шлюз недоступен. Использование дополнительного региона при отработках отказов позволяет еще больше повысить уровень доступности решения.

Если говорить в общем, то чтобы реализовать модель с отработкой отказа между регионами, вам потребуется следующее.

* **Дополнительный центр IoT и логика маршрутизации устройств**. В случае нарушения работы службы в основном регионе устройства должны подключаться к дополнительному региону. Учитывая, что состояние большинства задействованных служб отслеживается, чаще всего процесс отработки отказа между регионами активируют администраторы решений. Лучший способ сообщить устройствам новую конечную точку и сохранить контроль над процессом — заставить устройства регулярно получать из *дежурной* службы текущую активную конечную точку. Дежурной службой может быть простое реплицируемое веб-приложение, доступность которого обеспечивается посредством перенаправления DNS-трафика (например, с помощью [диспетчера трафика Azure][]).
* **Репликация реестра удостоверений**. Дополнительный центр IoT будет работоспособен только в том случае, если в нем будут все удостоверения устройств и эти удостоверения смогут подключаться к решению. Решение должно хранить геореплицированные резервные копии удостоверений устройств и передавать их в дополнительный центр IoT до перевода устройств на другую конечную точку. В этом случае вам очень пригодится функция центра IoT для экспорта удостоверений. Дополнительные сведения см. в [руководстве для разработчиков центра IoT в разделе «Реестр удостоверений устройств»][].
* **Логика объединения**. Когда основной регион снова станет доступным, все состояния и данные, которые были созданы в дополнительном регионе, необходимо перенести обратно в основной. Это главным образом относится к удостоверениям устройств и метаданным приложений, которые необходимо добавить в основной центр IoT и, вероятно, другие хранилища приложений в основном регионе. Чтобы упростить эту процедуру, обычно рекомендуется использовать идемпотентные операции. Это сводит к минимуму количество побочных эффектов не только от итогового согласованного распределения событий, но и от дублирования данных или беспорядочной доставки событий. Кроме того, логику приложения необходимо спроектировать таким образом, чтобы потенциальные несоответствия или незначительно устаревшие состояния считались допустимыми. Это связано как с целевыми точками восстановления (RPO), так и с тем, что восстановление системы требует времени.

## Дальнейшие действия

Дополнительные сведения о центре IoT в Azure см. по следующим ссылкам:

- [Приступая к работе с центрами IoT (руководство)][lnk-get-started]
- [Что такое центр IoT в Azure?][]

[Azure resiliency technical guidance]: ../resiliency/resiliency-technical-guidance.md
[Аварийное восстановление и высокая доступность для приложений на платформе Azure]: ../resiliency/resiliency-disaster-recovery-high-availability-azure-applications.md
[Failsafe: Guidance for Resilient Cloud Architectures]: https://msdn.microsoft.com/library/azure/jj853352.aspx
[диспетчера трафика Azure]: https://azure.microsoft.com/documentation/services/traffic-manager/
[руководстве для разработчиков центра IoT в разделе «Реестр удостоверений устройств»]: iot-hub-devguide.md#identityregistry

[lnk-get-started]: iot-hub-csharp-csharp-getstarted.md
[Что такое центр IoT в Azure?]: iot-hub-what-is-iot-hub.md

<!---HONumber=AcomDC_0921_2016-->