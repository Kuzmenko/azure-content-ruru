<properties 
   pageTitle="Обзор Automation DSC Azure | Microsoft Azure" 
   description="Обзор DSC службы автоматизации Azure, условий использования и известных проблем" 
   services="automation" 
   documentationCenter="dev-center-name" 
   authors="coreyp-at-msft" 
   manager="stevenka" 
   editor="tysonn"
   keywords="PowerShell DSC, настройка требуемого состояния, PowerShell DSC для Azure"/>

<tags
   ms.service="automation"
   ms.devlang="NA"
   ms.topic="article"
   ms.tgt_pltfrm="powershell"
   ms.workload="TBD" 
   ms.date="05/10/2016"
   ms.author="magoedte;coreyp"/>

# Обзор DSC службы автоматизации Azure #

##Что такое DSC службы автоматизации Azure?##
Развертывание серверов и ресурсов приложения в требуемом состоянии, а также поддержание этого состояния может занять много времени и сопровождаться ошибками. С помощью DSC службы автоматизации Azure вы можете последовательно развернуть все ИТ-ресурсы в требуемом состоянии, безопасно осуществлять их мониторинг и автоматически обновлять в масштабе облака. Созданная на основе PowerShell DSC, Automation DSC позволяет развернуть конфигурацию желаемого состояния в физической или виртуальной машине под управлением Windows или Linux как в облачной, так и в локальной среде. При необходимости вы можете непрерывно предоставлять ИТ-услуги с согласованным контролем и быстрым управлением изменениями в разнородных гибридных ИТ-средах.

В основе DSC службы автоматизации Azure заложены основополагающие принципы, представленные в PowerShell DSC и призванные еще больше упростить управление конфигурацией. Azure Automation DSC обеспечивает тот же слой управления для [настройки требуемого состояния PowerShell](https://msdn.microsoft.com/powershell/dsc/overview), что и служба автоматизации Azure сегодня предлагает для сценариев PowerShell.

DSC службы автоматизации Azure позволяет [создавать конфигурации требуемого состояния PowerShell и управлять ими](https://technet.microsoft.com/library/dn249918.aspx), импортировать [ресурсы DSC](https://technet.microsoft.com/library/dn282125.aspx) и создавать конфигурации узлов DSC (документы MOF), и все это в облаке. Эти элементы DSC будут помещаться на [опрашивающий сервер DSC](https://technet.microsoft.com/library/dn249913.aspx) службы автоматизации Azure, чтобы целевые узлы (например, физические компьютеры и виртуальные машины) в облаке или локальной среде могли извлекать их, автоматически согласовывать с указанным требуемым состоянием и сообщать службе автоматизации Azure об их соответствии требуемому состоянию.

Предпочитаете смотреть, а не читать? Посмотрите указанный ниже видеоролик, выпущенный в мае 2015 г., когда впервые было объявлено об Automation DSC Azure. **Примечание.** Несмотря на то что основные концепции и жизненный цикл, о которых рассказывается в этом видеоролике, по-прежнему актуальны, с момента записи этого видеоролика Automation DSC Azure сделала большой шаг вперед. Теперь она стала общедоступной, оснащена более функциональным пользовательским интерфейсом на портале Azure и поддерживает множество дополнительных возможностей.

> [AZURE.VIDEO microsoft-ignite-2015-heterogeneous-configuration-management-using-microsoft-azure-automation]



## Терминология DSC службы автоматизации Azure ##
### Конфигурация ###
В PowerShell DSC появилась новая концепция — конфигурации. Конфигурации позволяют с помощью синтаксиса PowerShell определить требуемое состояние среды. Чтобы использовать DSC для настройки среды, сначала определите блок сценария Windows PowerShell с помощью ключевого слова configuration, затем укажите идентификатор и фигурные скобки ({}) для отделения блока.

![замещающий текст](./media/automation-dsc-overview/AADSC_1.png)

Внутри блока конфигурации можно определить блоки конфигурации узлов, задающие требуемую конфигурацию для набора узлов (компьютеров) в вашей среде, которые должны быть настроены совершенно одинаково. Таким образом конфигурация узла представляет предполагаемую "роль" для одного или нескольких узлов. Блок конфигурации узла начинается с ключевого слова node. После него указывается ключевое слово с именем роли, которая может быть переменной или выражением. После имени роли добавьте фигурные скобки {}, чтобы отделить блок конфигурации узла.

![замещающий текст](./media/automation-dsc-overview/AADSC_2.png)
 
Внутри блока конфигурации узла можно определить блоки ресурсов для настройки определенных ресурсов DSC. Блок ресурсов начинается с имени ресурса, затем идет идентификатор, которым вы хотите обозначить этот блок, и фигурные скобки {}, отделяющие блок.

![замещающий текст](./media/automation-dsc-overview/AADSC_3.png)

Дополнительная информация о ключевом слове configuration: [Общие сведения о ключевом слове Configuration в конфигурации требуемого состояния](http://blogs.msdn.com/b/powershell/archive/2013/11/05/understanding-configuration-keyword-in-desired-state-configuration.aspx "Общие сведения о ключевом слове Configuration в конфигурации требуемого состояния").

Выполнение (компиляция) конфигурации DSC создаст одну или несколько конфигураций узлов DSC (документов MOF), соответствующих узлам DSC, которые должны соответствовать желаемому состоянию.

DSC службы автоматизации Azure позволяет импортировать, создавать и компилировать конфигурации DSC в службе автоматизации Azure точно так же, как можно в ней импортировать, создавать и запускать модули Runbook.

>[AZURE.IMPORTANT] Конфигурация должна содержать только один блок конфигурации с тем же именем, что и конфигурация в DSC службы автоматизации Azure.


###Конфигурация узла###

При компиляции конфигурации DSC, в зависимости от блоков Node в ней, создается одна или несколько конфигураций узла. Конфигурация узла — это то же самое, что MOF или "документ конфигурации" (если вы знакомы с этими терминами PS DSC). Она представляет собой "роль", например веб-сервера или рабочего процесса, которая предполагается для требуемого состояния одного или нескольких узлов или проверки на соответствие требованиям. Имена конфигураций узлов в Automation DSC Azure имеют следующий вид: «имя\_конфигурации.имя\_блока\_конфигурации\_узла».

Чтобы сообщить узлам PS DSC о конфигурациях узлов, которые они должны выполнять, следует использовать метод push или pull DSC. DSC службы автоматизации Azure полагается на метод pull DSC. При этом узлы запрашивают нужные конфигурации узла с опрашивающего сервера DSC службы автоматизации Azure. Так как узлы делают запрос в DSC службы автоматизации Azure, они могут находиться за брандмауэрами, все их входящие порты могут быть закрыты и т. д. Они должны иметь исходящий доступ к Интернету (напрямую или через прокси-сервер).


###Узел###

Узел DSC — это любой компьютер, конфигурацией которого управляет DSC. Это может быть виртуальная машина Azure Windows или Linux, локальная виртуальная машина, физический узел или виртуальная машина в другом общедоступном облаке. Узлы применяют конфигурации узлов, чтобы принять и сохранить соответствие требуемому состоянию, определяемому ими. Кроме того, они могут сообщать на сервер отчетов о своем состоянии конфигурации и его соответствии требуемому состоянию.

DSC службы автоматизации Azure упрощает адаптацию узлов для управления и позволяет на стороне сервера изменять конфигурацию узла, назначенную каждому узлу. Таким образом, когда узел в следующий раз проверит инструкции на сервере, он примет другую роль и соответственно изменит свою конфигурацию и состояние соответствия требованиям на положительное.


###Resource (Ресурс)###
Ресурсы DSC — это стандартные блоки, которые можно использовать для определения конфигурации требуемого состояния Windows PowerShell DSC. DSC поставляется с набором встроенных ресурсов, в том числе для файлов и папок, компонентов и ролей сервера, параметров реестра, переменных среды, служб и процессов. Дополнительная информация о полном списке встроенных ресурсов DSC и их использовании: [Встроенные ресурсы Windows PowerShell DSC](https://technet.microsoft.com/library/dn249921.aspx).

Ресурсы DSC можно также импортировать как часть модулей PowerShell, чтобы расширить набор встроенных ресурсов DSC . Ресурсы, не используемые по умолчанию, будет получены узлами DSC с опрашивающего сервера DSC, если конфигурация узла содержит ссылки на эти ресурсы. Чтобы узнать, как создавать пользовательские ресурсы, см. также: [Создание пользовательских ресурсов Windows PowerShell DSC](https://technet.microsoft.com/library/dn249927.aspx).

DSC службы автоматизации Azure поставляется с теми же встроенными ресурсами DSC, что и PS DSC. Можно добавить дополнительные ресурсы в DSC службы автоматизации Azure, импортировав модули PowerShell, содержащие ресурсы, в службу автоматизации Azure.


###Задание компиляции###
Задание компиляции в DSC службы автоматизации Azure представляет собой экземпляр компиляции конфигурации, используемый для создания одной или нескольких конфигураций узлов. Эти задания аналогичны заданиям Runbook службы автоматизации Azure, за исключением того, что в действительности они не выполняют какие-либо задачи, кроме создания конфигураций узлов. Любые созданные заданием компиляции конфигурации узлов автоматически размещаются на опрашивающем сервере Automation DSC Azure и перезаписывают предыдущие версии конфигураций (если таковые существовали для этой конфигурации). Имя конфигурации узла, производимой заданием компиляции, имеет вид «имя\_конфигурации.имя\_блока\_конфигурации\_узла». Например, компиляция указанной ниже конфигурации приведет к созданию одной конфигурации узла — MyConfiguration.webserver.


![замещающий текст](./media/automation-dsc-overview/AADSC_5.png)


>[AZURE.NOTE] Как модули Runbook, конфигурации можно публиковать. Это не связано с помещением элементов DSC на опрашивающий сервер DSC службы автоматизации Azure. Задания компиляции помещают элементы DSC на опрашивающий сервер DSC службы автоматизации Azure. Дополнительная информация о «публикация» в службе автоматизации Azure: [Публикация Runbook](https://msdn.microsoft.com/library/dn903765.aspx).


##Жизненный цикл Azure Automation DSC##
Для перехода от пустой учетной записи автоматизации к управляемому набор правильно настроенных узлов требуется ряд процессов для определения конфигураций, их преобразования в конфигурации узлов, перенос узлов в Azure Automation DSC и применение этих конфигураций узлов. На следующей схеме показан жизненный цикл Azure Automation DSC:

![замещающий текст](./media/automation-dsc-overview/DSCLifecycle.png)


На следующем рисунке показан подробный пошаговый процесс жизненного цикла DSC. Он включает в себя различные способы импорта конфигураций и их применения к узлам службы автоматизации Azure. Кроме того, здесь приведены компоненты локальной машины, необходимые для поддержки DSC и взаимодействия между различными компонентами.

![Архитектура DSC](./media/automation-dsc-overview/dsc-architecture.png)

##Подводные камни и известные проблемы##

- Если вы хотите обновить до версии WMF 5 RTM, но виртуальная машина уже зарегистрирована как узел в DSC службы автоматизации Azure, сначала отмените эту регистрацию, а потом зарегистрируйте ее повторно после обновлений.

- Сейчас DSC службы автоматизации Azure не поддерживает частичные или составные конфигурации DSC. Однако составные ресурсы DSC импортируются и используются в конфигурациях Automation DSC Azure так же, как и в локальном компоненте PowerShell, позволяя повторно использовать ту или иную конфигурацию.

- Должна быть установлена последняя версия WMF 5, чтобы агент PowerShell DSC для Windows имел возможность обмениваться данными со службой автоматизации Azure. Должна быть установлена последняя версия агента PowerShell DSC для Linux, чтобы ОС Linux имела возможность обмениваться данными со службой автоматизации Azure.

- Традиционный опрашивающий сервер PowerShell DSC ожидает, что ZIP-файлы модуля размещаются на опрашивающем сервере в формате **ИмяМодуля\_Версия.zip**. Служба автоматизации Azure ожидает, что модули PowerShell импортируются с именами в виде **ИмяМодуля.zip**. В [этой записи блога](https://azure.microsoft.com/blog/2014/12/15/authoring-integration-modules-for-azure-automation/) можно подробнее узнать о формате модуля интеграции, необходимом для импорта модуля в службу автоматизации Azure.

- Модули PowerShell, импортированные в службу автоматизации Azure, не могут содержать DOC- или DOCX-файлы. Некоторые модули PowerShell, содержащий ресурсы DSC, содержат эти файлы в справочных целях. Эти файлы надо удалить из модулей, прежде чем импортировать их в службу автоматизации Azure.

- При первой регистрации узла с помощью учетной записи службы автоматизации Azure или изменении узла для сопоставления с другой конфигурацией узла на стороне сервера он будет находиться в состоянии "Совместимый", даже если оно фактически не соответствует конфигурации узла, с которой он сейчас сопоставлен. После того как узел сделает первый запрос и отправит свой первый отчет после регистрации или изменения сопоставления конфигурации узла, состояние узла можно будет считать надежным.

- Когда выполняется входящая миграция виртуальной машины Azure под управлением Windows для управления с использованием DSC службы автоматизации Azure при помощи любых прямых методов, эта виртуальная машина отобразится в качестве узла в DSC службы автоматизации Azure в течение одного часа. Это связано с тем, что расширение DSC для виртуальных машин Azure устанавливает на виртуальную машину платформу Windows Management Framework 5.0, которая требуется для размещения этой виртуальной машины в DSC службы автоматизации Azure.

- После регистрации каждый узел автоматически согласовывает уникальный сертификат для проверки подлинности, срок действия которого составляет один год. В настоящее время протокол регистрации PowerShell DSC не имеет возможности автоматически обновлять сертификаты при приближении даты окончания срока их действия, поэтому по истечении года необходимо повторно регистрировать узлы. Перед повторной регистрацией убедитесь, что на каждом узле работает Windows Management Framework 5.0 RTM. Если истек срок действия сертификата проверки подлинности узла и узел не зарегистрирован, то он не сможет взаимодействовать со службой автоматизации Azure и получит пометку "Не отвечает". Повторную регистрацию можно выполнить таким же образом, как и первоначальную регистрацию узла. Повторная регистрация, выполненная не позднее чем через 90 дней с момента истечения срока действия сертификата или в любой момент после истечения срока действия сертификата, приведет к созданию и использованию нового сертификата.

- Если вы хотите обновить до версии WMF 5 RTM, но виртуальная машина уже зарегистрирована как узел в DSC службы автоматизации Azure, сначала отмените эту регистрацию, а потом зарегистрируйте ее повторно после обновлений. Перед регистрацией удалите файл $env:windir\\system32\\configuration\\DSCEngineCache.mof.

- Командлеты PowerShell для DSC могут не работать, если после установки WMF 5 Production Preview вы установили WMF 5 RTM. Чтобы устранить эту проблему, выполните следующую команду в сеансе PowerShell с повышенными правами (используя запуск от имени администратора). `mofcomp $env:windir\system32\wbem\DscCoreConfProv.mof`
 

##Связанные статьи##

- [Подключение компьютеров для управления с помощью Azure Automation DSC](../automation/automation-dsc-onboarding.md)
- [Компилирование конфигураций в Azure Automation DSC](../automation/automation-dsc-compile.md)
- [Командлеты Automation DSC Azure](https://msdn.microsoft.com/library/mt244122.aspx)
- [Цены на Automation DSC Azure](https://azure.microsoft.com/pricing/details/automation/)
- [Непрерывное развертывание на виртуальные машины IaaS с помощью Azure Automation DSC и Chocolatey](automation-dsc-cd-chocolatey.md)

<!---HONumber=AcomDC_0921_2016-->