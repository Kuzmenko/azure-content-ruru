<properties
	pageTitle="Анализ тональности данных Twitter в режиме реального времени с помощью Stream Analytics | Microsoft Azure"
	description="Информация об использовании Stream Analytics для анализа тональности данных Twitter в режиме реального времени. Пошаговое руководство с шагами от создания событий до отображения данных на динамической панели мониторинга."
	keywords="анализ тенденций twitter в режиме реального времени, анализ тональности, анализ социальных сетей, пример анализа тенденций"
	services="stream-analytics"
	documentationCenter=""
	authors="jeffstokes72"
	manager="jhubbard"
	editor="cgronlun"/>

<tags
	ms.service="stream-analytics"
	ms.devlang="na"
	ms.topic="article"
	ms.tgt_pltfrm="na"
	ms.workload="big-data"
	ms.date="08/11/2016"
	ms.author="jeffstok"/>


# Аналитика социальных сетей: анализ тональности в Twitter в режиме реального времени в Azure Stream Analytics

Узнайте, как обеспечить анализ тональности для аналитики социальных сетей путем переноса событий Twitter в концентратор событий в режиме реального времени. Вы узнаете, как составлять запросы Stream Analytics для анализа данных, а затем сохранять результаты или использовать панель мониторинга для получения ценной аналитической информации в режиме реального времени, используя [Power BI](https://powerbi.com/).

Инструменты аналитики для социальных сетей помогают организациям определить популярные темы, то есть темы и отношения с большим объемом записей в социальных сетях. Чтобы определить отношение к продукции, идеям и т. д., анализ тональности, также называемый «интеллектуальный анализ мнений», использует инструменты аналитики для социальных сетей. Хороший пример — анализ тенденций Twitter в режиме реального времени, так как модель подписки с использованием хэштегов позволяет прослушивать определенные ключевые слова и разрабатывать анализ тональности канала.

## Сценарий: анализ тональности в режиме реального времени

Новостной веб-сайт хочет получить конкурентное преимущество, мгновенно предлагая читателям содержимое, которое будет им интересно. Его создатели используют аналитику социальных сетей по темам, которые интересуют их читателей, анализируя тональность данных Twitter в режиме реального времени. В частности, чтобы определить наиболее популярные темы в Twitter в режиме реального времени, им нужно в режиме реального времени анализировать количество твитов и тональность по ключевым темам. По сути, им требуется модуль аналитики анализа тональности на основе канала в социальных сетях.

## Предварительные требования
1.	Учетная запись Twitter и [маркер доступа OAuth](https://dev.twitter.com/oauth/overview/application-owner-access-tokens).
2.	[TwitterClient.zip](http://download.microsoft.com/download/1/7/4/1744EE47-63D0-4B9D-9ECF-E379D15F4586/TwitterClient.zip) из Центра загрузки Майкрософт.
3.	Необязательно: исходный код клиента Twitter с сайта [GitHub](https://aka.ms/azure-stream-analytics-twitterclient).

## Создание концентратора событий ввода и группа получателей

Пример приложения будет создавать события и передавать их экземпляру концентраторов событий (для краткости — концентратор событий). Для получения данных событий в Stream Analytics рекомендуется использовать концентраторы событий Service Bus. См. документацию по концентраторам событий в [документации Service Bus](/documentation/services/service-bus/).

Вот как можно создать концентратор событий.

1.	Чтобы создать концентратор событий, на портале Azure последовательно выберите пункты **СОЗДАТЬ**, **СЛУЖБЫ ПРИЛОЖЕНИЙ**, **СЛУЖЕБНАЯ ШИНА**, **КОНЦЕНТРАТОР СОБЫТИЙ** и **БЫСТРОЕ СОЗДАНИЕ**, а затем укажите имя, регион и новое или существующее пространство имен.
2.	Рекомендуем, чтобы каждое задание Stream Analytics считывалось из отдельной группы получателей концентраторов событий. Следуя нашим указаниям, вы сможете создать указанные ниже группы получателей и узнать о них много нового. Для создания группы получателей перейдите к только что созданному концентратору событий и нажмите кнопку **ГРУППЫ ПОЛУЧАТЕЛЕЙ**, затем щелкните **СОЗДАТЬ** в нижней части страницы и укажите имя группы получателей.
3.	Чтобы предоставить доступ к концентратору событий, необходимо создать политику общего доступа. Перейдите на вкладку **НАСТРОЙКА** в окне концентратора событий.
4.	В разделе **ПОЛИТИКИ ОБЩЕГО ДОСТУПА** создайте новую политику с разрешением на **УПРАВЛЕНИЕ**.


  	![Политики общего доступа, в которых можно создать политику с разрешениями на управление.](./media/stream-analytics-twitter-sentiment-analysis-trends/stream-ananlytics-shared-access-policies.png)

5.	В нижней части страницы нажмите кнопку **СОХРАНИТЬ**.
6.	Перейдите на **ПАНЕЛЬ МОНИТОРИНГА** и нажмите кнопку **СВЕДЕНИЯ О ПОДКЛЮЧЕНИИ** внизу страницы. Скопируйте и сохраните сведения о подключении. (Используйте значок копирования, который отображается под значком поиска).

## Настройка и запуск клиентского приложения Twitter

Мы разработали клиентское приложение, которое будет использовать данные Twitter с помощью [API потоковой передачи](https://dev.twitter.com/streaming/overview) и собирать события Twitter в темах из параметризованного набора. Открытый инструмент стороннего разработчика [Sentiment140](http://help.sentiment140.com/) используется для присвоения значения тональности каждому твиту (0: отрицательный; 2: нейтральный; 4: положительный) и последующей передачи событий-твитов в концентратор событий.

Вот как можно настроить приложение.

1.	[Загрузите решение TwitterClient.](http://download.microsoft.com/download/1/7/4/1744EE47-63D0-4B9D-9ECF-E379D15F4586/TwitterClient.zip)
2.	Откройте файл TwitterClient.exe.config и замените oauth\_consumer\_key, oauth\_consumer\_secret, oauth\_token, oauth\_token\_secret собственными значениями маркеров Twitter.

	[Выполните процедуру создания маркера доступа OAuth.](https://dev.twitter.com/oauth/overview/application-owner-access-tokens)

	Обратите внимание, что для создания маркера необходимо создать пустое приложение.
3.	Замените значения EventHubConnectionString и EventHubName в файле TwitterClient.exe.config своей строкой подключения и именем концентратора событий. Строка подключения, скопированная ранее, содержит строку подключения и имя концентратора событий, поэтому обязательно разделите их и поместите в соответствующие поля.
4.	*Необязательно:* измените ключевые слова для поиска. По умолчанию это приложение выполняет поиск по ключевым словам «Azure,Skype,XBox,Microsoft,Seattle». При необходимости можно настроить значения для twitter\_keywords в файле TwitterClient.exe.config.
5.	Запустите **TwitterClient.exe**, чтобы запустить свое приложение. Вы увидите события-твиты, значения CreatedAt, Topic и SentimentScore которых будут отправляться в концентратор событий.

	![Анализ тональности: значения SentimentScore, переданные в концентратор событий.](./media/stream-analytics-twitter-sentiment-analysis-trends/stream-analytics-twitter-sentiment-output-to-event-hub.png)

## Создание задания Stream Analytics

Теперь, когда у нас есть поток событий-твитов из Twitter в режиме реального времени, можно настроить задание Stream Analytics, чтобы анализировать эти события в режиме реального времени.

### Подготовка задания Stream Analytics

1.	На [портале Azure](https://manage.windowsazure.com/) щелкните **СОЗДАТЬ** > **СЛУЖБЫ ДАННЫХ** > **STREAM ANALYTICS** > **БЫСТРОЕ СОЗДАНИЕ**.
2.	Укажите следующие значения и щелкните **СОЗДАТЬ ЗАДАНИЕ АНАЛИТИКИ ПОТОКА**:

	* **ИМЯ ЗАДАНИЯ** — введите имя задания.
	* **РЕГИОН** — выберите регион, в котором должно выполняться задание. Рекомендуем поместить задание в концентратор событий в том же регионе, чтобы улучшить производительность и избежать лишних затрат на передачу данных между регионами.
	* **УЧЕТНАЯ ЗАПИСЬ ХРАНЕНИЯ** — выберите учетную запись хранения, которую вы хотите использовать для отслеживания данных всех заданий Stream Analytics, запущенных в этом регионе. Можно выбрать существующую учетную запись хранения или создать новую.

3.	Щелкните **АНАЛИТИКА ПОТОКА** в области слева, чтобы открыть список заданий Stream Analytics. ![Значок службы Stream Analytics](./media/stream-analytics-twitter-sentiment-analysis-trends/stream-analytics-service-icon.png)

4.	Новое задание будет отображаться с состоянием **СОЗДАНО**. Обратите внимание, что кнопка **НАЧАЛО** в нижней части страницы отключена. Прежде чем запустить задание, необходимо настроить для него запрос, входные и выходные данные.


### Укажите вход данных для задания
1.	В задании Stream Analytics щелкните **ВХОДНЫЕ ДАННЫЕ** в верхней части страницы, а затем щелкните **ДОБАВИТЬ ВХОДНЫЕ ДАННЫЕ**. Открывшееся диалоговое окно поможет выполнить ряд действий для настройки входных данных.
2.	Выберите **ПОТОК ДАННЫХ** и нажмите кнопку со стрелкой вправо.
3.	Выберите **КОНЦЕНТРАТОР СОБЫТИЙ** и нажмите кнопку со стрелкой вправо.
4.	На третьей странице введите или выберите следующие значения:

	* **ПСЕВДОНИМ ВХОДНЫХ ДАННЫХ** — введите понятное имя для входных данных этого задания, например TwitterStream. Впоследствии это имя будет использоваться в запросе. **КОНЦЕНТРАТОР СОБЫТИЙ** — если созданный концентратор событий находится в той же подписке, что и задание Stream Analytics, выберите пространство имен, которому принадлежит концентратор.

		Если концентратор событий находится в другой подписке, выберите пункт **Использовать концентратор событий из другой подписки** и введите вручную информацию в полях **ПРОСТРАНСТВО ИМЕН СЛУЖЕБНОЙ ШИНЫ**, **ИМЯ КОНЦЕНТРАТОРА СОБЫТИЙ**, **ИМЯ ПОЛИТИКИ КОНЦЕНТРАТОРА СОБЫТИЙ**, **КЛЮЧ ПОЛИТИКИ КОНЦЕНТРАТОРА СОБЫТИЙ** и **КОЛИЧЕСТВО СЕКЦИЙ КОНЦЕНТРАТОРА СОБЫТИЙ**.

	* **ИМЯ КОНЦЕНТРАТОРА СОБЫТИЙ** — выберите имя концентратора событий
	* **ИМЯ ПОЛИТИКИ КОНЦЕНТРАТОРА СОБЫТИЙ** — выберите политику для концентратора событий, созданную ранее в этом учебнике.
	* **ГРУППА ПОЛУЧАТЕЛЕЙ КОНЦЕНТРАТОРА СОБЫТИЙ** — введите группу получателей, созданную ранее в этом учебнике.
5.	Щелкните стрелку вправо.
6.	Укажите следующие значения:

	* **ФОРМАТ СЕРИАЛИЗАТОРА СОБЫТИЙ**: JSON;
	* **КОДИРОВКА** — UTF8.

7.	Нажмите кнопку «Проверить», чтобы добавить этот источник и убедится, что Stream Analytics может успешно подключаться к концентратору событий.

### Укажите запрос задания

Stream Analytics поддерживает простую декларативную модель запроса для описания преобразований. Дополнительные сведения о языке см. в разделе [Справочник по языку запросов Azure Stream Analytics](https://msdn.microsoft.com/library/azure/dn834998.aspx). Этот учебник поможет создать и проверить несколько запросов по данным Twitter.

#### Ввод примера данных

Чтобы проверить запрос на фактических данных задания, можно использовать функцию ОБРАЗЕЦ ДАННЫХ для извлечения событий из потока и создания JSON-файла событий для тестирования.

1.	Выберите входные данные концентратора событий и нажмите кнопку **ОБРАЗЕЦ ДАННЫХ** в нижней части страницы.
2.	В появившемся окне укажите **ВРЕМЯ НАЧАЛА** сбора данных и **ПРОДОЛЖИТЕЛЬНОСТЬ** получения дополнительных данных.
3.	Щелкните **СВЕДЕНИЯ**, а затем — ссылку **Щелкните здесь**, чтобы загрузить и сохранить созданный JSON-файл.

#### Запрос к серверу
Прежде всего мы отправим простой запрос к серверу, чтобы заполнить все поля события.

1.	Щелкните **ЗАПРОС** в верхней части страницы задания Stream Analytics.
2.	В редакторе кода замените начальный шаблон запроса следующим кодом:

		SELECT * FROM TwitterStream

	Убедитесь, что имя входного источника соответствует имени входных данных, указанному вами ранее.

3.	Щелкните **ТЕСТ** в редакторе запросов
4.	Найдите образец JSON-файла
5.	Нажмите кнопку проверки и просмотрите результаты, которые отображаются под определением запроса.

	![Результаты отображаются под определением запроса](./media/stream-analytics-twitter-sentiment-analysis-trends/stream-analytics-sentiment-by-topic.png)

#### Количество твитов по теме: "переворачивающееся" окно с агрегированием

Чтобы сравнить количество упоминаний по разным темам, воспользуемся [TumblingWindow](https://msdn.microsoft.com/library/azure/dn835055.aspx). Это позволит получать количество упоминаний по теме каждые 5 секунд.

1.	Измените запрос в редакторе кода на:

		SELECT System.Timestamp as Time, Topic, COUNT(*)
		FROM TwitterStream TIMESTAMP BY CreatedAt
		GROUP BY TUMBLINGWINDOW(s, 5), Topic

	Обратите внимание, что в этом запросе используется ключевое слово **TIMESTAMP BY**, позволяющее задать поле метки времени в полезных данных, используемых при вычислении временных распределений. Если это поле не указано, при выполнении операций с окнами будет использоваться время, когда каждое событие будет достигать концентратора событий. Дополнительные сведения см. в группе «Время прибытия и время приложения» в разделе [Справочник по языку запросов Azure Stream Analytics](https://msdn.microsoft.com/library/azure/dn834998.aspx).

	Этот запрос также получает доступ к метке времени конца каждого окна с помощью метки **System.Timestamp**.

2.	Щелкните **ПОВТОР** в редакторе запросов, чтобы просмотреть результаты запроса.

#### Определение популярных тем: скользящее окно

Для определения популярных тем мы будем искать темы, упоминания по которым превышают пороговое значение за определенный промежуток времени. Для целей данного учебника мы проверим темы, упомянутые более 20 раз за последние 5 с, используя [SlidingWindow](https://msdn.microsoft.com/library/azure/dn835051.aspx).

1.	Измените запрос в редакторе кода на:

		SELECT System.Timestamp as Time, Topic, COUNT(*) as Mentions
		FROM TwitterStream TIMESTAMP BY CreatedAt
		GROUP BY SLIDINGWINDOW(s, 5), topic
		HAVING COUNT(*) > 20

2.	Щелкните **ПОВТОР** в редакторе запросов, чтобы просмотреть результаты запроса.

	![Скользящее окно выходных данных запроса](./media/stream-analytics-twitter-sentiment-analysis-trends/stream-analytics-query-output.png)

#### Количество упоминаний и их тональность: «переворачивающееся» окно с агрегацией

Последний запрос, который мы будем тестировать, использует TumblingWindow, чтобы получить количество упоминаний, среднее, минимальное, максимальное значение и стандартное отклонение оценки тональности для каждой темы каждые 5 секунд.

1.	Измените запрос в редакторе кода на:

		SELECT System.Timestamp as Time, Topic, COUNT(*), AVG(SentimentScore), MIN(SentimentScore),
    	Max(SentimentScore), STDEV(SentimentScore)
		FROM TwitterStream TIMESTAMP BY CreatedAt
		GROUP BY TUMBLINGWINDOW(s, 5), Topic

2.	Щелкните **ПОВТОР** в редакторе запросов, чтобы просмотреть результаты запроса.
3.	Это запрос, который будет использоваться для нашей панели мониторинга. В нижней части страницы нажмите кнопку **СОХРАНИТЬ**.


## Создание приемника выходных данных

Теперь, когда мы определили поток событий, входные данные концентратора событий для приема событий и запрос для выполнения преобразования потока, остался последний этап — определить приемник выходных данных задания. Мы запишем агрегированные события-твиты из нашего запроса задания в большой двоичный объект Azure. Кроме того, в зависимости от потребностей приложения можно передать результаты в базу данных SQL, табличное хранилище или концентратор событий.

Выполните следующие действия, чтобы создать контейнер для хранения больших двоичных объектов, если он еще не создан.

1.	Используйте существующую учетную запись хранения или создайте новую, щелкнув **Создать** > **СЛУЖБЫ ДАННЫХ** > **ХРАНИЛИЩЕ** > **БЫСТРО СОЗДАТЬ** > и следуйте указаниям на экране.
2.	Выберите учетную запись хранения и щелкните **КОНТЕЙНЕРЫ** в верхней части страницы, а затем щелкните **ДОБАВИТЬ**.
3.	В поле **ИМЯ** укажите имя контейнера, а в поле **ДОСТУП** задайте разрешение на доступ к общедоступному большому двоичному объекту.

## Укажите выходные данные задания

1.	В задании Stream Analytics щелкните **ВЫХОДНЫЕ ДАННЫЕ** в верхней части страницы, а затем щелкните **ДОБАВИТЬ ВЫХОДНЫЕ ДАННЫЕ**. Открывшееся диалоговое окно поможет выполнить ряд действий по настройке выходных данных.
2.	Выберите пункт **ХРАНИЛИЩЕ БОЛЬШИХ ДВОИЧНЫХ ОБЪЕКТОВ**, а затем нажмите расположенную справа кнопку.
3.	На третьей странице введите или выберите следующие значения:

	* **ВЫХОДНОЙ ПСЕВДОНИМ** — введите понятное имя для этих выходных данных задания.
	* **Подписка**: если хранилище BLOB-объектов создано в той же подписке, что и задание Stream Analytics, выберите параметр **Использовать учетную запись хранения из текущей подписки**. Если хранилище связано с другой подпиской, выберите **Использовать учетную запись хранения из другой подписки** и вручную заполните поля **УЧЕТНАЯ ЗАПИСЬ ХРАНЕНИЯ**, **КЛЮЧ УЧЕТНОЙ ЗАПИСИ ХРАНЕНИЯ** и **КОНТЕЙНЕР**.
	* **УЧЕТНАЯ ЗАПИСЬ ХРАНЕНИЯ** — выберите имя учетной записи хранения.
	* **КОНТЕЙНЕР** — выберите имя контейнера.
	* **ПРЕФИКС ИМЕНИ ФАЙЛА** — введите префикс файла, который следует использовать при записи выходных данных в BLOB-объект.

4.	Щелкните стрелку вправо.
5.	Укажите следующие значения:
	* **ФОРМАТ СЕРИАЛИЗАТОРА СОБЫТИЙ**: JSON;
	* **КОДИРОВКА**: UTF8.
6.	Нажмите кнопку "Проверить", чтобы добавить этот источник и убедиться, что служба Stream Analytics может успешно подключаться к учетной записи хранения.

## Запуск задания

Входные данные, запрос и выходные данные заданы, так что теперь запустить задание Stream Analytics.

1.	На **ПАНЕЛИ МОНИТОРИНГА** задания щелкните **НАЧАЛО** в нижней части страницы.
2.	В открывшемся диалоговом окне выберите **ВРЕМЯ НАЧАЛА ЗАДАНИЯ**, а затем нажмите кнопку с изображением флажка в нижней части диалогового окна. Состояние задания изменится на **Запуск**, а затем — на **Выполняется**.


## Просмотр выходных данных для анализа тональности

После запуска задания и обработки потока Twitter в режиме реального времени выберите способ просмотра выходных данных для анализа тональности. чтобы просматривать выходные данные задания в реальном времени, воспользуйтесь такими инструментами, как [Обозреватель хранилищ Azure](https://azurestorageexplorer.codeplex.com/) или [Обозреватель Azure](http://www.cerebrata.com/products/azure-explorer/introduction). Здесь вы можете включить в приложение настраиваемую панель мониторинга выходных данных, как показано на рисунке ниже, используя [Power BI](https://powerbi.com/).

![Анализ социальных сетей: вывод данных об анализе тональности (интеллектуальный анализ данных) Stream Analytics на панель мониторинга Power BI.](./media/stream-analytics-twitter-sentiment-analysis-trends/stream-analytics-output-power-bi.png)

## Получение поддержки
За дополнительной помощью обращайтесь на наш [форум Azure Stream Analytics](https://social.msdn.microsoft.com/Forums/ru-RU/home?forum=AzureStreamAnalytics).


## Дальнейшие действия

- [Введение в Azure Stream Analytics](stream-analytics-introduction.md)
- [Приступая к работе с Azure Stream Analytics](stream-analytics-get-started.md)
- [Масштабирование заданий в службе Azure Stream Analytics](stream-analytics-scale-jobs.md)
- [Справочник по языку запросов Azure Stream Analytics](https://msdn.microsoft.com/library/azure/dn834998.aspx)
- [Справочник по API-интерфейсу REST управления Stream Analytics](https://msdn.microsoft.com/library/azure/dn835031.aspx)
 

<!---HONumber=AcomDC_0921_2016-->