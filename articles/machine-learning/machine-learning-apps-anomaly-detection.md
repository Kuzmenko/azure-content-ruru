<properties 
	pageTitle="Приложение машинного обучения: служба обнаружения аномалий | Microsoft Azure" 
	description="API обнаружения аномалий — это встроенный в Машинное обучение Microsoft Azure пример API, который обнаруживает аномалии в данных временных рядов и предоставляет результаты в виде числовых значений, равномерно распределенных по времени." 
	services="machine-learning" 
	documentationCenter="" 
	authors="andkjell" 
	manager="jhubbard"
	editor="cgronlun" />

<tags 
	ms.service="machine-learning" 
	ms.devlang="na" 
	ms.topic="reference" 
	ms.tgt_pltfrm="na" 
	ms.workload="multiple" 
	ms.date="07/22/2016" 
	ms.author="andkjell"/>


# Служба обнаружения аномалий в машинном обучении#

##Обзор

API обнаружения аномалий — это встроенный в Машинное обучение Azure пример API, который обнаруживает аномалии в данных временных рядов и предоставляет результаты в виде числовых значений, равномерно распределенных по времени.

Эти интерфейсы API могут обнаруживать аномальное поведение следующих типов в данных временных рядов:

* **Положительные и отрицательные тенденции**. Например, положительная тенденция при мониторинге использования памяти для вычислений может быть показательной, так как она может свидетельствовать об утечке памяти.

* **Изменение динамического диапазона значений**. Например, при мониторинге исключений, инициированных облачной службой, каждое изменение динамического диапазона свидетельствует о нестабильности состояния службы.

* **Пики и спады**. Например, при мониторинге количества сбоев входа в службу или случаев оформления заказа на сайтах электронной коммерции, пики и спады помогают обнаружить ненормальное поведение.

Эти средства обнаружения машинного обучения отслеживают эти изменения в значениях с течением времени и сообщают о текущих изменениях значений в виде показателей аномалий. Они не требуют прямой настройки пороговых значений, и их оценки можно использовать для управления ложноположительными результатами. API обнаружения аномалий удобно использовать в некоторых сценариях, например при мониторинге служб путем отслеживания ключевых показателей эффективности с течением времени, мониторинге использования на основе метрик (таких как количество поисковых запросов, количество щелчков), мониторинге производительности с помощью счетчиков (таких как память, ЦП, операции считывания файлов) и т. д. с течением времени.

Предложение по обнаружению аномалий поставляется с полезными средствами, которые помогут вам начать работу.

* [Веб-приложение](http://anomalydetection-aml.azurewebsites.net/) позволяет оценить и визуализировать результаты интерфейсов API обнаружения аномалий в данных.

* В [примере кода](http://adresultparser.codeplex.com/) показано, как получить доступ к API программным способом и проанализировать результаты на языке C#.

[AZURE.INCLUDE [machine-learning-free-trial](../../includes/machine-learning-free-trial.md)]


##Определение интерфейса API

Эта служба предоставляет API-интерфейс REST по протоколу HTTPS, который можно использовать различными способами, в том числе в мобильном или веб-приложении, R, Python, Excel и т. д. В эту службу отправляются данные временных рядов путем вызова REST API, который запускает средства для трех типов аномалий, описанных выше. Эта служба работает на платформе Машинного обучения Azure, которая легко масштабируется в соответствии с потребностями бизнеса и предоставляет соглашения об уровне обслуживания.

###Заголовки
Убедитесь, что в запрос, который должен иметь следующий вид, включены правильные заголовки:

	Authorization: Basic <creds>
	Accept: application/json
               
	Where <creds> = ConvertToBase64(“AccountKey:” + yourActualAccountKey);  

Ключ учетной записи можно найти в вашей учетной записи в [Azure Data Market](https://datamarket.azure.com/account/keys).

###API оценки

С помощью API оценки можно обнаруживать аномалии в данных временных рядов, которые не являются сезонными. API запускает несколько средств обнаружения аномалий в данных и возвращает соответствующие показатели аномалий. На рисунке ниже показан пример аномалий, которые может обнаружить API оценки. В этом временном ряду есть 2 отчетливых изменения уровня и 3 пика. Красными точками обозначено время обнаружения изменений уровня, а черными точками — обнаруженные пики.

![API оценки][1]
	
**URL-адрес**

	https://api.datamarket.azure.com/data.ashx/aml_labs/anomalydetection/v2/Score 

**Пример текста запроса**

В следующем запросе мы отправили временные ряды (сокращенные) с точками данных за период с 1.03.2016 по 10.03.2016 и параметры средств обнаружения пиков в API для обнаружения аномалий в этих точках данных.

	{
	  "data": [
	    [ "9/21/2014 11:05:00 AM", "3" ],
	    [ "9/21/2014 11:10:00 AM", "9.09" ],
	    [ "9/21/2014 11:15:00 AM", "0" ]
	  ],
	  "params": {
	    "tspikedetector.sensitivity": "3",
	    "zspikedetector.sensitivity": "3",
	    "trenddetector.sensitivity": "3.25",
	    "bileveldetector.sensitivity": "3.25",
	    "postprocess.tailRows": "2"
	  }
	}

Ответ будет выглядеть так:

	{
	  "odata.metadata":"https://api.datamarket.azure.com/data.ashx/aml_labs/anomalydetection/v2/$metadata#AnomalyDetection.FrontEndService.Models.AnomalyDetectionResult",
	  "ADOutput":"{
	    "ColumnNames":["Time","Data","TSpike","ZSpike","rpscore","rpalert","tscore","talert"],
		"ColumnTypes":["DateTime","Double","Double","Double","Double","Int32","Double","Int32"],
		"Values":[
		  ["9/21/2014 11:10:00 AM","9.09","0","0","-1.07030497733224","0","-0.884548154298423","0"],
		  ["9/21/2014 11:15:00 AM","0","0","0","-1.05186237440962","0","-1.173800281031","0"]
		]
	  }"
	}

###API ScoreWithSeasonality

API ScoreWithSeasonality позволяет обнаруживать аномалии во временных рядах с сезонными закономерностями. Этот API используется для обнаружения отклонений в сезонных закономерностях.

На следующем рисунке показан пример аномалий, обнаруженных в сезонных временных рядах. Во временных рядах обнаружен один пик (1-я черная точка), два спада (2-я и последняя черная точка) и одно изменение уровня (красная точка). Обратите внимание, что спад посредине временных рядов и изменение уровня становятся четко выраженными только после удаления сезонных компонентов из рядов.

![API сезонности][2]

**URL-адрес**

	https://api.datamarket.azure.com/data.ashx/aml_labs/anomalydetection/v2/ScoreWithSeasonality 

**Пример текста запроса**

В следующем запросе мы отправили временные ряды (сокращенные) с точками данных за период с 1.03.2016 по 10.03.2016 и параметры в API для обнаружения аномалий в этих точках данных.

	{
	  "data": [
	    [ "9/21/2014 11:10:00 AM", "9" ],
	    [ "9/21/2014 11:15:00 AM", "12" ],
	    [ "9/21/2014 11:20:00 AM", "10" ]
	  ],
	  "params": {
	    "preprocess.aggregationInterval": "0",
	    "preprocess.aggregationFunc": "mean",
	    "preprocess.replaceMissing": "lkv",
	    "postprocess.tailRows": "1",
	    "zspikedetector.sensitivity": "3",
	    "tspikedetector.sensitivity": "3",
	    "upleveldetector.sensitivity": "3.25",
	    "bileveldetector.sensitivity": "3.25",
	    "trenddetector.sensitivity": "3.25",
	    "detectors.historywindow": "500",
	    "seasonality.enable": "true",
	    "seasonality.transform": "deseason",
	    "seasonality.numSeasonality": "1"
	  }
	}

Ответ будет выглядеть так:

	{
		"odata.metadata": "https://api.datamarket.azure.com/data.ashx/aml_labs/anomalydetection/v2/$metadata#AnomalyDetection.FrontEndService.Models.AnomalyDetectionResult",
		"ADOutput": "{
			"ColumnNames":["Time","OriginalData","ProcessedData","TSpike","ZSpike","PScore","PAlert","RPScore","RPAlert","TScore","TAlert"],
		  	"ColumnTypes":["DateTime","Double","Double","Double","Double","Double","Int32","Double","Int32","Double","Int32"],
		  	"Values":[
		    	["9/21/201411: 20: 00AM","10","10","0","0","-1.30229513613974","0","-1.30229513613974","0","-1.173800281031","0"]
		  	]
		}"
	}

###Средства обнаружения

API обнаружения аномалий поддерживает средства обнаружения, которые подразделяются на 3 обширные категории. Сведения об определенных входных параметрах и выходных данных для каждого средства обнаружения представлены в следующей таблице.

|Категория средства обнаружения|Средство обнаружения|Описание|Входные параметры|Выходные данные
|---|---|---|---|---|
|Средства обнаружения пиков|Средства обнаружения пиков TSpike|Обнаружение пиков и спадов согласно чувствительности набора|*tspikedetector.sensitivity*: принимает целое значение в диапазоне от 1 до 10. Значение по умолчанию — 3. Чем выше значение, тем меньше чувствительность.|TSpike: двоичные значения — 1 при обнаружении пика или спада, в противном случае — 0.|
||Средства обнаружения пиков ZSpike|Обнаружение пиков и спадов согласно чувствительности набора|*zspikedetector.sensitivity*: принимает целое значение в диапазоне от 1 до 10. Значение по умолчанию — 3. Чем выше значение, тем меньше чувствительность.|ZSpike: двоичные значения — 1 при обнаружении пика или спада, в противном случае — 0.|
|Средство обнаружения медленно развивающихся тенденций|Средство обнаружения медленно развивающихся тенденций|Обнаружение медленно развивающихся положительных тенденций согласно чувствительности набора|*trenddetector.sensitivity*: пороговое значение для показателя средства обнаружения. Значение по умолчанию — 3,25. 3,25–5 — приемлемый диапазон значений. Чем выше значение, тем меньше чувствительность.|TScore: число с плавающей точкой, которое используется как показатель аномалий в тенденции.|
|Средства обнаружения изменений уровня|Средство обнаружения однонаправленных изменений уровня|Определение восходящего изменения уровня согласно чувствительности набора|*upleveldetector.sensitivity*: пороговое значение для показателя средства обнаружения. Значение по умолчанию — 3,25. 3,25–5 — приемлемый диапазон значений. Чем выше значение, тем меньше чувствительность.|PScore: число с плавающей точкой, которое используется как показатель аномалий в восходящем изменении уровня.|
||Средство обнаружения двунаправленных изменений уровня|Обнаружение восходящих и нисходящих изменений уровня согласно чувствительности набора|*bileveldetector.sensitivity*: пороговое значение для показателя средства обнаружения. Значение по умолчанию — 3,25. 3,25–5 — приемлемый диапазон значений. Чем выше значение, тем меньше чувствительность.|RPScore: число с плавающей точкой, которое используется как показатель аномалий в восходящем и нисходящем изменении уровня.

###Параметры

Подробные сведения об этих входных параметрах представлены в следующей таблице.

|Входные параметры|Описание|Значение по умолчанию|Тип|Допустимый диапазон значений|Рекомендуемый диапазон значений|
|---|---|---|---|---|---|
|preprocess.aggregationInterval|Интервал агрегации в секундах для агрегирования входных временных рядов|0 (агрегирование не выполняется)|целое число|0 — агрегирование пропускается, в противном случае используется значение больше 0|От 5 минут до 1 дня, зависит от временных рядов
|preprocess.aggregationFunc|Функция, используемая для агрегирования данных в указанный параметр AggregationInterval|mean|перечисляемый|mean, sum, length|Недоступно|
|preprocess.replaceMissing|Значения, используемые для добавления отсутствующих данных|lkv (последнее известное значение)|перечисляемый|zero, lkv, mean|Недоступно|
|detectors.historyWindow|Журнал (с множеством точек данных), используемый для вычисления показателей аномалий|500|целое число|10–2000|Зависит от временных рядов|
|upleveldetector.sensitivity|Чувствительность для средства обнаружения восходящих изменений уровня |3\.25|double|None|3,25–5 (чем меньше значение, тем больше чувствительность)|
|bileveldetector.sensitivity|Чувствительность для средства обнаружения двунаправленных изменений уровня |3\.25|double|None|3,25–5 (чем меньше значение, тем больше чувствительность)|
|trenddetector.sensitivity|Чувствительность для средства обнаружения положительных тенденций |3\.25|double|None|3,25–5 (чем меньше значение, тем больше чувствительность)|
|tspikedetector.sensitivity |Чувствительность для средства обнаружения пиков TSpike|3|целое число|1–10|3–5 (чем меньше значение, тем больше чувствительность)|
|zspikedetector.sensitivity |Чувствительность для средства обнаружения пиков ZSpike|3|целое число|1–10 |3–5 (чем меньше значение, тем больше чувствительность)|
|seasonality.enable|Указывает, нужно ли выполнять анализ сезонности|Да|Логическое|true, false|Зависит от временных рядов|
|seasonality.numSeasonality |Максимальное число периодических циклов для обнаружения|1|целое число|1, 2|1–2|
|seasonality.transform |Указывает, будут ли перед обнаружением аномалий удаляться сезонные компоненты и компоненты тенденций|deseason|перечисляемый|none, deseason, deseasontrend|Недоступно|
|postprocess.tailRows |Число последних точек данных, которые нужно сохранить в выходных результатах|0|целое число|0 (сохранить все точки данных) или укажите количество точек, которые следует сохранить в результатах|Недоступно|

###Выходные данные
API запускает все средства обнаружения для данных временных рядов и возвращает оценки аномалий, а также показатели пиков в двоичных данных в каждый момент времени. В следующей таблице перечислены выходные данные API.

|Выходные данные|Описание|
|---|---|
|Время|Метки времени из необработанных данных или агрегированные (и/или) добавленные данные при применении агрегирования и/или добавления отсутствующих данных|
|OriginalData|Значения из необработанных данных или агрегированные (и/или) добавленные данные при применении агрегирования и/или добавления отсутствующих данных|
|ProcessedData|Один из следующих типов выходных данных: <ul><li>временные ряды с сезонными изменениями, если обнаружены значительные сезонные колебания и установлен параметр deseason;</li><li>временные ряды с сезонными изменениями без тенденций, если обнаружены значительные сезонные колебания и установлен параметр deseasontrend;</li><li>в противном случае вы получаете такие же выходные данные, как и для типа OriginalData.</li>|
|TSpike|Двоичный показатель обнаружения пика с помощью средства обнаружения пиков TSpike|
|ZSpike|Двоичный показатель обнаружения пика с помощью средства обнаружения пиков ZSpike|
|Pscore|Число с плавающей точкой, которое используется как показатель аномалий в восходящем изменении уровня|
|Palert|Значение 1 или 0, которое указывает на обнаружение аномалий восходящего изменения уровня согласно чувствительности входных данных|
|RPScore|Число с плавающей точкой, которое используется как показатель аномалий в двунаправленном изменении уровня|
|RPAlert|Значение 1 или 0, которое указывает на обнаружение аномалий двунаправленного изменения уровня согласно чувствительности входных данных|
|TScore|Число с плавающей точкой, которое используется как показатель аномалий в положительной тенденции|
|TAlert|Значение 1 или 0, которое указывает на обнаружение аномалий положительной тенденции согласно чувствительности входных данных|


Эти выходные данные можно проанализировать с помощью [простого средства синтаксического анализа](https://adresultparser.codeplex.com/). Оно содержит пример кода, в котором показано, как подключиться к API и проанализировать выходные данные. Обнаруженные аномалии можно визуализировать на панели мониторинга, передать специалистам для исправления или интегрировать в систему отправки запросов.


[1]: ./media/machine-learning-apps-anomaly-detection/anomaly-detection-score.png
[2]: ./media/machine-learning-apps-anomaly-detection/anomaly-detection-seasonal.png

 

 

<!---HONumber=AcomDC_0914_2016-->
