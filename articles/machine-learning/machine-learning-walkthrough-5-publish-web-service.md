<properties
	pageTitle="Шаг 5. Развертывание веб-службы машинного обучения | Microsoft Azure"
	description="Шаг 5 пошагового руководства по разработке прогностического решения. Развертывание прогностического эксперимента в студии машинного обучения в качестве веб-службы."
	services="machine-learning"
	documentationCenter=""
	authors="garyericson"
	manager="jhubbard"
	editor="cgronlun"/>

<tags
	ms.service="machine-learning"
	ms.workload="data-services"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="09/16/2016"
	ms.author="garye"/>


# Шаг 5. Развертывание веб-службы машинного обучения Azure

Это пятый этап пошагового руководства [Разработка решения для прогнозной аналитики в машинном обучении Azure](machine-learning-walkthrough-develop-predictive-solution.md).


1.	[Создание рабочей области машинного обучения](machine-learning-walkthrough-1-create-ml-workspace.md)
2.	[Отправка существующих данных](machine-learning-walkthrough-2-upload-data.md)
3.	[Создание нового эксперимента](machine-learning-walkthrough-3-create-new-experiment.md)
4.	[Обучение и анализ моделей](machine-learning-walkthrough-4-train-and-evaluate-models.md)
5.	**Развертывание веб-службы**
6.	[Доступ к веб-службе](machine-learning-walkthrough-6-access-web-service.md)

----------

Мы разработали это руководство, чтобы другие смогли воспользоваться прогнозной моделью. Мы развернем ее как веб-службу в Azure.

Вплоть до этого момента мы экспериментировали с обучением нашей модели. Но развернутая служба больше не будет выполнять обучение — она будет создавать прогнозы на основе оценки пользовательского ввода на основе нашей модели. Поэтому мы собираемся выполнить некоторую подготовку для преобразования этого эксперимента из ***обучающего*** в ***прогнозный***.

Этот процесс состоит из двух этапов:

1. Преобразование *обучающего эксперимента* в *прогностический эксперимент*
2. Развертывание прогностического эксперимента в качестве веб-службы

Но сначала необходимо немного усечь этот эксперимент. В настоящее время в эксперименте есть две различные модели. Но для развертывания нужно выбрать одну модель, которую мы хотим развернуть в качестве веб-службы.

Допустим, мы решили, что нам лучше подходит модель ускоренного дерева. Поэтому сначала мы удалим модуль [Двухклассовая машина опорных векторов][two-class-support-vector-machine] и модули, которые использовались для его обучения. Сначала создайте копию эксперимента, нажав кнопку **Сохранить как** в нижней части полотна эксперимента.

Необходимо удалить следующие модули:

- [Двухклассовая машина опорных векторов;][two-class-support-vector-machine]
- модули [Обучение модели][train-model] и [Оценка модели][score-model], которые были к нему подключены;
- [Нормализовать данные][normalize-data] \(оба варианта);
- [модель оценки.][evaluate-model]

Просто выберите модуль и нажмите клавишу Delete или щелкните модуль правой кнопкой мыши и выберите **Удалить**.

Теперь мы готовы к развертыванию этой модели с помощью [двухклассового увеличивающегося дерева принятия решений][two-class-boosted-decision-tree].

## Преобразование обучающего эксперимента в прогностический эксперимент

Преобразование в прогностический эксперимент состоит из трех этапов:

1. Сохраните обученную модуль и замените обучающие модули.
2. удаление из эксперимента модулей, которые были необходимы только для обучения;
3. Определите, где веб-служба будет принимать входные данные и где формировать выходные данные.

К счастью, можно выполнить все три шага, просто щелкнув **Set Up Web Service** (Настроить веб-службу) в нижней части области эксперимента (см. параметр **Predictive Web Service** (Прогнозная веб-служба)).

При щелчке **Set Up Web Service** (Настроить веб-службу) происходит следующее.

- Обученная нами модель сохраняется как одиночный модуль **Обученная модель** в палитре модулей слева от холста эксперимента (ее можно найти в палитре в разделе **Обученные модели**).
- Модули, которые мы использовали для обучения, удаляются. В частности:
  - [Двухклассовое увеличивающееся дерево принятия решений;][two-class-boosted-decision-tree]
  - [модель обучения;][train-model]
  - [Разбиение данных][split]
  - второй модуль [Выполнить скрипт R][execute-r-script], который был использован для тестовых данных.
- Сохраненная обученная модель добавляется обратно в эксперимент.
- Добавляются модули **Входные данные веб-службы** и **Выходные данные веб-службы**.

> [AZURE.NOTE] Эксперимент был сохранен в виде двух частей на вкладках, которые были добавлены в верхней части холста эксперимента: исходный обучающий эксперимент — на вкладке **Обучающий эксперимент**, а только что созданный прогнозный эксперимент — на вкладке **Прогнозный эксперимент**.

С этим экспериментом необходимо выполнить одно дополнительное действие. Мы добавили два модуля [Выполнение скрипта R][execute-r-script], чтобы реализовать функцию взвешивания данных для обучения и тестирования. В конечной модели этого делать не нужно. Студия машинного обучения удалила один модуль [Выполнение скрипта R][execute-r-script] при удалении модуля [Разбиение][split], поэтому теперь мы можем удалить другой модуль и подключить [Редактор метаданных][metadata-editor] непосредственно к [Оценке модели][score-model].

Теперь наш эксперимент должен выглядеть следующим образом:

![Оценка обученной модели][4]


> [AZURE.NOTE] Возможно, вас удивляет, почему мы оставили набор данных UCI German Credit Card Data в прогностическом эксперименте. Служба будет использовать данные пользователя, а не изначальный набор данных — так зачем оставлять в модели исходный набор данных?
>
>Действительно, службе не нужны исходные данные кредитных карт. Но по-прежнему нужна схема для этих данных, включающая такие сведения, как общее число столбцов, а также какие столбцы являются числовыми. Эти данные схемы необходимы для интерпретации пользовательских данных. Мы оставили эти компоненты подключенными, чтобы модуль оценки имел схему набора данных при запуске службы. Данные не используются, используется только схема.

Запустите эксперимент в последний раз (нажмите **Выполнить**). Чтобы убедиться в том, что модуль по-прежнему работает, щелкните по выходным данным модуля [Оценка модели][score-model] и выберите **Показать результаты**. Вы увидите, что изначальные данные отображаются вместе со значением кредитного риска ("Расчетные метки") и оценочным значением вероятности ("Расчетные вероятности").

## Развертывание веб-службы

Эксперимент можно развернуть в виде классической веб-службы или новой веб-службы на основе Azure Resource Manager.

### Развертывание в виде классической веб-службы ###

Чтобы развернуть классическую веб-службу, порожденную из нашего эксперимента, щелкните **Deploy Web Service** (Развернуть веб-службу) под холстом и выберите пункт **Deploy Web Service [New]** (Развернуть веб-службу [новую]). Студия машинного обучения развернет эксперимент как веб-службу и откроет панель мониторинга для этой веб-службы. На ней можно вернуться к эксперименту (**View snapshot** (Просмотр снимка) или **View latest** (Просмотр последних)) и выполнить простой тест веб-службы (с помощью кнопки **Test** (Тестировать) — см. раздел **Тестирование веб-службы** ниже). На ней также приведены сведения о создании приложений, которые могут обращаться к веб-службе (подробнее об этом в следующем шаге пошагового руководства).

![Панель мониторинга веб-службы][6]

Службу можно настраивать на вкладке **КОНФИГУРАЦИЯ**. На этой вкладке можно изменить имя службы (по умолчанию она получает имя эксперимента) и предоставить ее описание. Можно также задать более удобочитаемые названия для входных и выходных столбцов.

![Настройка веб-службы][5]

### Развертывание в качестве новой веб-службы

Чтобы развернуть новую веб-службу, порожденную из нашего эксперимента, щелкните **Deploy Web Service** (Развернуть веб-службу) под холстом и выберите пункт **Deploy Web Service [New]** (Развернуть веб-службу [новую]). Студия машинного обучения откроет страницу развертывания эксперимента в веб-службах Машинного обучения Azure.

Введите имя веб-службы и выберите ценовой план. Если у вас уже имеется ценовой план, то можно выбрать его. В противном случае необходимо создать ценовой план для службы.

1.	Из раскрывающегося списка **Price Plan** (Ценовой план) выберите существующий план или параметр **Select new plan** (Выбрать новый план).
2.	В поле **Имя плана** введите имя для идентификации плана в счете.
3.	Выберите один из вариантов **Monthly Plan Tier** (Уровень ежемесячного плана). Обратите внимание, что по умолчанию указаны уровни плана для вашего региона по умолчанию, и веб-служба развертывается в этом регионе.

Щелкните **Deploy** (Развернуть). Откроется страница **Quickstart** (Быстрый запуск) для веб-службы.

Службу можно настроить, щелкнув пункт меню **Configure** (Настроить). На этой вкладке можно изменить имя службы (по умолчанию она получает имя эксперимента) и предоставить ее описание. Можно также включить или отключить ведение журнала ошибок и выборку данных, которые могут использоваться для тестирования службы.

Для тестирования веб-службы выберите пункт меню **Test** (Тестировать) (см. раздел **Тестирование веб-службы** ниже). Чтобы получить сведения о создании приложений, которые могут обращаться к веб-службе, щелкните пункт меню **Consume** (Использовать) (подробнее об этом вы узнаете в следующем шаге данного пошагового руководства).


> [AZURE.TIP] После развертывания веб-службы ее можно обновить. Например, если требуется скорректировать модель, просто измените обучающий эксперимент, настройте параметры модели и нажмите кнопку **Развернуть веб-службу**. Затем выберите **Deploy Web Service [Classic]** (Развернуть веб-службу [классическую]) или **Deploy Web Service [New]** (Развернуть веб-службу [новую]). При повторном развертывании эксперимента он заменит веб-службу, используя на этот раз обновленную модель.


## Тестирование веб-службы

**Тестирование классической веб-службы** На странице **DASHBOARD** (Панель мониторинга) нажмите кнопку **Test** (Тестировать) в разделе **Default Endpoint** (Конечная точка по умолчанию). Появится диалоговое окно, где предлагается ввести входные данные для службы. Это те же столбцы, которые были в исходном немецком наборе данных для кредитного риска.

Введите набор данных и нажмите кнопку **ОК**.

Данные в веб-службу поступают через модуль **Web service input** (Входные данные веб-службы), проходят через модуль [Metadata Editor][metadata-editor] \(Редактор метаданных) и поступают в модуль [Score Model][score-model] \(Оценка модели). Затем результаты выводятся из веб-службы через модуль **Web service output** (Выходные данные веб-службы).

**Тестирование новой веб-службы**

На портале веб-служб машинного обучения Azure щелкните пункт меню **Test** (Тестировать) в верхней части страницы. Откроется страница "Test" (Тестирование), на которой можно ввести данные для службы. Отображенные поля ввода соответствуют столбцам, которые были в изначальном наборе данных по кредитным рискам для немецкого языка.

Введите набор данных и щелкните **Test Request-Response** (Тестировать "запрос-ответ").

Вы можете также добавить образец данных, который можно использовать для тестирования службы "запрос-ответ". Если вы создали веб-службу в Студии машинного обучения, то образец данных берется из данных, с помощью которых вы обучали модель.

Результаты теста отобразятся в правой части страницы, в столбце выходных данных.

> [AZURE.TIP] С нашими настройками прогнозного эксперимента возвращаются все результаты из модуля [Score Model][score-model] \(Оценка модели). Они включают все входные данные, а также значение кредитного риска и оценку вероятности. Если вы хотите возвращать другие результаты, например только значение кредитного риска, то можно вставить модуль [Project Columns][project-columns] \(Столбцы проекта) между модулями [Score Model][score-model] \(Оценка модели) и **Web service output** (Выходные данные веб-службы), чтобы исключить столбцы, которые не должны возвращаться веб-службой.

## Управление веб-службой

**Управление классической веб-службой**

После развертывания классической веб-службой можно управлять с помощью [классического портала Azure](https://manage.windowsazure.com).

1. Войдите на [классический портал Azure](https://manage.windowsazure.com).
2. На панели служб Microsoft Azure выберите **МАШИННОЕ ОБУЧЕНИЕ**.
3. Щелкните рабочую область.
4. Щелкните вкладку **ВЕБ-СЛУЖБЫ**.
5. Щелкните только что созданную веб-службу.
6. Щелкните конечную точку "по умолчанию".

Здесь можно отслеживать работу веб-службы и изменять настройки производительности путем изменения количества одновременных вызовов, которые может обрабатывать веб-служба. Вы можете даже опубликовать свою веб-службу в Azure Marketplace.

Дополнительные сведения см. в статье

- [Создание конечных точек](machine-learning-create-endpoint.md)
- [Масштабирование веб-службы](machine-learning-scaling-webservice.md)
- [Публикация веб-службы Машинного обучения Azure в Azure Marketplace](machine-learning-publish-web-service-to-azure-marketplace.md)

**Управление новой веб-службой**

После развертывания новой веб-службой можно управлять с помощью [портала веб-служб Машинного обучения Azure](https://servics.azureml.net).

Вот как можно отслеживать производительность веб-службы.
1. Войдите на [портал веб-служб Машинного обучения Azure](https://servics.azureml.net).
2. Щелкните **Web Services** (Веб-службы).
3. Щелкните свою веб-службу.
4. Щелкните **Dashboard** (Панель мониторинга).

----------

**Далее: [доступ к веб-службе](machine-learning-walkthrough-6-access-web-service.md)**

[1]: ./media/machine-learning-walkthrough-5-publish-web-service/publish1.png
[2]: ./media/machine-learning-walkthrough-5-publish-web-service/publish2.png
[3]: ./media/machine-learning-walkthrough-5-publish-web-service/publish3.png
[4]: ./media/machine-learning-walkthrough-5-publish-web-service/publish4.png
[5]: ./media/machine-learning-walkthrough-5-publish-web-service/publish5.png
[6]: ./media/machine-learning-walkthrough-5-publish-web-service/publish6.png


<!-- Module References -->
[evaluate-model]: https://msdn.microsoft.com/library/azure/927d65ac-3b50-4694-9903-20f6c1672089/
[execute-r-script]: https://msdn.microsoft.com/library/azure/30806023-392b-42e0-94d6-6b775a6e0fd5/
[metadata-editor]: https://msdn.microsoft.com/library/azure/370b6676-c11c-486f-bf73-35349f842a66/
[normalize-data]: https://msdn.microsoft.com/library/azure/986df333-6748-4b85-923d-871df70d6aaf/
[score-model]: https://msdn.microsoft.com/library/azure/401b4f92-e724-4d5a-be81-d5b0ff9bdb33/
[split]: https://msdn.microsoft.com/library/azure/70530644-c97a-4ab6-85f7-88bf30a8be5f/
[train-model]: https://msdn.microsoft.com/library/azure/5cc7053e-aa30-450d-96c0-dae4be720977/
[two-class-boosted-decision-tree]: https://msdn.microsoft.com/library/azure/e3c522f8-53d9-4829-8ea4-5c6a6b75330c/
[two-class-support-vector-machine]: https://msdn.microsoft.com/library/azure/12d8479b-74b4-4e67-b8de-d32867380e20/
[project-columns]: https://msdn.microsoft.com/ru-RU/library/azure/1ec722fa-b623-4e26-a44e-a50c6d726223/

<!---HONumber=AcomDC_0921_2016-->