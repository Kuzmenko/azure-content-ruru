<properties 
	pageTitle="Интерпретация результатов модели в машинном обучении | Microsoft Azure" 
	description="Выбор оптимального набора параметров для алгоритма с помощью наглядного представления результатов работы модели оценки." 
	services="machine-learning"
	documentationCenter="" 
	authors="bradsev" 
	manager="jhubbard" 
	editor="cgronlun"/>

<tags 
	ms.service="machine-learning" 
	ms.workload="data-services" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="09/12/2016" 
	ms.author="bradsev" />


# Интерпретация результатов модели в машинном обучении Azure 
 
**Трактовка и визуализация результатов "Оценки модели"**. В этой статье объясняется, как визуализировать и интерпретировать результаты прогнозирования в Студии машинного обучения Azure. После обучения модели и получения прогнозов на ее основе («оценки модели»), необходимо понять и интерпретировать полученный результат прогнозирования.

[AZURE.INCLUDE [machine-learning-free-trial](../../includes/machine-learning-free-trial.md)]

Существует четыре основных типа машинного обучения моделей в Студии машинного обучения Azure:

* классификация;
* кластеризация;
* регрессия;
* системы рекомендаций.

Наиболее часто используемые для прогнозирования («оценки») модули, которые формируют некоторые тестовые данные:

* модуль [Модель оценки][score-model] для классификации и регрессии;
* модуль [Назначить в кластеры][assign-to-clusters] для кластеризации;
* модуль [Подсистема Score Matchbox][score-matchbox-recommender] для систем рекомендаций.
 
В этом документе объясняется интерпретация результатов прогнозирования для каждого из этих модулей. Обзор такого рода моделей см. в разделе [Выбор параметров для оптимизации алгоритмов в машинном обучении Azure](machine-learning-algorithm-parameters-optimize.md).

В этом разделе рассматривается интерпретация прогноза, а не оценка модели. Дополнительные сведения об оценке модели см. в статье [Оценка эффективности модели в Машинном обучении Microsoft Azure](machine-learning-evaluate-model-performance.md).

Если вы не знакомы с машинным обучением Azure и вам нужна помощь по созданию простого эксперимента для начала работы, см. статью [Создание простого эксперимента в Студии машинного обучения Azure](machine-learning-create-experiment.md) в Студии машинного обучения Azure.

##Классификация
Существует две подкатегории задач классификации:

* задачи только с двумя классами (двухклассовая или двоичная классификация);
* задачи с более чем двумя классами (многоклассовая классификация).

В машинном обучении Azure для обработки каждого из этих типов классификации используются разные модули. Но способы интерпретации результатов их прогнозов похожи. Сначала мы рассмотрим двухклассовую классификацию, а затем перейдем к многоклассовой классификации.

###Двуклассовая классификация
**Пример эксперимента**

Пример проблемы двухклассовой классификации — классификация цветов ириса на основе их признаков. Набор данных Iris в Машинном обучении Azure является поднабором популярного [набора данных Iris](http://en.wikipedia.org/wiki/Iris_flower_data_set), содержащего экземпляры только двух видов цветов (классы 0 и 1). Для каждого цветка можно выделить четыре признака (длины чашелистика, ширина чашелистика, длина лепестка и ширина лепестка).

![screenshot\_of\_experiment](./media/machine-learning-interpret-model-results/1.png)

Рис. 1. Эксперимент задачи двухклассовой классификации цветков ириса

Эксперимент для решения этой задачи проведен, как показано на рис. 1. Модель повышенного дерева принятия решений двухклассовой классификации обучена и оценена. Теперь можно представить результаты прогноза модуля [Score Model][score-model] \(Оценка модели), щелкнув порт вывода модуля [Score Model][score-model] \(Оценка модели), а затем выбрав команду **Visualize** (Показать) в раскрывшемся меню. Это действие приводит к отображению результатов оценки, как показано на рис. 2.

![screenshot\_of\_experiment](./media/machine-learning-interpret-model-results/1_1.png)

![screenshot\_of\_experiment](./media/machine-learning-interpret-model-results/2.png)

Рис. 2. Представление результатов модели оценки в двухклассовой классификации

**Интерпретация результатов**

В таблице результатов представлены шесть столбцов. Четыре столбца слева соответствуют четырем признакам. Два правых столбца, «Метки оценки» и «Оценки вероятности» содержат результаты прогноза. Столбец «Оценки вероятности» показывает вероятность, что цветок принадлежит к положительному классу (1). Например, первое число 0,028571 в столбце означает, что с вероятностью 0,028571 первый цветок принадлежит классу 1. Столбец «Метки оценки» содержит прогнозируемый класс для каждого из цветков. Этот прогноз основывается на столбце оценки вероятности. Если оценка вероятности больше 0,5, прогнозируется принадлежность к классу 1, в противном случае — прогнозируется принадлежность к классу 0.

**Публикация в веб-службе**

Если результаты прогнозирования понятны и выглядят обоснованными, эксперимент можно опубликовать как веб-службу, чтобы его можно было развертывать в различных приложениях и вызывать для получения прогноза класса для любых новых цветов ириса. Процедуру изменения эксперимента обучения в эксперименте оценки и его публикации как веб-службы см. в разделе [Публикации веб-службы машинного обучения Azure](machine-learning-walkthrough-5-publish-web-service.md). Выполнив эту процедуру, можно получить эксперимент оценки, как показано на рис. 3.

![screenshot\_of\_experiment](./media/machine-learning-interpret-model-results/3.png)

Рис. 3 Эксперимент оценки в задаче двухклассовой классификации

Теперь необходимо задать входные и выходные данные для веб-службы. Очевидно, что входные данные — правый входной порт [Модели оценки][score-model], представляющий входные данные о признаках цветков ириса. Выбор выходных данных зависит от того, интересует ли нас прогнозируемый класс (метки оценки), оценка вероятности или оба значения сразу. Здесь предполагается, что нас интересуют оба значения. Чтобы выбрать нужные выходные столбцы, следует использовать модуль [Выбор столбцов в наборе данных][select-columns]. Щелкните модуль [Select Columns in Dataset][select-columns] \(Выбор столбцов в наборе данных), затем щелкните **Launch column selector** (Запустить средство выбора столбцов) на правой панели и выберите **Scored Labels** (Метки оценки) и **Scored Probabilities** (Оценки вероятности). После установки порта вывода модуля [Select Columns in Dataset][select-columns] \(Выбор столбцов в наборе данных) запустите его еще раз, чтобы получить возможность опубликовать оценивающий эксперимент как веб-службу, нажав кнопку **ОПУБЛИКОВАТЬ ВЕБ-СЛУЖБУ** внизу. Окончательный эксперимента выглядит как показано на рис. 4.
 
![screenshot\_of\_experiment](./media/machine-learning-interpret-model-results/4.png)

Рис. 4. Окончательный эксперимент оценки в задаче двухклассовой классификации цветков ириса

После запуска веб-службы и ввода значений некоторых признаков испытательного экземпляра, результат возвращает два числа. Первое число — это метка оценки, а второе — оценка вероятности. Этот цветов с вероятностью 0,9655 относится к классу 1.
 
![screenshot\_of\_experiment](./media/machine-learning-interpret-model-results/4_1.png)

![screenshot\_of\_experiment](./media/machine-learning-interpret-model-results/5.png)

Рис. 5. Результат двухклассовой классификации цветков ириса в веб-службе

###Многоклассовая классификация
**Пример эксперимента**

В этом эксперименте в качестве примера многоклассовой классификации выполняется задача распознавания букв. Классификатор пытается предсказать определенную букву (класс), учитывая некоторые значения атрибутов, извлеченных из изображений рукописных символов. В обучающих данных предусмотрено 16 признаков, извлеченных из изображений рукописных букв. Двадцать шесть букв образуют двадцать шесть классов. Эксперимент настроен для обучения модели многоклассовой классификации для распознавания букв и прогнозирования этого же набора признаков для тестового набора данных, как показано на рис. 6.

![screenshot\_of\_experiment](./media/machine-learning-interpret-model-results/5_1.png)
 
![screenshot\_of\_experiment](./media/machine-learning-interpret-model-results/6.png)

Рис. 6. Эксперимент распознавания букв в задаче многоклассовой классификации

Отобразите результаты модуля [Score Model][score-model] \(Оценка модели), щелкнув правой или левой кнопкой мыши порт вывода модуля [Score Model][score-model] \(Оценка модели) и выбрав команду **Visualize** (Показать); после этого должно открыться окно, как показано на рис. 7.
 
![screenshot\_of\_experiment](./media/machine-learning-interpret-model-results/7.png)

Рис. 7. Визуализация результата модели оценки в многоклассовой классификации

**Интерпретация результатов**

16 столбцов слева представляют значения признаков тестового набора. Столбцы с именами «Оценки вероятности для класса "XX"» — точно такие же, как и столбец оценки вероятности в случае двух классов. Они показывают вероятность того, что соответствующая запись будет принадлежать определенному классу. Например, первая запись с вероятностью 0,003571 принадлежит классу «А», с вероятностью 0,000451 принадлежит классу «B» и т. д. Последний столбец «Метки оценки» точно такой же, как и в случае двух классов. Класс с наибольшим показателем вероятности выбирается в качестве прогнозируемого класса соответствующей записи. Например, для первой записи меткой оценки является «F», так у нее наибольшая вероятность быть «F» (0,916995).

**Публикация в веб-службе**

На этот раз, вместо того, чтобы выбрать несколько столбцов в качестве выходных данных веб-службы с помощью модуля [Выбор столбцов в наборе данных][select-columns], мы бы хотели получить оцененную метку для каждой записи и оценку вероятности для метки. Задача состоит в нахождении наибольшей вероятности среди всех оценок вероятностей. Для этого необходимо использовать модуль [Выполнить сценарий R][execute-r-script]. Код R показан на рис. 8, а эксперимент показан на рис. 9.
 
![screenshot\_of\_experiment](./media/machine-learning-interpret-model-results/8.png)

Рис. 8. Код R для извлечения меток оцени и соответствующих вероятностей меток
  
![screenshot\_of\_experiment](./media/machine-learning-interpret-model-results/9.png)

Рис. 9. Окончательный эксперимент оценки распознавания букв в задаче многоклассовой классификации

После публикации и запуска веб-службы и ввода некоторых входных значений признаков, возвращаемый результат будет выглядеть, как показано на рис. 10. Эта рукописная буква согласно 16 извлеченным признакам будет буквой "T" с вероятностью 0,9715.
 
![screenshot\_of\_experiment](./media/machine-learning-interpret-model-results/9_1.png)

![screenshot\_of\_experiment](./media/machine-learning-interpret-model-results/10.png)

Рис. 10. Результат, возвращаемый веб-службой для двухклассовой классификации цветков ириса

##Регрессия

Регрессионная задача отличается от задачи классификации. В задаче классификации мы пытаемся прогнозировать дискретные классы, например, к какому классу принадлежит цветок ириса. Однако в регрессионной задаче мы пытаемся прогнозировать значение непрерывной переменной, например стоимость автомобиля, как показано в следующем примере.

**Пример эксперимента**

В нашем примере для регрессии мы используем прогноз стоимости автомобиля. Мы попытаемся спрогнозировать цену автомобиля в зависимости от его признаков, таких как год выпуска, тип топлива, тип кузова, типа привода и т. д. Этот эксперимент показан на рис. 11.
 
![screenshot\_of\_experiment](./media/machine-learning-interpret-model-results/11.png)

Рис. 11. Эксперимента регрессионной задачи для стоимости автомобиля

Результаты работы модуля [Оценка модели][score-model] показаны на рис. 12.
 
![screenshot\_of\_experiment](./media/machine-learning-interpret-model-results/12.png)

Рис. 12. Визуализация оценки результатов задачи прогноза стоимости автомобиля

**Интерпретация результатов**

В этом результате метки оценки представлены в результирующем столбце. Числа являются прогнозируемой стоимостью для каждого автомобиля.

**Публикация в веб-службе**

Мы можем опубликовать эксперимент регрессии в веб-службе и вызывать его для прогнозирования стоимости автомобиля так же, как в случае двухклассовой классификации.
 
![screenshot\_of\_experiment](./media/machine-learning-interpret-model-results/13.png)

Рис. 13. Эксперимент оценки в задаче регрессии для стоимости автомобиля

Выполняющаяся веб-служба возвращает результат, как показано на рис. 14. Прогнозируемая стоимость этого автомобиля — 15085,52.
 
![screenshot\_of\_experiment](./media/machine-learning-interpret-model-results/13_1.png)

![screenshot\_of\_experiment](./media/machine-learning-interpret-model-results/14.png)

Рис. 14. Результаты веб-службы в задаче регрессии для стоимости автомобиля

##Кластеризация

**Пример эксперимента**

Воспользуемся набором данных Iris еще раз для построения эксперимента кластеризации. Здесь мы отфильтровать метки классов в наборе данных, чтобы в них содержались только признаки и их можно было использовать для кластеризации. В этом примере набора данных Iris давайте укажем число кластеров в процессе обучения равным двум, что означает, что нам нужна кластеризация цветков на два класса. Этот эксперимент показан на рис. 15.
 
![screenshot\_of\_experiment](./media/machine-learning-interpret-model-results/15.png)

Рис. 15. Эксперимент задачи кластеризации в классификации цветков ириса

Кластеризация отличается от классификации тем, что набор обучающих данных не имеет естественных меток. Вместо этого нас интересует способы группирования набора обучающих данных по различным кластерам. В процессе обучения модель помечает записи по мере изучения различий между их признаками. После этого обученная модель используется в дальнейшем для классификации будущих записей. В задаче кластеризации нас интересуют результаты по двум направлениям. Первое — как пометить набор обучающих данных, а второе — как классифицировать новый набор данных с помощью обученной модели.

Первую часть результатов можно визуализировать, щелкнув левый порт вывода модуля [Train Clustering Model][train-clustering-model] \(Обучение модели кластеризации) и выбрав команду **Visualize** (Показать). Окно представления показано на рис. 16.
 
![screenshot\_of\_experiment](./media/machine-learning-interpret-model-results/16.png)

Рис. 16. Визуализация результатов кластеризации для набора обучающих данных

Вторая часть результатов, кластеризация новых записей с помощью обученной модели кластеризации, показана на рис. 17.
 
![screenshot\_of\_experiment](./media/machine-learning-interpret-model-results/17.png)

Рис. 17. Визуализация результата кластеризации нового набора данных

**Интерпретация результатов**

Несмотря на то, что результаты по обоим направлениям получены на различных этапах эксперимента, они выглядят похожими и интерпретируются похожим образом. Первые четыре столбца — это признаки. Последний столбец, «Назначения» является результатов прогнозирования. Записи с одинаковыми числами согласно прогнозу попадают в тот же кластер, т. е. у них есть определенные сходства (в этом эксперименте использовалась стандартная метрика расстояния для Евклидова пространства). Напоминаем, что мы указали число кластеров, равное 2. Поэтому в столбце «Назначения» записи помечены как 0 или 1.

**Публикация в веб-службе**

Мы можем опубликовать эксперимент кластеризации в веб-службе и вызывать его для прогнозирования кластеризации так же, как и в случае двухклассовой классификации.
 
![screenshot\_of\_experiment](./media/machine-learning-interpret-model-results/18.png)

Рис. 18. Эксперимент оценки задачи кластеризации набора данных Iris

Выполняющаяся веб-служба возвращает результат, как показано на рис. 19. Согласно прогнозу этот цветок относится к кластеру 0.
 
![screenshot\_of\_experiment](./media/machine-learning-interpret-model-results/18_1.png)

![screenshot\_of\_experiment](./media/machine-learning-interpret-model-results/19.png)

Рис. 19. Результат, возвращаемый веб-службой для двухклассовой классификации цветков ириса

##Системы рекомендаций
**Пример эксперимента**

Для системы рекомендаций в качестве примера мы рассмотрим задачу рекомендации ресторана: рекомендовать рестораны для клиентов на основе истории их оценок. Входные данные делятся на три части:

* клиентские оценки ресторанов;
* данные признака клиентов;
* данные признака ресторанов.

С помощью встроенного модуля машинного обучения Azure [Обучение системы Matchbox Recommender][train-matchbox-recommender] можно выполнять несколько задач:

- прогнозировать оценки для данного пользователя и объекта;
- рекомендовать объект данному пользователю;
- искать пользователей, связанных с данным пользователем;
- искать объекты, связанные с данным объектом.

Нужную задачу можно выбрать в меню **Тип прогнозирования системы рекомендаций** на правой панели. Здесь мы рассмотрим все четыре сценария. Типичный эксперимента машинного обучения Azure для системы рекомендаций выглядит, как показано на рис. 20. Дополнительную информацию об использовании этих модулей системы рекомендаций см. на странице справки в статьях [Обучение модели рекомендаций Matchbox][train-matchbox-recommender] и [Подсистема Score Matchbox][score-matchbox-recommender].
 
![screenshot\_of\_experiment](./media/machine-learning-interpret-model-results/19_1.png)

![screenshot\_of\_experiment](./media/machine-learning-interpret-model-results/20.png)

Рис. 20 Эксперимент с системой рекомендаций

**Интерпретация результатов**

*Прогноз оценки для данного пользователя и объекта*

Выбрав прогноз оценки в меню **Тип прогноза системы рекомендаций**, мы узнаем у системы рекомендаций прогноз оценки для данного пользователя и объекта. Визуализация результатов работы модуля [Подсистема Score Matchbox][score-matchbox-recommender] показана на рис. 21.
 
![screenshot\_of\_experiment](./media/machine-learning-interpret-model-results/21.png)

Рис. 21. Визуализация результатов оценки системы рекомендаций. Прогноз оценки

Здесь доступны три столбца. Первые два столбца — это пары пользователь-объект, представленные во входных данных. Третий столбец является прогнозируемой оценкой пользователя для определенного объекта. Например в первой строке клиент U1048 вероятно даст ресторану 135026 оценку 2.

*Рекомендация объекта данному пользователю*

Выбрав **Рекомендация объекта** в меню **Тип прогноза системы рекомендаций**, мы узнаем у системы рекомендаций рекомендуемый объект для данного пользователя. В этом сценарии необходимо выбрать еще один параметр, «Выбор рекомендуемого объекта». Параметр **Из оцененных объектов (для оценки модели)** в первую очередь нужен для оценки модели в процессе обучения. На данном этапе прогноза мы выбираем **From All Items** (Из всех элементов). Визуализация результатов модуля [Подсистема Score Matchbox][score-matchbox-recommender] показана на рис. 22.
 
![screenshot\_of\_experiment](./media/machine-learning-interpret-model-results/22.png)

Рис. 22. Визуализация результатов оценки системы рекомендаций. Рекомендация объекта

Здесь доступны шесть столбцов. Первый столбец содержит идентификаторы рекомендованных пользователем объектов, представленные во входных данных. Остальные пять столбцов содержат объекты, рекомендуемые пользователю, в порядке убывания релевантности. Например, в первой строке наиболее рекомендуемым рестораном для клиента U1048 является 134986, за которым следует 135018, 134975, 135021 и затем 132862.

*Поиск пользователей, связанных с данным пользователем*

Выбрав в меню «Тип прогноза системы рекомендаций» «Связанные пользователи», мы узнаем у системы рекомендаций пользователей, связанных с данным пользователем. Связанными пользователями являются пользователи с аналогичными параметрами. Существует еще один параметр, который необходимо выбрать в этом сценарии, «Выбор соответствующего пользователя». Параметр «Из пользователей. оценивших объекты (для оценки модели)» в первую очередь нужен для оценки модели в процессе обучения. На данном этапе прогнозирования мы выбираем «Из всех пользователей». Визуализация результатов модуля [Подсистема Score Matchbox][score-matchbox-recommender] показана на рис. 23.
 
![screenshot\_of\_experiment](./media/machine-learning-interpret-model-results/23.png)

Рис. 23. Визуализация результатов оценки системы рекомендаций. Связанные пользователи

Здесь доступны шесть столбцов. Первый столбец содержит идентификаторы для поиска связанных с этим пользователем пользователей, полученные из входных данных. Остальные пять столбцов содержат прогнозируемых связанных с пользователем пользователей, в порядке убывания релевантности. Например, в первой строке наиболее соответствующим клиентом для клиента U1048 является U1051, за ним следуют U1066, U1044, U1017 и затем U1072.

**Поиск объектов, связанных с данным объектом**

Выбрав **Связанные объекты** в меню **Тип прогноза системы рекомендаций**, мы узнаем у системы рекомендаций объекты, связанные с данным объектом. Связанные объекты — это те объекты, которые скорее всего понравятся тем же пользователям. Существует еще один параметр, который необходимо выбрать в этом сценарии, «Выбор соответствующего объекта». Параметр **Из оцененных объектов (для оценки модели)** в первую очередь нужен для оценки модели в процессе обучения. Мы выбираем **из всех элементов** на данном этапе прогноза. Визуализация результатов модуля [Подсистема Score Matchbox][score-matchbox-recommender] показана на рис. 24.
 
![screenshot\_of\_experiment](./media/machine-learning-interpret-model-results/24.png)

Рис. 24. Визуализация результатов оценки системы рекомендаций. Связанные объекты

Здесь доступны шесть столбцов. Первый столбец представляет идентификаторы данного объекта для поиска связанных объектов, полученные из входных данных. Пять других столбцов содержат прогнозируемые объекты, связанные с данным объектом, в порядке убывания релевантности. Например, в первой строке, наиболее соответствующим объектом для объекта 135026 является объект 135074, за которым следуют 135035, 132875, 135055 и 134992. Публикация в веб-службе

Процесс публикации этих экспериментов как веб-служб для получения прогнозов аналогичен для каждого из четырех сценариев. Здесь в качестве примера мы используем второй сценарий, в котором объекты рекомендуются данному пользователю. Ту же процедуру необходимо повторить и для трех остальных сценариев.

Сохранив обученную систему рекомендаций как обученную модели, фильтруя входные данные в столбце для одного идентификатора пользователя по запросу, мы можем подключить эксперимент, как показано на рис. 25, и опубликовать его как веб-службу.

![screenshot\_of\_experiment](./media/machine-learning-interpret-model-results/25.png)
 
Рис. 25. Эксперимент оценки в задаче рекомендации ресторана

Выполняющаяся веб-служба возвращает результат, как показано на рис. 14. Пять ресторанов рекомендуются для пользователя U1048 — 134986, 135018, 134975, 135021 и 132862.
 
![screenshot\_of\_experiment](./media/machine-learning-interpret-model-results/25_1.png)

![screenshot\_of\_experiment](./media/machine-learning-interpret-model-results/26.png)

Рис. 26. Результаты веб-службы для задачи рекомендации ресторана


<!-- Module References -->
[assign-to-clusters]: https://msdn.microsoft.com/library/azure/eed3ee76-e8aa-46e6-907c-9ca767f5c114/
[execute-r-script]: https://msdn.microsoft.com/library/azure/30806023-392b-42e0-94d6-6b775a6e0fd5/
[select-columns]: https://msdn.microsoft.com/library/azure/1ec722fa-b623-4e26-a44e-a50c6d726223/
[score-matchbox-recommender]: https://msdn.microsoft.com/library/azure/55544522-9a10-44bd-884f-9a91a9cec2cd/
[score-model]: https://msdn.microsoft.com/library/azure/401b4f92-e724-4d5a-be81-d5b0ff9bdb33/
[train-clustering-model]: https://msdn.microsoft.com/library/azure/bb43c744-f7fa-41d0-ae67-74ae75da3ffd/
[train-matchbox-recommender]: https://msdn.microsoft.com/library/azure/fa4aa69d-2f1c-4ba4-ad5f-90ea3a515b4c/
 

<!---HONumber=AcomDC_0914_2016-->