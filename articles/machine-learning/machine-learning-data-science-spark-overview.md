<properties
	pageTitle="Обзор обработки и анализа данных с помощью платформы Spark в Azure HDInsight | Microsoft Azure"
	description="Набор средств Spark MLlib предоставляет широкие возможности моделирования машинного обучения в распределенной среде HDInsight."
	services="machine-learning"
	documentationCenter=""
	authors="bradsev"
	manager="jhubbard"
	editor="cgronlun"  />

<tags
	ms.service="machine-learning"
	ms.workload="data-services"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="06/14/2016"
	ms.author="deguhath;bradsev;gokuma" />

# Общие сведения об обработке и анализе данных с помощью платформы Spark в Azure HDInsight

[AZURE.INCLUDE [machine-learning-spark-modeling](../../includes/machine-learning-spark-modeling.md)]

В этой группе статей рассказывается, как использовать HDInsight Spark для выполнения общих задач обработки и анализа данных, таких как прием данных, проектирование функций, моделирование и оценка моделей. В качестве данных используется пример с числом поездок и тарифами нью-йоркского такси за 2013 год. Мы использовали такие модели, как логистическая и линейная регрессия, случайные леса и увеличивающиеся деревья принятия решений. Кроме того, в этих статьях рассказывается, как хранить эти модели в хранилище BLOB-объектов Azure (WASB), а также оценивать и анализировать прогнозируемую производительность. В более расширенных разделах рассматриваются способы обучения моделей с помощью перекрестной проверки и корректировки гиперпараметров. В обзорной статье описывается также процедура настройки кластера Spark, необходимая для выполнения действий, описанных в трех указанных руководствах.

[Spark](http://spark.apache.org/) — это платформа параллельной обработки с открытым исходным кодом, которая поддерживает обработку в памяти, повышая производительность приложений для анализа больших данных. Подсистема обработки Spark призвана ускорить разработку, повысить удобство использования и реализовать сложную аналитику. Возможности распределенного вычисления в памяти Spark отлично подходят для итеративных алгоритмов в машинном обучении и графовых вычислениях. [MLlib](http://spark.apache.org/mllib/) — это масштабируемая библиотека машинного обучения Spark, которая предоставляет возможности моделирования для этой распределенной среды.

[HDInsight Spark](../hdinsight/hdinsight-apache-spark-overview.md) представляет собой версию платформы Spark с открытым исходным кодом, размещенную в Azure. Он также поддерживает **записные книжки Jupyter PySpark** в кластере Spark, которые могут выполнять интерактивные запросы Spark SQL для преобразования, фильтрации и визуализации данных, хранящихся в больших двоичных объектах Azure (WASB). PySpark — это API Python для Spark. Здесь фрагменты кода, которые предоставляют решения и формируют соответствующие графики с целью визуализации данных, выполняются в записных книжках Jupyter, установленных в кластерах Spark. Этапы моделирования, описанные в этих разделах, содержат код, который демонстрирует способ обучения, анализа, сохранения и использования каждого типа модели.

Действия по настройке и код, указанные в этом пошаговом руководстве, предназначены для HDInsight 3.4 Spark 1.6. Однако код здесь и в записных книжках является универсальным и должен работать в любом кластере Spark. Действия по настройке кластера и управлению им могут немного отличаться от приведенных здесь, если вы не используете HDInsight Spark.

## Предварительные требования

1\. Для изучения этих разделов необходимо иметь подписку Azure. Если у вас ее нет, см. раздел [о получении бесплатной пробной версии Azure](https://azure.microsoft.com/documentation/videos/get-azure-free-trial-for-testing-hadoop-in-hdinsight/).

2\. Для выполнения инструкций этого руководства требуется кластер HDInsight 3.4 Spark 1.6. Создайте его, выполнив инструкции в статье [Начало работы: создание кластера Apache Spark в Azure HDInsight](../hdinsight/hdinsight-apache-spark-jupyter-spark-sql.md). Тип и версию кластера можно указать с помощью меню **Выбор типа кластера**.


![](./media/machine-learning-data-science-spark-overview/spark-cluster-on-portal.png)

<!-- -->

> [AZURE.NOTE] О том, как использовать Scala вместо Python для выполнения задач по полной обработке и анализу данных, см. в статье [Обработка и анализ данных с использованием Scala и Spark в Azure](machine-learning-data-science-process-scala-walkthrough.md).

<!-- -->

>[AZURE.INCLUDE [delete-cluster-warning](../../includes/hdinsight-delete-cluster-warning.md)]


## Данные о такси в Нью-Йорке, 2013 г.

Сведения о поездках на такси в Нью-Йорке заключены в сжатые файлы данных с разделителями-запятыми (CSV) объемом около 20 ГБ (~48 ГБ без сжатия), которые содержат более 173 миллионов записей о поездках и о стоимости каждой из них. Каждая запись о поездке содержит расположение пунктов отправления и назначения и время, анонимизированный номер лицензии водителя и номер медальона (уникальный идентификатор такси). Данные включают в себя все поездки за 2013 год и предоставляются в виде следующих двух наборов данных за каждый месяц:

1. В CSV-файлах trip\_data содержатся сведения о поездках, например количество пассажиров, места посадки и высадки, продолжительность и дальность поездок. Вот несколько примеров записей:

		medallion,hack_license,vendor_id,rate_code,store_and_fwd_flag,pickup_datetime,dropoff_datetime,passenger_count,trip_time_in_secs,trip_distance,pickup_longitude,pickup_latitude,dropoff_longitude,dropoff_latitude
		89D227B655E5C82AECF13C3F540D4CF4,BA96DE419E711691B9445D6A6307C170,CMT,1,N,2013-01-01 15:11:48,2013-01-01 15:18:10,4,382,1.00,-73.978165,40.757977,-73.989838,40.751171
		0BD7C8F5BA12B88E0B67BED28BEA73D8,9FD8F69F0804BDB5549F40E9DA1BE472,CMT,1,N,2013-01-06 00:18:35,2013-01-06 00:22:54,1,259,1.50,-74.006683,40.731781,-73.994499,40.75066
		0BD7C8F5BA12B88E0B67BED28BEA73D8,9FD8F69F0804BDB5549F40E9DA1BE472,CMT,1,N,2013-01-05 18:49:41,2013-01-05 18:54:23,1,282,1.10,-74.004707,40.73777,-74.009834,40.726002
		DFD2202EE08F7A8DC9A57B02ACB81FE2,51EE87E3205C985EF8431D850C786310,CMT,1,N,2013-01-07 23:54:15,2013-01-07 23:58:20,2,244,.70,-73.974602,40.759945,-73.984734,40.759388
		DFD2202EE08F7A8DC9A57B02ACB81FE2,51EE87E3205C985EF8431D850C786310,CMT,1,N,2013-01-07 23:25:03,2013-01-07 23:34:24,1,560,2.10,-73.97625,40.748528,-74.002586,40.747868

2. В CSV-файлах trip\_fare содержатся сведения о плате за каждую поездку, например тип оплаты, стоимость поездки, добавочная стоимость и налоги, чаевые и специальные тарифы, а также общая сумма оплаты. Вот несколько примеров записей:

		medallion, hack_license, vendor_id, pickup_datetime, payment_type, fare_amount, surcharge, mta_tax, tip_amount, tolls_amount, total_amount
		89D227B655E5C82AECF13C3F540D4CF4,BA96DE419E711691B9445D6A6307C170,CMT,2013-01-01 15:11:48,CSH,6.5,0,0.5,0,0,7
		0BD7C8F5BA12B88E0B67BED28BEA73D8,9FD8F69F0804BDB5549F40E9DA1BE472,CMT,2013-01-06 00:18:35,CSH,6,0.5,0.5,0,0,7
		0BD7C8F5BA12B88E0B67BED28BEA73D8,9FD8F69F0804BDB5549F40E9DA1BE472,CMT,2013-01-05 18:49:41,CSH,5.5,1,0.5,0,0,7
		DFD2202EE08F7A8DC9A57B02ACB81FE2,51EE87E3205C985EF8431D850C786310,CMT,2013-01-07 23:54:15,CSH,5,0.5,0.5,0,0,6
		DFD2202EE08F7A8DC9A57B02ACB81FE2,51EE87E3205C985EF8431D850C786310,CMT,2013-01-07 23:25:03,CSH,9.5,0.5,0.5,0,0,10.5


Уникальный ключ для соединения trip\_data и trip\_fare состоит из полей: medallion, hack\_licence и pickup\_datetime.


Мы взяли образец этих файлов размером 0,1 % и объединили их в один набор данных, который будет использоваться в качестве входного набора данных для этого пошагового руководства. Уникальный ключ для соединения trip\_data и trip\_fare состоит из полей: medallion, hack\_licence и pickup\_datetime. Каждая запись набора данных содержит следующие атрибуты, представляющие поездку на такси в Нью-Йорке:


|Поле| Краткое описание
|------|---------------------------------
| medallion |Обезличенный медальон такси (уникальный идентификатор такси)
| hack\_license |	Обезличенный номер лицензии такси
| vendor\_id |	Идентификатор поставщика услуг такси
| rate\_code | Тариф на такси в Нью-Йорке
| store\_and\_fwd\_flag | Отметка записи и дальнейшей передачи
| pickup\_datetime |	Дата и время посадки пассажира
| dropoff\_datetime | Дата и время высадки пассажира
| pickup\_hour |	Час посадки пассажира
| pickup\_week |	Неделя посадки пассажира
| weekday |	День недели (диапазон 1–7)
| passenger\_count |	Количество пассажиров во время поездки на такси
| trip\_time\_in\_secs | Длительность поездки в секундах
| trip\_distance | Расстояние поездки в милях
| pickup\_longitude | Долгота посадки пассажира
| pickup\_latitude |	Широта посадки пассажира
| dropoff\_longitude | Долгота высадки пассажира
| dropoff\_latitude | Широта высадки пассажира
| direct\_distance |	Расстояние по прямой между местом посадки и местом высадки
| payment\_type | Тип оплаты (наличные, кредитная карта и т. д.)
| fare\_amount | Сумма к оплате
| surcharge | Доплата
| mta\_tax |	Налог MTA
| tip\_amount | Сумма чаевых
| tolls\_amount | Дорожные пошлины
| total\_amount | Общая сумма
| tipped | Чаевые (0 — нет, 1 — да)
| tip\_class | Класс чаевых (0: 0 долларов, 1: 0–5 долларов, 2: 6–10 долларов, 3: 11–20 долларов, 4: >20 долларов)


## Выполнение кода из записной книжки Jupyter в кластере Spark 

Записную книжку Jupyter можно запустить с портала Azure. Найдите кластер Spark на панели мониторинга и щелкните ее, чтобы войти на страницу управления кластером. Последовательно выберите **Панели мониторинга кластера** > **Записная книжка Jupyter**, чтобы открыть записную книжку, связанную с кластером Spark.

![](./media/machine-learning-data-science-spark-overview/spark-jupyter-on-portal.png)

Для доступа к записным книжкам Jupyter также можно перейти по ссылке ***https://CLUSTERNAME.azurehdinsight.net/jupyter***. Просто замените фрагмент CLUSTERNAME в URL-адресе на имя собственного кластера. Для доступа к записным книжкам необходим пароль к учетной записи администратора.

![](./media/machine-learning-data-science-spark-overview/spark-jupyter-notebook.png)

Выберите PySpark, чтобы открыть каталог, содержащий несколько примеров предварительно упакованных записных книжек с использованием API PySpark. Записные книжки, содержащие примеры кода для этой группы статьей о Spark, доступны на сайте [Github](https://github.com/Azure/Azure-MachineLearning-DataScience/tree/master/Misc/Spark/pySpark).


Записные книжки можно отправить непосредственно из Github на сервер записных книжек Jupyter в кластере Spark. На домашней странице записной книжки Jupyter в правой части экрана нажмите кнопку **Отправить**. Откроется обозреватель файлов. Здесь вы можете вставить URL-адрес Github (необработанное содержимое) для записной книжки и нажать кнопку **Открыть**. Записные книжки PySpark доступны по следующим URL-адресам:

1.	[pySpark-machine-learning-data-science-spark-data-exploration-modeling.ipynb](https://github.com/Azure/Azure-MachineLearning-DataScience/blob/master/Misc/Spark/pySpark/pySpark-machine-learning-data-science-spark-data-exploration-modeling.ipynb)
2.	[pySpark-machine-learning-data-science-spark-model-consumption.ipynb](https://github.com/Azure/Azure-MachineLearning-DataScience/blob/master/Misc/Spark/pySpark/pySpark-machine-learning-data-science-spark-model-consumption.ipynb)
3.	[pySpark-machine-learning-data-science-spark-advanced-data-exploration-modeling.ipynb](https://github.com/Azure/Azure-MachineLearning-DataScience/blob/master/Misc/Spark/pySpark/pySpark-machine-learning-data-science-spark-advanced-data-exploration-modeling.ipynb)

В списке файлов Jupyter отобразится имя файла с кнопкой **Отправить**. Нажмите кнопку **Отправить**. Записная книжка импортирована. Повторите эти действия для отправки следующих записных книжек из этого пошагового руководства.

> [AZURE.TIP] Вы можете щелкнуть приведенные ниже ссылки правой кнопкой мыши в браузере и выбрать команду **Копировать ссылку**, чтобы получить URL-адрес необработанного содержимого Github, который можно вставить в диалоговое окно отправки в Jupyter в проводнике.

Теперь вы можете:

- щелкнуть записную книжку, чтобы просмотреть код;
- выполнить каждую ячейку нажатием клавиш **SHIFT+ВВОД**;
- выполнить всю записную книжку, последовательно щелкнув элементы **Ячейка** -> **Выполнить**.
- Использование автоматической визуализации запросов

> [AZURE.TIP] Ядро Pyspark автоматически визуализирует выходные данные запросов SQL (HiveQL). С помощью кнопок в меню **Тип** в записной книжке можно выбрать один из нескольких типов визуализации (таблица либо круговая, линейная, комбинированная или столбчатая диаграмма):

![Кривая ROC логистической регрессии для универсального подхода](./media/machine-learning-data-science-spark-overview/pyspark-jupyter-autovisualization.png)

## Что дальше?

Теперь, когда вы настроили кластер HDInsight Spark и отправили записные книжки Jupyter, все готово для работы с разделами, соответствующими этим трем записным книжкам PySpark. В них показано, как исследовать данные, а также создавать и использовать модели. С помощью записной книжки по расширенному исследованию и моделированию данных можно более подробно ознакомиться с тем, как использовать перекрестную проверку, очистку гиперпараметров и оценку модели.

**Исследование и моделирование данных с помощью Spark**. Исследуйте набор данных и создайте модели машинного обучения для оценки и анализа, выполнив инструкции из статьи, посвященной [созданию моделей двоичной классификации и регрессии для данных с помощью набора средств Spark MLlib](machine-learning-data-science-spark-data-exploration-modeling.md).

**Использование модели**. Дополнительные сведения об оценке моделей классификации и регрессии, созданных в этой статье, см. в статье [Оценка моделей машинного обучения, созданных с помощью Spark](machine-learning-data-science-spark-model-consumption.md).

**Перекрестная проверка и очистка гиперпараметров**. Сведения об обучении моделей с помощью перекрестной проверки и очистки гиперпараметров см. в статье [Расширенное исследование и моделирование данных с помощью Spark](machine-learning-data-science-spark-advanced-data-exploration-modeling.md).

<!---HONumber=AcomDC_0921_2016-->