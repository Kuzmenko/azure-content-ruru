<properties 
	pageTitle="Хранилища и хранение данных в Application Insights" 
	description="Заявление о политике хранении и конфиденциальности" 
	services="application-insights" 
    documentationCenter=""
	authors="alancameronwills" 
	manager="douge"/>

<tags 
	ms.service="application-insights" 
	ms.workload="tbd" 
	ms.tgt_pltfrm="ibiza" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="05/17/2016" 
	ms.author="awills"/>

# Сбор и хранение данных в Application Insights 

*Доступна только предварительная версия Application Insights.*

После установки в приложение пакет SDK [Visual Studio Application Insights][start] отправляет телеметрические данные о приложении в облако. Естественно, ответственные разработчики хотят знать, какие именно данные отправляются, что с ними происходит и как ими управлять. В частности, возникают следующие вопросы: можно ли отправлять конфиденциальные данные, где они хранятся и насколько это безопасно?


Ответ прост.

* Для отправки конфиденциальных данных в службу лучше не использовать телеметрические модули со стандартными настройками. Телеметрия включает метрики нагрузки, производительности и использования, отчеты об исключениях и другие диагностические данные. Основными пользовательскими данными, которые отображаются в диагностических отчетах, являются URL-адреса. Однако приложение в любом случае не должно помещать конфиденциальные данные в URL-адрес в виде обычного текста.
* Можно написать код, который будет отправлять дополнительные пользовательские телеметрические данные для диагностики и мониторинга (эта расширяемость — одна из полезных возможностей Application Insights). По ошибке код может включать в себя личные и другие конфиденциальные данные. Если приложение работает с такими данными, следует тщательно проверять весь написанный код.
* При разработке и тестировании приложения можно легко проверить, какие именно данные отправляются с помощью пакета SDK. Данные отображаются в окнах вывода отладочных данных IDE и браузера.
* Данные хранятся на серверах [Microsoft Azure](http://azure.com) в США. (При этом ваше приложение может выполняться где угодно.) Azure предоставляет [надежные процедуры обеспечения безопасности и соответствует целому ряду стандартов](https://azure.microsoft.com/support/trust-center/). Доступ к данным будет только у вас и вашей команды. Сотрудникам Майкрософт может предоставляться ограниченный доступ к данным только при определенных условиях и с вашего ведома. Данные шифруются при передаче, а не на серверах.

Далее в статье эта тема рассматривается более подробно. Эта статья содержит все необходимые сведения, поэтому вы можете показывать ее коллегам, которые не работают непосредственно с вами.


## Что такое Azure Application Insights?

[Visual Studio Application Insights][start] — это служба Майкрософт, которая помогает повысить производительность и удобство использования работающего приложения. Она отслеживает приложение на протяжении всего времени его работы: как на этапе тестирования, так и после публикации или развертывания. Application Insights создает диаграммы и таблицы, которые могут отображать различные данные: например, в какое время дня у вас наибольшее число пользователей, насколько быстро приложение отвечает на запросы и насколько хорошо оно обслуживается внешними службами, от которых зависит. В случае сбоев, ошибок или проблем с производительностью можно более детально просмотреть телеметрические данные, чтобы определить причину проблемы. Кроме этого, в случае каких-либо изменений в доступности и производительности приложения служба будет отправлять вам по электронной почте соответствующие уведомления.

Чтобы использовать эту возможность, установите в приложение пакет SDK Application Insights, который интегрируется с кодом приложения. Когда приложение запущено, пакет SDK отслеживает его работу и отправляет телеметрические данные в службу Application Insights. Это облачная служба, размещенная в [Microsoft Azure](http://azure.com). (Application Insights работает для любых приложений, а не только тех, которые размещены в Azure.)

![Пакет SDK в приложении отправляет телеметрические данные в службу Application Insights.](./media/app-insights-data-retention-privacy/01-scheme.png)

Служба Application Insights хранит и анализирует телеметрические данные. Для просмотра результатов анализа или поиска в сохраненных телеметрических данных войдите в учетную запись Azure и откройте в окне приложения ресурс Application Insights. Доступ к данным также можно предоставить другим участникам команды или определенным подписчикам Azure.

Данные можно экспортировать из службы Application Insights — к примеру, в базу данных или на внешние устройства. Каждому устройству можно назначить специальный ключ, предоставляемый службой. При необходимости ключ можно отменить.

Пакеты SDK Application Insights доступны для разных типов приложений: веб-служб, размещенных на ваших собственных серверах J2EE или ASP.NET или в Azure, веб-клиентов (то есть кода, выполняемого на веб-странице), классических приложений и служб, а также приложений для устройств (например, Windows Phone, iOS и Android). Все они отправляют телеметрические данные в одну и ту же службу.

## Какие данные собираются?

### Как собираются данные?

Есть три источника данных:

* Пакет SDK, который вы интегрируете в свое приложение [во время разработки](app-insights-asp-net.md) или [в среде выполнения](app-insights-monitor-performance-live-website-now.md). Существуют разные пакеты SDK для различных типов приложений. Также есть [пакет SDK для веб-страниц](app-insights-javascript.md), который загружается в браузер конечного пользователя вместе со страницей.

 * В каждый пакет SDK входит ряд [модулей](app-insights-configuration-with-applicationinsights-config.md), которые используют различные методики для сбора разных типов телеметрических данных.
 * Если пакет SDK устанавливается на этапе разработки, для отправки собственных телеметрических данных, помимо стандартных модулей, можно использовать API. Такая пользовательские телеметрические данные могут включать все данные, которые требуется отправить.
* На некоторых веб-серверах также установлены агенты, которые работают вместе с приложениями и отправляют телеметрические данные о ЦП, памяти и загрузке сети. Например, такие агенты могут быть установлены на виртуальных машинах Azure, узлах Docker и [серверах J2EE](app-insights-java-agent.md).
* [Тесты доступности](app-insights-monitor-web-app-availability.md) — это процессы, выполняемые компанией Майкрософт, которые отправляют запросы к веб-приложению через одинаковые интервалы. Результаты отправляются в службу Application Insights.

### Какие типы данных собираются?

Вот основные категории данных.

* [Телеметрия веб-сервера](app-insights-asp-net.md): HTTP-запросы. URI, время обработки запроса, код ответа, IP-адрес клиента. Идентификатор сеанса.
* [Веб-страницы](app-insights-javascript.md): количество страниц, пользователей и сеансов. Время загрузки страницы. Исключения. Вызовы AJAX.
* Счетчики производительности: загрузка памяти, ЦП, сети, количество операций ввода-вывода.
* Контекст клиента и сервера: ОС, языковой стандарт, тип устройства, браузер и разрешение экрана.
* [Исключения](app-insights-asp-net-exceptions.md) и сбои: **дампы стека**, идентификатор сборки и тип процессора.
* [Зависимости](app-insights-asp-net-dependencies.md): вызовы внешних служб, например REST, SQL и AJAX. URI или строка подключения, длительность, успешное выполнение, команда.
* [Тесты доступности](app-insights-monitor-web-app-availability.md): длительность теста и его шагов, ответы.
* [Журналы трассировки](app-insights-search-diagnostic-logs.md) и [пользовательская телеметрия](app-insights-api-custom-events-metrics.md): **все данные, которые кодируются в журналы или телеметрию**.

[Дополнительные сведения](#data-sent-by-application-insights).

## Как проверить, какие именно данные собираются?

Если приложение разрабатывается в Visual Studio, запустите приложение в режиме отладки (F5). Телеметрические данные появятся в окне вывода. Оттуда их можно скопировать, отформатировать как файл JSON и быстро проверить.

![](./media/app-insights-data-retention-privacy/06-vs.png)

В окне диагностики также есть более удобное для чтения представление.

В случае с веб-страницами, откройте окно отладки в браузере.

![Нажмите клавишу F12 и откройте вкладку «Сеть».](./media/app-insights-data-retention-privacy/08-browser.png)

### Можно ли написать код, чтобы отфильтровать телеметрические данные перед отправкой?

Можно написать [подключаемый модуль обработчика телеметрических данных](app-insights-api-filtering-sampling.md).



## Как долго хранятся данные? 

Необработанные точки данных (элементы, которые можно проверить с помощью поиска по журналу диагностики) хранятся в течение 7 дней. Если требуется хранить данные дольше, можно использовать [непрерывный экспорт](app-insights-export-telemetry.md), чтобы копировать их в учетную запись хранения.

Объединенные данные (то есть счетчики, средние значения и другие статистические данные, которые отображаются в обозревателе метрик) сохраняются со степенью детализации 1 минута в течение 30 дней, а со степенью детализации 1 час или 1 день (в зависимости от типа) — по крайней мере 90 дней.


## Кто может получить доступ к данным?

Данные видны вам и, если у вас есть учетная запись организации, членам вашей группы.

Вы и члены группы могут их экспортировать и скопировать в другое место, а также передать другим пользователям.

#### Что корпорация Майкрософт делает с данными, которые мое приложение отправляет службе Application Insights?

Корпорация Майкрософт использует данные только для предоставления вам возможностей службы.


## Где хранятся данные? 

* В США.

#### Можно ли хранить данные в другом регионе, например в Европе? 

* В настоящее время нет.

#### Значит ли это, что мое приложение должно размещаться в США?

* Нет. Ваше приложение может выполняться где угодно, будь то ваш собственный локальный узел или облако.

## Насколько защищены мои данные?  

Application Insights — это служба Azure в режиме предварительного просмотра. В режиме предварительного просмотра мы стараемся защитить ваши данные в соответствии с политиками, описанными в техническом документе [Безопасность, конфиденциальность и соответствие требованиям Azure](http://go.microsoft.com/fwlink/?linkid=392408).


Данные хранятся на серверах Microsoft Azure. Ограничения для учетных записей на портале Azure описаны в документе [Безопасность, конфиденциальность и соответствие нормативам Azure](http://go.microsoft.com/fwlink/?linkid=392408). Для учетных записей портала Visual Studio Team Services действует документ [Защита данных Visual Studio Team Services](http://download.microsoft.com/download/8/E/E/8EE6A61C-44C2-4F81-B870-A267F1DF978C/MicrosoftVisualStudioOnlineDataProtection.pdf).

Доступ к данным сотрудников Майкрософт ограничен. Доступ производится только с вашего разрешения и в случае, если это необходимо для поддержки использования вами Application Insights.

Совокупные данные от приложений всех наших клиентов (например, скорость передачи данных и средний размер трассировок) используются для улучшения Application Insights.

#### Могут ли данные телеметрии другого пользователя повлиять на мои данные Application Insights?

Дополнительные данные телеметрии могут отправляться в вашу учетную запись с помощью ключа инструментирования, который можно найти в коде веб-страниц. При достаточном объеме дополнительных данных вашим метрики неправильно представляют производительность и использование приложения.

Если вы совместно используете код в других проектах, не забудьте удалить ключ инструментирования.

## Шифруются ли данные? 

В настоящее время данные на серверах не шифруются.

Все данные шифруются при перемещении между центрами обработки данных.

#### Данные шифруются при передаче из приложения на серверы Application Insights?

Да, мы используем HTTPS для отправки данных на портал практически из всех пакетов SDK, включая веб-серверы, устройства и веб-страницы HTTPS. Единственное исключение — данные, отправляемые с простых веб-страниц HTTP.

## Персональные данные

#### Будет ли персонально идентифицируемая информация отправляться в Application Insights? 

Да, это возможно.

Общее руководство:

* Большинство стандартных данных телеметрии (которые отправляются без написания кода) не содержит явных персональных данных. Однако возможна идентификация отдельных пользователей за счет применения коллекции событий.
* Исключения и сообщения трассировки могут содержать личные данные.
* Пользовательские данные телеметрии (вызовы, такие как TrackEvent, добавленные в код с помощью API-интерфейса, или трассировки журнала) могут содержать любые выбранные вами данные.


Таблица в конце этого документа содержит более подробное описание собираемых данных.



#### Несу ли я ответственность за соблюдение законов и нормативов в отношении персональных данных?

Да. На вас лежит ответственность за то, чтобы убедиться, что сбор и использование данных соответствует законам и нормативам, а также требованиям использования Microsoft Online Services.

Вам следует соответствующим образом проинформировать клиентов о данных, которые ваше приложение собирает, и о том, как они используются.

#### Могут ли мои пользователи отключить Application Insights?

Не напрямую. Мы не предоставляем параметр, с помощью которого пользователи могут отключить Application Insights.

Однако вы можете реализовать такую возможность в своем приложении. Все пакеты SDK содержат параметр API, который отключает сбор данных телеметрии.

#### Мое приложение непреднамеренно собирает конфиденциальные сведения. Может ли Application Insights удалить их?

Application Insights не фильтрует и не удаляет данные. Вам следует правильно управлять данными и предотвращать отправку таких данных службе Application Insights.



## Данные, передаваемые службой Application Insights

На разных платформах пакеты SDK различаются, при этом существует несколько компонентов, которые можно установить. (См. раздел [Начало работы с Application Insights][start].) Каждый компонент отправляет различные данные.

#### Классы данных, передаваемых в различных сценариях

Ваше действие | Собираемые классы данных (см. следующую таблицу)
---|---
[Добавление пакета SDK Application Insights в веб-проект][greenbrown] | ServerContext<br/>Выводимые<br/>Счетчики производительности<br/>Запросы<br/>**Исключения**<br/>Сеанс<br/>пользователи
[Установите монитор состояния на сервере IIS][redfield]|Зависимости<br/>ServerContext<br/>Выводимые<br/>Счетчики производительности
[Добавление пакета SDK Application Insights в веб-приложение Java][java]|ServerContext<br/>Выводимые<br/>Запрос<br/>Сеанс<br/>пользователи
[Добавление пакета SDK JavaScript на веб-страницу][client]|ClientContext<br/>Выводимые<br/>Страница<br/>ClientPerf<br/>Ajax
[Определение свойств по умолчанию][apiproperties]|**Свойства** всех стандартных и настраиваемых событий
[Вызов TrackMetric][api]|Числовые значения<br/>**Свойства**
[Вызов Track*][api]|Имя события<br/>**Свойства**
[Вызов TrackException][api]|**Исключения**<br/>Дамп стека<br/>**Свойства**
Пакету SDK не может собрать данные. Например: <br/> — нет доступа к счетчикам производительности<br/> — исключение в инициализаторе телеметрии | Диагностика SDK
 

Для [пакетов SDK для других платформ][platforms] см. соответствующую документацию.



#### Классы собираемых данных

Собираемый класс данных | Включает (неисчерпывающий список) 
---|---
**Свойства**|**Все данные — определяется кодом**
DeviceContext |Идентификатор, IP-адрес, языковой стандарт, модель устройства, сеть, тип сети, имя изготовителя оборудования, разрешение экрана, экземпляр роли, имя роли, тип устройства
ClientContext |ОС, языковой стандарт, язык, сеть, разрешение окна
Сеанс | идентификатор сеанса
ServerContext |Имя компьютера, языковой стандарт, ОС, устройство, сеанс пользователя, контекст пользователя, операция 
Выводимые |географическое расположение на основе IP-адреса, отметка времени, ОС, браузер
Метрики | Имя и значение метрики
События | Имя и значение события
PageViews | URL-адрес и имя страницы или имя экрана
Производительность клиента | URL-адрес или имя страницы, время загрузки браузера
Ajax | Вызовы HTTP от веб-страницы на сервер
Запросы |URL-адрес, длительность, код ответа
Зависимости|Тип (SQL, HTTP,...), строка подключения или URI, синхронный или асинхронный, длительность, успех, инструкция SQL (с монитором состояния)
**Исключения** | Тип, **сообщения**, стеки вызовов, исходный файл и номер строки, идентификатор потока
Сбои | Код процесса, код родительского процесса, код потока сбоя, исправление приложения, идентификатор, сборка, тип исключения, адрес, причина, скрытые символы и регистры, начальный и конечный двоичный адрес, имя и путь двоичного файла, тип ЦП
Трассировка | **Сообщение** и уровень серьезности
Счетчики производительности | Время процессора, объем доступной памяти, частота запросов, скорость исключения, байтов исключительного пользования процесса, скорость ввода-вывода, длительность запроса, длина очереди запросов
Доступность | Код ответа веб-теста, длительность каждого шага теста, имя теста, метка времени, успешное завершение, время отклика, расположение теста.
Диагностика SDK | Сообщение трассировки или исключение 

Вы можете [отключить некоторые данные, изменив файл ApplicationInsights.config][config]


## Баллы

Этот продукт содержит данные GeoLite2, созданные MaxMind и доступные на веб-сайте [http://www.maxmind.com](http://www.maxmind.com).

## <a name="video"></a>Видео

#### Введение

<div class="wa-video-container" data-control="video-container" data-slug="application-insights-introduction"> <a href="/en-us/documentation/videos/application-insights-introduction/" data-control="video" data-expanding="false" class="wa-video-thumbnail" title="Application Insights Introduction" data-ch9="//channel9.msdn.com/Series/Application-Insights-on-Azure-Preview-Portal/Application-Insights-Introduction/player/" data-caption="" data-event="videopage-clicked-videothumbnail" data-event-property="application-insights-introduction"> <img src="https://sec.ch9.ms/ch9/8b8e/e924e562-d966-4f38-8410-b19ed0a28b8e/AppInsightsIntro_960.jpg" alt="Application Insights Introduction" class="thumbnail"> <img class="play-icon" src="/cdn/cvt-a29a0e789afe7f47464f393c011b53f210c511ee5fed2c4c9c0633442f30d6ec/images/icon/VideoPlay.svg"> <span class="metadata"> <span class="date"> <span>08-05-2014</span> <span>03 min, 14 sec</span> </span> </span> </a> </div>

#### Приступая к работе

<div class="wa-video-container" data-control="video-container" data-slug="getting-started-with-application-insights"> <a href="/en-us/documentation/videos/getting-started-with-application-insights/" data-control="video" data-expanding="false" class="wa-video-thumbnail" title="Getting Started with Application Insights" data-ch9="//channel9.msdn.com/Series/Application-Insights-on-Azure-Preview-Portal/Getting-Started-with-Application-Insights/player/" data-caption="" data-event="videopage-clicked-videothumbnail" data-event-property="getting-started-with-application-insights"> <img src="https://sec.ch9.ms/ch9/3037/37da1ff1-7691-424e-8817-179e190c3037/AIGettingStarted_960.jpg" alt="Getting Started with Application Insights" class="thumbnail"> <img class="play-icon" src="/cdn/cvt-a29a0e789afe7f47464f393c011b53f210c511ee5fed2c4c9c0633442f30d6ec/images/icon/VideoPlay.svg"> <span class="metadata"> <span class="date"> <span>08-05-2014</span> <span>05 min, 28 sec</span> </span> </span> </a> </div>




<!--Link references-->

[api]: app-insights-api-custom-events-metrics.md
[apiproperties]: app-insights-api-custom-events-metrics.md#properties
[client]: app-insights-javascript.md
[config]: app-insights-configuration-with-applicationinsights-config.md
[greenbrown]: app-insights-asp-net.md
[java]: app-insights-java-get-started.md
[platforms]: app-insights-platforms.md
[pricing]: http://azure.microsoft.com/pricing/details/application-insights/
[redfield]: app-insights-monitor-performance-live-website-now.md
[start]: app-insights-overview.md

 

<!---HONumber=AcomDC_0907_2016-->