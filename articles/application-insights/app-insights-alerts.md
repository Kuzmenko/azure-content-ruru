<properties 
	pageTitle="Настройка оповещений в Application Insights" 
	description="Получайте сообщения о сбоях, исключениях и изменениях метрик." 
	services="application-insights" 
    documentationCenter=""
	authors="alancameronwills" 
	manager="douge"/>

<tags 
	ms.service="application-insights" 
	ms.workload="tbd" 
	ms.tgt_pltfrm="ibiza" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="06/20/2016" 
	ms.author="awills"/>
 
# Настройка оповещений в Application Insights

[Visual Studio Application Insights][start] может предупреждать об изменениях в метриках производительности или использования в приложении.

Application Insights выполняет мониторинг живого приложения на [разнообразных платформах][platforms], чтобы помочь вам диагностировать проблемы с производительностью и понять закономерности использования приложения.

Оповещения бывают двух типов:
 
* **веб-тесты**, сообщающие о том, что сайт недоступен в Интернете или медленно реагирует; [Подробнее][availability].
* **оповещения о метриках**, сообщающие, что какая-либо метрика, например количества сбоев, объема памяти или количества просмотров страницы, достигла порогового значения за некоторый период времени. 

Есть [отдельная страница о веб-тестах][availability], поэтому здесь речь пойдет об оповещениях о метриках.

> [AZURE.NOTE] Кроме того, вы можете получать сообщения электронной почты от [Упреждающего обнаружение](app-insights-proactive-detection.md) с предупреждением о необычных шаблонах в производительности приложения. В отличие от предупреждений эти уведомления не нужно настраивать, чтобы они работали. Они предназначены для оптимизации производительности вашего приложения, а не для сигнала о проблемах, требующих немедленного решения.

## Оповещения о метриках

Если вы еще не установили Application Insights для своего приложения, [сделайте это][start].

Чтобы получать сообщения, когда метрики будут достигать порогового значения, запустите обозреватель метрик или перейдите к плитке «Правила оповещения» в колонке «Обзор».

![В колонке правил оповещений нажмите кнопку «Добавить оповещение». Установите приложение в качестве ресурса для измерения, введите имя оповещения и выберите метрику.](./media/app-insights-alerts/01-set-metric.png)

* Выбирайте ресурс прежде других свойств. **Выберите ресурс («компоненты»)**, если нужно задать предупреждения для метрик производительности или использования.
* Аккуратно указывайте единицы измерения для пороговых значений.
* Имя, присваиваемое предупреждению, должно быть уникальным в пределах группы ресурсов (не только приложения).
* Если установить флажок Email owners… (Отправлять по электронной почте владельцам), оповещения будут отправляться по электронной почте всем, кто имеет доступ к этой группе ресурсов. Чтобы предоставить такой доступ другим пользователям, добавьте их в [группу ресурсов или подписку](app-insights-resources-roles-access-control.md) (но не ресурс).
* Если в поле Additional emails (Дополнительные электронные адреса) указать электронные адреса, оповещения будут отправляться на эти адреса отдельных пользователей или групп (независимо от того, установлен ли флажок Email owners… (Отправлять по электронной почте владельцам)). 
* Задайте [адрес объекта webhook](../azure-portal/insights-webhooks-alerts.md), если вы настроили веб-приложение, которое будет реагировать на оповещения. Оно будет вызываться, когда оповещение будет активировано и разрешено. (Обратите внимание, что в настоящее время параметры запроса не передаются как свойства объекта webhook.)
* Оповещение можно отключить или включить: см. кнопки вверху колонки.

*Отсутствует кнопка «Добавить оповещение».* Вы используете учетную запись организации? Вы можете настроить оповещения, если у вас есть доступ к этому ресурсу приложения на правах владельца или участника. Просмотрите пункт меню «Параметры» -> «Пользователи». [Дополнительная информация о контроле доступа][roles].

> [AZURE.NOTE] В колонке "Оповещения" вы увидите, что оповещение уже настроено: [Превентивная диагностика в близком к реальному масштабе времени](app-insights-nrt-proactive-diagnostics.md). Это автоматическое оповещение, которое отслеживает одну определенную метрику — процент сбоев запросов. Поэтому, если вы решили его отключить, не нужно задавать собственное оповещение о проценте сбоев запросов.

## Отображение оповещений

Вы получите сообщение электронной почты при изменении состояния предупреждения с неактивного на активное.

Текущее состояние каждого предупреждения в колонке правил оповещений.

Ниже показана сводка недавних действий в раскрывающемся списке оповещений.

![](./media/app-insights-alerts/010-alert-drop.png)

Журнал изменений состояния находится в журнале аудита.

![В колонке "Обзор" щелкните "Параметры" > "Журналы аудита".](./media/app-insights-alerts/09-alerts.png)



## Принципы работы оповещений

* У оповещения бывает три состояния: "Never activated" (Еще не активировалось), "Activated" (Активировано) и "Resolved" (Разрешено). Активация означает, что при последней оценке указанное условие имело значение true.

* Когда оповещение изменяет состояние, создается уведомление. (Если при создании оповещения его условие уже имело значение true, возможно, вы не получите уведомление, пока условие не примет значение false.)

* Каждое уведомление создает электронное сообщение, если вы установили флажок отправки электронных сообщений или указали электронные адреса. Можно также просмотреть раскрывающийся список уведомлений.

* Каждый раз при получении метрики выполняется оценка оповещения (но не в других случаях).

* При такой оценке выполняется вычисление метрики за предыдущий период и ее сравнение с пороговым значением для определения нового состояния оповещения.

* Выбранный вами период определяет интервал, для которого выполняется вычисление метрики. Он не влияет на периодичность оценки оповещения. Она зависит от частоты получения метрик.

* Если в течение некоторого времени для определенной метрики не поступает никаких данных, то такая ситуация оказывает различное влияние на оценку оповещения и на диаграммы в обозревателе метрик. Если данные не поступают в обозреватель метрик в течение периода, превышающего интервал выборки диаграммы, то на диаграмме будет отображено значение 0. При этом не будет выполняться повторная оценка оповещения, основанного прежней метрике, и его состояние останется неизменным.

    Когда, наконец, данные поступят, значение диаграммы снова станет ненулевым. Будет выполнена оценка оповещения на основании данных, доступных за указанный вами период. Если новая точка данных — единственная доступная в периоде, то для вычисления будет использована только эта точка.

* Даже если задать длительный период, оповещение может часто менять свое состояние с "предупреждение" на "работоспособен" и наоборот. Это может происходить, если значение метрики находится вблизи порогового значения. Для порогового значения не предусмотрен гистерезис: переход из состояния "предупреждение" в состояние "работоспособен" и наоборот происходит при одном и том же значении.



## Оповещения о доступности

Вы можете настроить веб-тесты, которые могут проверить любой веб-сайт в любой точке мира. [Подробнее][availability].

## Какие оповещения следует настраивать

Это зависит от приложения. Прежде всего, лучше не задавать слишком много метрик. Просмотрите диаграммы метрик во время выполнения приложения, чтобы понять, как работает приложение в нормальном режиме. Это поможет вам найти способы повышения его производительности. Затем настройте оповещения, которые будут предупреждать вас, если метрики превысят пределы обычного режима работы.

Чаще всего используются следующие оповещения.

* [Веб-тесты][availability] следует использовать, если приложение представляет собой общедоступный веб-сайт или общедоступную веб-службу, видимые в Интернете. Они сообщают о недоступности сайта или медленном реагировании, даже если это проблема оператора, а не приложения. Но эти тесты — искусственные, поэтому они не измеряют фактическое взаимодействие пользователя с приложением.
* [Метрики браузера][client] \(особенно показатель **времени загрузки страницы** браузера) удобно использовать для веб-приложений. Если страница содержит много сценариев, вам может потребоваться найти **исключения браузера**. Чтобы получить эти метрики и оповещения, необходимо настроить [мониторинг веб-страниц][client].
* **Время отклика сервера** и **Запросы со сбоями** для серверной части веб-приложений. Кроме настройки оповещений, следите за этими метриками, чтобы определить, насколько пропорционально они меняются по мере увеличения частоты запросов, так как непропорциональность может указывать на то, что в приложении заканчиваются ресурсы.
* **Исключения сервера**. Чтобы отобразить их, необходимо выполнить [дополнительную настройку](app-insights-asp-net-exceptions.md).

## Автоматизация

* [Использование PowerShell для автоматизации настройки оповещений](app-insights-powershell-alerts.md)
* [Использование веб-перехватчиков для автоматизации реагирования на оповещения](../azure-portal/insights-webhooks-alerts.md)

## См. также

* [Доступность веб-тестов](app-insights-monitor-web-app-availability.md)
* [Автоматическая настройка оповещений](app-insights-powershell-alerts.md)
* [Упреждающее обнаружение](app-insights-proactive-detection.md) 



<!--Link references-->

[availability]: app-insights-monitor-web-app-availability.md
[client]: app-insights-javascript.md
[platforms]: app-insights-platforms.md
[roles]: app-insights-resources-roles-access-control.md
[start]: app-insights-overview.md

 

<!---HONumber=AcomDC_0622_2016-->