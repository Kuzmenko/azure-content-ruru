<properties
   pageTitle="Планирование загрузки кластера Service Fabric | Microsoft Azure"
   description="Рекомендации по планированию загрузки кластера Service Fabric. NodeTypes, устойчивость и уровни надежности"
   services="service-fabric"
   documentationCenter=".net"
   authors="ChackDan"
   manager="timlt"
   editor=""/>

<tags
   ms.service="service-fabric"
   ms.devlang="dotnet"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="09/09/2016"
   ms.author="chackdan"/>


# Рекомендации по планированию загрузки кластера Service Fabric

Для любой рабочей развернутой службы важным шагом является планирование загрузки. Ниже приведено несколько факторов, которые необходимо учитывать при этом.

- Количество типов узлов, с которыми создается кластер
- Свойства каждого типа узла (размер, первичный узел, доступ к Интернету, количество виртуальных машин и т. п.).
- Надежность и устойчивость характеристик кластера.

Кратко рассмотрим каждый из пунктов.

## Количество типов узлов, с которыми создается кластер

Во-первых, необходимо выяснить, для чего будет использоваться создаваемый кластер и какие виды приложений планируется в нем развернуть. Если назначение кластера не ясно, скорее всего, вы еще не готовы перейти к планированию загрузки.

Определите количество типов узлов, с которыми нужно создать кластер. Каждый тип узла соответствует набору масштабирования виртуальных машин. Каждый тип узла поддерживает возможность независимого масштабирования, имеет разные наборы открытых портов и собственные метрики емкости. Поэтому решение о числе типов узлов, в сущности, сводится к следующему.

- Есть ли у вашего приложения несколько служб, среди которых есть службы, которые должны быть общедоступными или доступными из Интернета? Типичные приложения содержат интерфейсную службу шлюза, которая получает входные данные от клиента, и одну или несколько внутренних служб, взаимодействующих с интерфейсными службами. Поэтому в этом случае требуется как минимум два типа узлов.

- У служб (составляющих приложение) различные требования к инфраструктуре, например больше ОЗУ или тактов центрального процессора? Предположим, что приложение, которое вам необходимо развернуть, содержит интерфейсную и внутреннюю службы. Интерфейсная служба может выполняться на виртуальных машинах меньшего размера (например, D2) с портами, открытыми для доступа через Интернет. Однако внутренняя служба, которая будет выполнять вычисления, должна размещаться на более крупных виртуальных машинах (D4, D6, D15) без выхода в Интернет.

 Хотя вы можете поместить все эти службы на узлы одного типа, в этом примере их лучше всего поместить в кластер с двумя типами узлов. Так у каждого типа узла будут свои собственные свойства, например возможность подключения к Интернету или размер виртуальной машины. Кроме того, можно будет независимо менять число виртуальных машин.

- Так как нельзя предсказать будущее, исходите из известных вам фактов и решите, какое число типов узлов требуется, чтобы начать использовать приложения. Вы всегда сможете добавить или удалить типы узлов позже. У кластера Service Fabric должен быть по крайней мере один тип узла.

## Свойства каждого типа узла

**Тип узла** можно считать эквивалентом роли в облачных службах. Он определяет размер виртуальных машин, их количество и свойства. Каждый тип узла, определенный в кластере Service Fabric, настроен как отдельный набор масштабирования виртуальных машин. Наборы масштабирования виртуальных машин являются вычислительными ресурсами Azure. Их можно использовать для развертывания коллекции виртуальных машин и управления ею как набором. Будучи определенным как отдельный набор масштабирования виртуальных машин, каждый тип узла поддерживает возможность независимого масштабирования, имеет разные наборы открытых портов и собственные метрики загрузки.

Кластер может содержать узлы нескольких типов, однако тип первичного узла (тот, который вы задали на портале) должен включать в себя не менее пяти виртуальных машин для кластеров, используемых для рабочих нагрузок в рабочей среде (или не менее трех виртуальных машин для тестовых кластеров). Если вы создаете кластер с помощью шаблона Resource Manager, то в определении типа узла вы найдете атрибут **is Primary**. Тип первичного узла — это тип узла, на котором размещены системные службы Service Fabric.

### Тип первичного узла
Для кластера с несколькими типами узлов необходимо выбрать, какой из них будет первичным. Ниже приведены характеристики типа первичного узла.

- Минимальный размер виртуальных машин для типа первичного узла зависит от выбранного уровня устойчивости. Значение по умолчанию для уровня устойчивости — Bronze. Прокрутите вниз, чтобы прочитать об уровне устойчивости и его значениях.

- Минимальное количество виртуальных машин для типа первичного узла зависит от выбранного уровня надежности. Значение по умолчанию для уровня надежности — Silver. Прокрутите вниз, чтобы прочитать об уровне надежности и его значениях.

- Системные службы Service Fabric (например, служба диспетчера кластера или служба хранилища образов) размещаются на первичных узлах, поэтому надежность и устойчивость кластера определяется значениями уровней надежности и устойчивости, выбранными для типа первичного узла.

![Снимок экрана с двумя типами узлов][SystemServices]


### Тип вторичного узла
В кластере с несколькими типами узлов имеется один тип первичного узла, а остальные — типы вторичных узлов. Ниже приведены характеристики типа вторичного узла.

- Минимальный размер виртуальных машин для этого типа узла зависит от выбранного уровня устойчивости. Значение по умолчанию для уровня устойчивости — Bronze. Прокрутите вниз, чтобы прочитать об уровне устойчивости и его значениях.

- Минимальным количеством виртуальных машин для этого типа узла может быть одна виртуальная машина. Тем не менее это число следует выбирать, руководствуясь количеством реплик приложения или служб, которые вы хотите запустить на узле этого типа. После развертывания кластера число виртуальных машин для типа узла можно увеличить.


## Характеристики устойчивости кластера

Уровень устойчивости используется, чтобы указать системе привилегии, имеющиеся у виртуальных машин в базовой инфраструктуре Azure. Для типа первичного узла эта привилегия позволяет Service Fabric приостановить любой запрос инфраструктуры на уровне виртуальной машины (например, перезагрузку, переустановку из образа или перенос виртуальной машины), который влияет на требования к кворуму, установленные для системных служб и ваших служб с отслеживанием состояния. Для типов вторичных узлов эта привилегия позволяет Service Fabric приостановить любой запрос инфраструктуры на уровне виртуальной машины, например перезагрузку, переустановку из образа или перенос виртуальной машины и т. д., который влияет на требования к кворуму, установленные для ваших служб с отслеживанием состояния, которые в ней запущены.

Эта привилегия обозначается следующими значениями.

- Gold: задания инфраструктуры могут быть приостановлены в течение 2 часов для UD.

- Silver: задания инфраструктуры могут быть приостановлены в течение 30 минут для UD. (В настоящее время эта функция недоступна для использования. После включения она станет доступна для всех стандартных виртуальных машин с не менее чем одним ядром.)

- Bronze: привилегии отсутствуют. Это уровень по умолчанию.

## Характеристики надежности кластера

Уровень надежности используется для задания числа реплик системных служб, которые будут выполняться в этом кластере на первичных узлах. Чем больше реплик, тем надежнее системные службы в кластере.

Уровень надежности может принимать следующие значения.

- Platinum: запуск системных служб с целевым набором из 9 реплик.

- Gold: запуск системных служб с целевым набором из 7 реплик.

- Silver: запуск системных служб с целевым набором из 5 реплик.

- Bronze: запуск системных служб с целевым набором из 3 реплик.

>[AZURE.NOTE] Выбранный уровень надежности определяет минимальное количество узлов для типа первичного узла. Уровень надежности никак не влияет на максимальный размер кластера. Поэтому можно иметь кластер с 20 узлами с уровнем надежности Bronze.

 Уровень надежности кластера можно изменить в любой момент. Это активирует обновление кластера, необходимое для изменения числа реплик системных служб. Подождите, пока обновление не будет завершено, прежде чем вносить другие изменения в кластер, например, добавлять узлы и т. д. Ход выполнения обновления можно отслеживать в Service Fabric Explorer или с помощью командлета [Get ServiceFabricClusterUpgrade](https://msdn.microsoft.com/library/mt126012.aspx).

<!--Every topic should have next steps and links to the next logical set of content to keep the customer engaged-->
## Дальнейшие действия

Завершив планирование загрузки и настройку кластера, прочитайте следующие разделы.
- [Защита кластера Service Fabric](service-fabric-cluster-security.md)
- [Общие сведения о наблюдении за работоспособностью системы в Service Fabric](service-fabric-health-introduction.md)

<!--Image references-->
[SystemServices]: ./media/service-fabric-cluster-capacity/SystemServices.png

<!---HONumber=AcomDC_0921_2016-->