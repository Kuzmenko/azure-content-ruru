<properties 
	pageTitle="Настройка постоянного хранения для кэша Redis для Azure уровня Премиум" 
	description="Узнайте, как настроить постоянное хранение и управлять им для экземпляров кэша Redis для Azure уровня Премиум" 
	services="redis-cache" 
	documentationCenter="" 
	authors="steved0x" 
	manager="douge" 
	editor=""/>

<tags 
	ms.service="cache" 
	ms.workload="tbd" 
	ms.tgt_pltfrm="cache-redis" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="09/15/2016" 
	ms.author="sdanie"/>

# Настройка постоянного хранения для кэша Redis для Azure уровня Премиум

Кэш Redis для Azure предлагает разные варианты кэша, которые обеспечивают гибкость в выборе размера и функций кэша, включая новый уровень Премиум.

Кэш Redis для Azure уровня "Премиум" включает такие функции, как кластеризация, постоянное хранение данных и поддержка виртуальной сети. В этой статье описывается настройка постоянного хранения в экземпляре кэша Redis для Azure уровня Премиум.

Сведения о других функциях кэша уровня "Премиум" см. в статье [Знакомство с кэшем Redis для Azure уровня Премиум](cache-premium-tier-intro.md).

## Что такое постоянное хранение?
Постоянное хранение Redis позволяет постоянно хранить данные, размещенные в Redis. Также можно создавать моментальные снимки и архивировать данные, которые можно будет восстановить в случае сбоя оборудования. Это огромное преимущество по сравнению с уровнями Базовый и Стандартный, в которых все данные хранятся в памяти, и при сбое, когда узлы кэша становятся недоступными, может произойти потеря данных.

Кэш Redis для Azure предлагает использовать сохраняемость Redis по [модели RDB](http://redis.io/topics/persistence), при использовании которой данные хранятся в учетной записи хранения Azure. Если настроено постоянное хранение, кэш Redis для Azure будет сохранять моментальный снимок кэша Redis на диске в двоичном формате Redis в соответствии с настроенной частотой резервного копирования. В случае аварии, при которой становятся недоступными как основной экземпляр кэша, так и реплика кэша, кэш воссоздается на основе последнего моментального снимка.

При создании кэша сохраняемость можно настроить в колонке **Новый кэш Redis**, а для существующего кэша Премиум используйте колонку **Параметры**.

## Создание кэша Премиум

Для создания кэша и настройки сохраняемости войдите на [портал Azure](https://portal.azure.com), щелкните **Создать** > **Данные + хранилище** > **Кэш Redis**.

![Создание кэша Redis][redis-cache-new-cache-menu]

Чтобы настроить постоянное хранение, сначала выберите один из кэшей уровня **Премиум** в колонке **Выбор ценовой категории**.

![Выберите ценовую категорию][redis-cache-premium-pricing-tier]

Выбрав ценовую категорию Премиум, щелкните **Сохраняемость Redis**.

![Постоянное хранение Redis][redis-cache-persistence]

В следующем разделе описана процедура настройки сохраняемости Redis для нового кэша Премиум. Настроив сохраняемость Redis, нажмите кнопку **Создать**, чтобы создать новый кэш Премиум с сохраняемостью Redis.

## Настройка сохраняемости Redis

Сохраняемость Redis настраивается в колонке **Сохраняемость данных Redis**. Для новых кэшей доступ к этой колонке осуществляется при создании кэша, как описано в предыдущем разделе. Для существующих кэшей колонка **Сохраняемость данных Redis** открывается из колонки **Параметры**, соответствующей вашему кэшу.

![Параметры Redis][redis-cache-settings]

Чтобы включить сохраняемость Redis, активируйте резервное копирование базы данных Redis, выбрав параметр **Включено**. Чтобы отключить сохраняемость Redis во включенном ранее кэше Премиум, выберите параметр **Отключено**.

Чтобы настроить интервал резервного копирования, выберите **частоту резервного копирования** из раскрывающегося списка. Можно выбрать **15 минут**, **30 минут**, **60 минут**, **6 часов**, **12 часов** или **24 часа**. Отсчет этого интервала начинается после успешного завершения предыдущей операции резервного копирования. По истечении этого интервала запускается новое резервное копирование.

Щелкните нужную **Учетная запись хранения**, чтобы выбрать нужную учетную запись хранения. Выберите **Первичный ключ** или **Вторичный ключ** из раскрывающегося списка **Ключ к хранилищу данных**. Учетную запись хранения необходимо выбрать в том же регионе, где находится кэш. Рекомендуется учетная запись хранения категории **Премиум**, так как хранилище категории «Премиум» отличается более высокой пропускной способностью.

>[AZURE.IMPORTANT] Если ключ к хранилищу данных для учетной записи сохраняемости генерируется заново, то необходимо повторно выбрать желаемый ключ из раскрывающегося списка **Ключ к хранилищу данных**.

![Постоянное хранение Redis][redis-cache-persistence-selected]

Щелкните **ОК** для сохранения конфигурации постоянного хранения.

Следующая (а если кэш новый, то первая) резервная копия создается по окончании интервала резервного копирования.



## Часто задаваемые вопросы о постоянном хранении

Следующий список содержит ответы на часто задаваемые вопросы о постоянном хранении кэша Redis для Azure.

-	[Можно ли включить постоянное хранение для ранее созданного кэша?](#can-i-enable-persistence-on-a-previously-created-cache)
-	[Можно ли изменить частоту резервного копирования после создания кэша?](#can-i-change-the-backup-frequency-after-i-create-the-cache)
-	[Почему при установленной частоте резервного копирования 60 минут между созданием резервных копий проходит больше 60 минут?](#why-if-i-have-a-backup-frequency-of-60-minutes-there-is-more-than-60-minutes-between-backups)
-	[Что происходит со старыми резервными копиями при создании новой?](#what-happens-to-the-old-backups-when-a-new-backup-is-made)
-	[Что произойдет, если выполнено масштабирование до другого размера, а резервная копия была создана до этой операции?](#what-happens-if-i-have-scaled-to-a-different-size-and-a-backup-is-restored-that-was-made-before-the-scaling-operation)

### Можно ли включить постоянное хранение для ранее созданного кэша?

Да, вы можете настроить сохраняемость Redis как при создании кэша, так и в уже существующем кэше Премиум.

### Можно ли изменить частоту резервного копирования после создания кэша?

Да, вы можете изменить частоту резервного копирования в колонке **Сохраняемость данных Redis**. Инструкции см. в разделе [Настройка сохраняемости Redis](#configure-redis-persistence).

### Почему при установленной частоте резервного копирования 60 минут между созданием резервных копий проходит больше 60 минут?

Интервал резервного копирования не начинается, пока не завершится процесс предыдущего резервного копирования. Если интервал резервного копирования 60 минут и на процесс резервного копирования уходит 15 минут, следующее резервное копирование начнется не ранее чем через 75 минут после начала предыдущего резервного копирования.

### Что происходит со старыми резервными копиями при создании новой?

Все резервные копии за исключением последней автоматически удаляются. Это удаление может происходить не сразу, но старые резервные копии не хранятся в течение неограниченного периода времени.

### Что произойдет, если выполнено масштабирование до другого размера, а резервная копия была создана до этой операции?

-	Если выполнено масштабирование до большего размера, то ничего не произойдет.
-	Если выполнено масштабирование до меньшего размера, а значение существующего пользовательского параметра [databases](cache-configure.md#databases) превышает значение [databases limit](cache-configure.md#databases) для нового размера, то данные в этих базах данных не будут восстановлены. Дополнительные сведения см. в разделе [Is my custom databases setting affected during scaling?](#is-my-custom-databases-setting-affected-during-scaling) (Что происходит с пользовательским параметром databases при масштабировании?)
-	Если выполнено масштабирование до меньшего размера, и вам не хватает места для хранения всех данных из последнего архива, то при восстановлении ключи будут исключены. Обычно это происходит с использованием политики вытеснения [allkeys-lru](http://redis.io/topics/lru-cache).

## Дальнейшие действия
Узнайте, как использовать расширенные функции кэша.

-	[Знакомство с кэшем Redis для Azure уровня Премиум](cache-premium-tier-intro.md)
  
<!-- IMAGES -->

[redis-cache-new-cache-menu]: ./media/cache-how-to-premium-persistence/redis-cache-new-cache-menu.png

[redis-cache-premium-pricing-tier]: ./media/cache-how-to-premium-persistence/redis-cache-premium-pricing-tier.png

[redis-cache-persistence]: ./media/cache-how-to-premium-persistence/redis-cache-persistence.png

[redis-cache-persistence-selected]: ./media/cache-how-to-premium-persistence/redis-cache-persistence-selected.png

[redis-cache-settings]: ./media/cache-how-to-premium-persistence/redis-cache-settings.png

<!---HONumber=AcomDC_0921_2016-->