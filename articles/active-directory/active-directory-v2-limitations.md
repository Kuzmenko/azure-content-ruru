<properties
	pageTitle="Конечная точка версии 2.0: ограничения | Microsoft Azure"
	description="Список ограничений конечной точки Azure AD версии 2.0."
	services="active-directory"
	documentationCenter=""
	authors="dstrockis"
	manager="mbaldwin"
	editor=""/>

<tags
	ms.service="active-directory"
	ms.workload="identity"
	ms.tgt_pltfrm="na"
	ms.devlang="na"
	ms.topic="article"
	ms.date="09/16/2016"
	ms.author="dastrock"/>

# Следует ли мне использовать конечную точку версии 2.0?

При создании приложений, которые интегрируются с Azure Active Directory, необходимо решить, соответствуют ли вашим потребностям протоколы конечной точки версии 2.0 и проверки подлинности. Исходная модель приложений Azure AD по-прежнему полностью поддерживается и в некоторых отношениях является более функциональной, чем версия 2.0. Тем не менее конечная точка версии 2.0 [предоставляет значительные преимущества](active-directory-v2-compare.md) для разработчиков, поэтому вы, возможно, захотите попробовать новую модель программирования. Со временем версия 2.0 будет расширяться, чтобы охватить все возможности Azure AD, так что вам нужно будет использовать только конечную точку версии 2.0.

В настоящее время конечная точка версии 2.0 предоставляет две важнейшие функции:

- вход пользователей с личной и рабочей учетными записями;
- вызов [единого API-интерфейса Outlook](https://dev.outlook.com).

Обе функции можно реализовать в веб-приложениях, а также в мобильных и классических приложениях. Если эти относительно ограниченные функции нужны для вашего приложения, рекомендуем использовать конечную точку версии 2.0. Если для приложения требуются какие-либо дополнительные возможности служб Майкрософт, рекомендуем и дальше использовать проверенные конечные точки учетных записей Azure AD и Майкрософт. Со временем конечные точки версии 2.0 будут поддерживать все возможности учетных записей Azure AD и Майкрософт, а мы поможем разработчикам перейти на конечную точку версии 2.0.

А пока эта статья поможет вам определить, подходит ли вам конечная точка версии 2.0. Мы будем постоянно обновлять эту статью, чтобы она отображала актуальное состояние конечной точки версии 2.0, поэтому рекомендуем перечитать ее, если вам нужно будет повторно сопоставить свои требования и возможности версии 2.0.

Если у вас уже есть приложение с Azure AD, в котором не используется конечная точка версии 2.0, нет необходимости начинать с нуля. В будущем мы предоставим способ использования конечной точки версии 2.0 существующими приложениями Azure AD.

## Ограничения для приложений
Перечисленные ниже типы приложений в настоящее время не поддерживаются конечной точкой версии 2.0. Описание поддерживаемых типов приложений можно найти в [этой статье](active-directory-v2-flows.md).

##### Автономные веб-API
Используя конечную точку версии 2.0, вы можете [создать веб-API, защищенный с помощью OAuth 2.0](active-directory-v2-flows.md#web-apis). Однако этот веб-API сможет получать маркеры только от приложения с тем же идентификатором приложения. Сборка веб-API с возможностью доступа клиента с другим идентификатором приложения не поддерживается. Этот клиент не сможет запрашивать или получать разрешения для веб-API.

Чтобы узнать, как создать веб-API, принимающий маркеры от клиента с тем же идентификатором приложения, ознакомьтесь с примерами веб-API конечной точки версии 2.0 в разделе [Приступая к работе](active-directory-appmodel-v2-overview.md#getting-started).

##### Управляющие программы и серверные приложения
Приложениям, содержащим долговременные процессы или работающим без пользователя, также нужна возможность доступа к защищенным ресурсам, таким как веб-API. Такие приложения могут проверять подлинность и получать маркеры, используя удостоверение приложения (а не удостоверение делегированного пользователя) с помощью потока учетных данных клиента OAuth 2.0.

Этот поток в настоящее время не поддерживается конечной точкой версии 2.0, то есть приложения могут получать маркеры только после интерактивного входа пользователя. Поток клиентских учетных данных будет добавлен в ближайшем будущем. Если вы хотите увидеть поток клиентских учетных данных, использующий исходную конечную точку Azure AD, изучите [пример управляющей программы на портале GitHub](https://github.com/AzureADSamples/Daemon-DotNet).

##### Поток On-Behalf-Of веб-API
Многие архитектуры включают в себя веб-API, которым требуется вызывать другие подчиненные веб-API. При этом оба интерфейса защищены конечной точкой версии 2.0. Этот сценарий характерен для собственных клиентов с внутренним веб-API, который, в свою очередь, вызывает службу Microsoft Online Services или другой пользовательский веб-API, поддерживающий Azure AD.

Данный сценарий может поддерживаться с помощью предоставления учетных данных носителя маркера JWT OAuth 2.0 или потока On-Behalf-Of. Однако поток On-Behalf-Of пока не поддерживается для конечной точки версии 2.0. Чтобы увидеть его в общедоступной службе Azure AD, изучите [пример кода "On-Behalf-Of" на GitHub](https://github.com/AzureADSamples/WebAPI-OnBehalfOf-DotNet).

## Ограничения регистрации приложений
В настоящее время все приложения, интегрируемые с конечной точкой версии 2.0, необходимо регистрировать на сайте [apps.dev.microsoft.com](https://apps.dev.microsoft.com). Существующие приложения с учетными записями Azure AD или Майкрософт, а также приложения, зарегистрированные на портале, отличном от нового портала регистрации приложений, не будут совместимы с конечной точкой версии 2.0. Мы планируем предоставить способ использования существующих приложений в качестве приложений версии 2.0, но в настоящее время перенести приложение в конечную точку версии 2.0 невозможно.

Аналогичным образом приложения, зарегистрированные на новом портале регистрации приложений, не будут работать с исходной конечной точкой проверки подлинности Azure AD. Тем не менее можно использовать приложения, созданные на портале регистрации приложений, для успешной интеграции с конечной точкой проверки подлинности учетной записи Майкрософт, `https://login.live.com`.

Приложения, зарегистрированные на новом портале регистрации приложений, ограничены определенным набором значений URI перенаправления. URI перенаправления для веб-приложений и служб должен начинаться со схемы или `https`, а для всех других платформ следует использовать жестко заданное значение `urn:ietf:oauth:2.0:oob`.

## Ограничения для URI перенаправления
Во всех URI перенаправления веб-приложений должно использоваться одно значение домена DNS. Например, нельзя зарегистрировать веб-приложения со следующими URI перенаправления:

`https://login-east.contoso.com` `https://login-west.contoso.com`

Система регистрации сравнивает полное DNS-имя имеющегося URI перенаправления и DNS-имя нового URI перенаправления. Если их значения не совпадают или если полное DNS-имя нового URI перенаправления не соответствует поддомену имеющегося URI перенаправления, произойдет сбой запроса на добавление. Например, если в приложении используется следующий URI перенаправления:

`https://login.contoso.com`

Тогда можно добавить такой URI перенаправления:

`https://login.contoso.com/new`

Как видно, он полностью совпадает с DNS-именем. Возможен также следующий вариант:

`https://new.login.contoso.com`

В этом случае URI перенаправления соответствует поддомену DNS login.contoso.com. Если необходимо создать приложение с URI перенаправления login-east.contoso.com и login-west.contoso.com, добавьте следующие URI перенаправления в таком порядке:

`https://contoso.com` `https://login-east.contoso.com` `https://login-west.contoso.com`

Два последних примера являются поддоменами первого URI перенаправления (contoso.com), поэтому их можно добавить. Это ограничение будет снято в следующей версии.

Инструкции по регистрации приложения на новом портале регистрации приложений можно найти в [этой статье](active-directory-v2-app-registration.md).

## Ограничения для служб и API-интерфейсов
На данный момент конечная точка версии 2.0 поддерживает вход для любого приложения, зарегистрированного на новом портале регистрации приложений, если оно попадает в список [поддерживаемых потоков проверки подлинности](active-directory-v2-flows.md). Однако эти приложения смогут получать маркеры доступа OAuth 2.0 лишь для весьма ограниченного набора ресурсов. Конечная точка версии 2.0 выдает маркеры доступа только в следующих случаях:

- Для приложения, запросившего маркер. Приложение может получить маркер доступа для себя, если логическое приложение состоит из нескольких различных компонентов или уровней. Увидеть этот сценарий в действии можно в наших учебниках в разделе [Начало работы](active-directory-appmodel-v2-overview.md#getting-started).
- REST API Почты , Календаря и Контактов Outlook, расположенные на сайте https://outlook.office.com. Инструкции по созданию приложения с доступом к этим API можно найти в учебниках в разделе [Начало работы с Office](https://www.msdn.com/office/office365/howto/authenticate-Office-365-APIs-using-v2).
- API-интерфейсы Microsoft Graph. Дополнительные сведения и всю доступную информацию о Microsoft Graph можно просмотреть на сайте [https://graph.microsoft.io](https://graph.microsoft.io).

Никакие другие службы в настоящее время не поддерживаются. В будущем будут добавлены другие службы Microsoft Online Services, а также поддержка пользовательских веб-API и служб.

## Ограничения для библиотек и пакетов SDK
Чтобы вы могли поэкспериментировать, мы предоставили пробную версию библиотеки проверки подлинности Active Directory (ADAL), совместимую с конечной точкой версии 2.0. Однако эта версия ADAL доступна как предварительная: она не поддерживается и будет существенно изменена в течение следующих нескольких месяцев. Если вам нужно быстро запустить приложение с конечной точкой версии 2.0, см. раздел [Приступая к работе](active-directory-appmodel-v2-overview.md#getting-started), где есть несколько примеров кода с использованием ADAL для .NET, iOS, Android и Javascript.

Если требуется использовать конечную точку версии 2.0 в рабочем приложении, доступны следующие варианты.

- Если вы создаете веб-приложение, для выполнения входа и проверки маркеров можно смело использовать общедоступную версию нашего серверного ПО промежуточного слоя. К нему относится ПО промежуточного слоя OWIN OpenID Connect для ASP.NET и наш подключаемый модуль NodeJS Passport. Примеры кода, использующего это ПО промежуточного слоя, также доступны в разделе [Приступая к работе](active-directory-appmodel-v2-overview.md#getting-started).
- Для других платформ, мобильных и собственных приложений можно также выполнять интеграцию с конечной точкой версии 2.0, непосредственно отправляя и принимая сообщения протокола в коде приложения. Чтобы помочь вам выполнить такую интеграцию, [мы добавили детальную информацию](active-directory-v2-protocols.md) о протоколах OpenID Connect 2.0 и OAuth.
- И наконец, для интеграции с конечной точкой версии 2.0 вы можете использовать библиотеки с открытым кодом OpenID Connect и OAuth. Протокол версии 2.0 должен быть совместим со многими другими библиотеками протоколов с открытым кодом без существенных изменений. Доступность таких библиотек зависит от языка и платформы, и на веб-сайтах [OpenID Connect](http://openid.net/connect/) и [OAuth 2.0](http://oauth.net/2/) есть список популярных реализаций. Ниже приведены клиентские библиотеки с открытым кодом и примеры, которые были протестированы с конечной точкой версии 2.0.

  - [Сервер удостоверений WSO2 Java](https://docs.wso2.com/display/IS500/Introducing+the+Identity+Server)
  - [Федерация Gluu Java](https://github.com/GluuFederation/oxAuth)
  - [Node.Js passport-openidconnect](https://www.npmjs.com/package/passport-openidconnect)
  - [Базовый клиент OpenID Connect для PHP](https://github.com/jumbojett/OpenID-Connect-PHP)
  - [Клиент OAuth2 для iOS](https://github.com/nxtbgthng/OAuth2Client)
  - [Клиент OAuth2 для Android](https://github.com/wuman/android-oauth-client)
  - [Клиент OpenID Connect для Android](https://github.com/kalemontes/OIDCAndroidLib)

## Ограничения для протоколов
Конечная точка версии 2.0 поддерживает только протоколы OpenID Connect и OAuth 2.0. Однако в ней реализованы не все функции и возможности каждого протокола. Некоторые примеры:

- `end_sesssion_endpoint` OpenID Connect
- предоставление учетных данных клиента OAuth 2.0.

Чтобы лучше понять область функций протоколов, поддерживаемых в конечной точке версии 2.0, ознакомьтесь со [справочником по протоколам OpenID Connect и OAuth 2.0](active-directory-v2-protocols.md).

## Расширенный набор средств разработчика Azure AD
В службе Azure Active Directory есть средства разработчика, которые еще не поддерживаются конечной точкой версии 2.0, в частности:

- утверждения о группах для пользователей Azure AD;
- роли приложений и утверждения ролей.

<!---HONumber=AcomDC_0921_2016-->