<properties 
	pageTitle="Основные понятия служб мультимедиа Azure | Microsoft Azure" 
	description="В этой статье приводится обзор основных понятий служб мультимедиа Azure" 
	services="media-services" 
	documentationCenter="" 
	authors="Juliako" 
	manager="erikre" 
	editor=""/>

<tags 
	ms.service="media-services" 
	ms.workload="media" 
	ms.tgt_pltfrm="na" 
	ms.devlang="na" 
	ms.topic="article" 
	ms.date="09/19/2016"
	ms.author="juliako"/>

#Основные понятия служб мультимедиа Azure 

В этом разделе приводится обзор наиболее важных понятий служб мультимедиа.

##<a id="assets"></a>Ресурсы-контейнеры и хранилища

###Активы

Сущность [Ресурс](https://msdn.microsoft.com/library/azure/hh974277.aspx) содержит цифровые файлы (в том числе видео, аудио, изображения, коллекции эскизов, текстовые дорожки и файлы скрытых титров), а также метаданные об этих файлах. После загрузки цифровых файлов в ресурс их можно использовать в рабочих процессах кодирования и потоковой передачи служб мультимедиа.

Ресурс сопоставляется с контейнером BLOB-объектов в учетной записи хранения Azure. Файлы ресурса хранятся в этом контейнере как BLOB-объекты.

При выборе содержимого мультимедиа для отправки и хранения в активе можно руководствоваться следующими соображениями.

- Актив должен содержать только один уникальный экземпляр содержимого мультимедиа. Например, одно изменение серии телепередачи, фильма или рекламы.
- Актив не должен содержать несколько представлений или изменений аудиовизуального файла. Один из примеров неправильного использования актива — попытка сохранить более одной серии телепередачи, рекламы или несколько расположений камеры из одной рабочей среды в активе. Сохранение нескольких представлений или изменений аудиовизуального файла может привести к проблемам при отправке заданий кодирования, потоковой передаче и защите доставки актива позже в рабочем процессе.

###Файл ресурса 
[AssetFile](https://msdn.microsoft.com/library/azure/hh974275.aspx) представляет собой фактический массив видео или аудио, хранящийся в контейнере больших двоичных объектов. Файл ресурса всегда связан с ресурсом, а ресурс может содержать один или несколько файлов. Задача кодировщика служб мультимедиа завершится с ошибкой, если объект файла ресурса не связан с цифровым файлом в контейнере больших двоичных объектов.

Экземпляр **AssetFile** и фактический файл мультимедиа — это два разных объекта. Экземпляр AssetFile содержит метаданные о файле мультимедиа, а сам файл мультимедиа — фактическое мультимедийное содержимое.

Не следует пытаться изменить содержимое контейнеров больших двоичных объектов, созданных службами мультимедиа, без использования интерфейсов API служб мультимедиа.

###Параметры шифрования ресурсов

В зависимости от типа содержимого, которое вы хотите выкладывать, хранить и доставлять, службы мультимедиа предлагают различные параметры шифрования.

**None** — шифрование не используется. Это значение по умолчанию. Обратите внимание, что при использовании этого параметра содержимое не защищено при передаче или в хранилище.

Используйте этот параметр при добавлении содержимого, если MP4-файл планируется доставлять с помощью поэтапного скачивания.

**StorageEncrypted** — используйте этот параметр для локального шифрования незашифрованного содержимого с помощью AES 256 и его добавления в хранилище Azure, где оно хранится в зашифрованном виде. Ресурсы, защищенные с помощью шифрования хранилища, автоматически расшифровываются и помещаются в зашифрованную файловую систему до кодирования, а затем при необходимости повторно кодируются перед добавлением в виде нового выходного актива. Основная причина использования шифрования хранилища — для защиты входных файлов мультимедиа высокого качества с помощью стойкого шифрования при хранении на диске.

Для доставки ресурса из зашифрованного хранилища необходимо настроить политику доставки ресурсов, чтобы службы мультимедиа могли определить, как вы хотите доставлять содержимое. Перед выполнением потоковой передачи ресурса сервер потоковой передачи удаляет шифрование хранилища и осуществляет потоковую передачу содержимого с помощью указанной политики доставки (например, AES, PlayReady или без шифрования).

**CommonEncryptionProtected**— используйте этот параметр, если вы хотите зашифровать содержимое с помощью стандартного шифрования или PlayReady DRM либо выложить уже зашифрованное содержимое (например, Smooth Streaming с защитой PlayReady DRM).

**EnvelopeEncryptionProtected** — используйте этот параметр, если требуется защитить потоковую передачу HTTP (HLS), зашифрованную с помощью AES, или же добавить уже защищенную передачу. Обратите внимание на то, что если HLS уже зашифрована с помощью AES, ее можно выложить только в том случае, если для шифрования использовался Transform Manager.

###Политика доступа 

Сущность [AccessPolicy](https://msdn.microsoft.com/library/azure/hh974297.aspx) определяет разрешения (например, на чтение, запись и создание списков) и длительность доступа к ресурсу. Обычно объект AccessPolicy следует передавать в указатель, который затем будет использоваться для доступа к файлам, содержащимся в ресурсе.


###Контейнер BLOB-объектов

Контейнер BLOB-объектов обеспечивает группирование набора BLOB-объектов. Контейнеры BLOB-объектов используются в службах мультимедиа в качестве граничной точки для управления доступом и как указатели на подписанный URL-адрес (SAS) в ресурсах. Учетная запись хранилища Azure может содержать неограниченное количество контейнеров BLOB-объектов. Контейнер может хранить неограниченное количество больших двоичных объектов.

>[AZURE.NOTE]Не следует пытаться изменить содержимое контейнеров больших двоичных объектов, созданных службами мультимедиа, без использования интерфейсов API служб мультимедиа.

###<a id="locators"></a>Указатели

[Указатели](https://msdn.microsoft.com/library/azure/hh974308.aspx) предоставляют точку входа для доступа к файлам, содержащимся в ресурсе. Политика доступа используется для определения разрешений и длительности доступа клиента к определенному активу. Указатели могут иметь множество или одну связь с политикой доступа таким образом, чтобы разные указатели могли обеспечивать разное время запуска и типы подключения к различным клиентам с использованием одних параметров разрешения и длительности. Однако из-за ограничений общей политики доступа, установленных службами хранилища Azure, невозможно одновременно связать с определенным активом более пяти указателей.

Службы мультимедиа поддерживают два типа указателей: указатели OnDemandOrigin, используемые для потоковой передачи мультимедиа (например, MPEG DASH, HLS или Smooth Streaming) или последовательной загрузки мультимедиа и указатели URL-адрес, используемые для отправки или загрузки файлов мультимедиа в или из хранилища Azure.

Обратите внимание, что разрешение списка (AccessPermissions.List) не следует использовать при создании указателя OrDemandOrigin.

###Учетная запись хранения

Весь доступ к хранилищу Azure осуществляется с помощью учетной записи хранения. Учетную запись служб мультимедиа можно связать с одной или несколькими учетными записями хранения. Учетная запись может содержать неограниченное количество контейнеров, пока их общий размер составляет менее 500 ТБ на учетную запись хранения. Службы мультимедиа обеспечивают средства уровня SDK, позволяющие управлять несколькими учетными записями хранения и распределять нагрузку распределения активов во время отправки в эти учетные записи на основе метрик или случайного распределения. Дополнительную информацию см. в разделе [Служба хранилища Azure](https://msdn.microsoft.com/library/azure/dn767951.aspx).

##Задания и задачи

[Задание](https://msdn.microsoft.com/library/azure/hh974289.aspx) обычно используется для обработки (например, индексирования или кодирования) одного аудио- или видеопредставления. При обработке нескольких видео необходимо создать задание для перекодировки каждого.

Задание включает метаданные о порядке обработки, которую необходимо выполнить. Каждое задание содержит одну или несколько [задач](https://msdn.microsoft.com/library/azure/hh974286.aspx), которые задают неделимую задачу обработки, ее входные ресурсы, выходные ресурсы, обработчик мультимедиа и связанные с ним параметры. Задачи в задании можно соединять между собой в цепочки, в которых выходной ресурс одной задачи является входным ресурсом следующей. Таким образом одно задание может содержать все обработки, необходимые для представления мультимедиа.

##<a id="encoding"></a>Кодирование

Службы мультимедиа Azure предоставляют несколько вариантов для кодирования мультимедиа в облаке.

При начале работы со службами мультимедиа важно понимать разницу между кодеками и форматами файлов. Кодеки — это программное обеспечение, которое реализует алгоритмы сжатия и распаковки, тогда как форматы файлов являются контейнерами, в которых хранится сжатое видео.

Службы мультимедиа обеспечивают динамическую упаковку, которая позволяет доставлять закодированное содержимое MP4-файлов с адаптивным битрейтом или Smooth Streaming в форматах потоковой передачи с поддержкой служб мультимедиа (MPEG DASH, HLS, Smooth Streaming, HDS) без необходимости повторной упаковки в эти форматы потоковой передачи.

Чтобы воспользоваться преимуществом [динамической упаковки](media-services-dynamic-packaging-overview.md), необходимо выполнить следующие действия:

- закодировать мезонинный (исходный) файл в набор MP4-файлов с адаптивной скоростью или в набор файлов Smooth Streaming (шаги кодирования показаны далее в этом учебнике);
- получить по крайней мере одну единицу потокового воспроизведения по запросу для конечной точки потоковой передачи, из которой планируется доставлять содержимое. Дополнительную информацию см. в разделе [Масштабирование зарезервированных единиц потоковой передачи по запросу](media-services-portal-manage-streaming-endpoints.md).

Службы мультимедиа поддерживают следующие кодировщики по запросу, описанные в этом разделе.

- [Стандартный кодировщик служб мультимедиа](media-services-encode-asset.md#media-encoder-standard)
- [Расширенный рабочий процесс кодировщика мультимедиа](media-services-encode-asset.md#media-encoder-premium-workflow)

Дополнительную информацию о поддерживаемых кодировщиках см. в разделе [Кодировщики](media-services-encode-asset.md)


##Потоковая передача в реальном времени

В службах мультимедиа Azure канал представляет собой конвейер для обработки контента, передаваемого в потоковом режиме. Канал получает входные потоки одним из двух способов.

- Локальный динамический кодировщик передает контент в многоскоростном формате RTMP или Smooth Streaming (фрагментированном формате MP4) в канал. Вы можете использовать следующие динамические кодировщики, выдающие контент в многоскоростном формате Smooth Streaming: Elemental, Envivio, Cisco. Следующие динамические кодировщики выдают контент в формате RTMP: Adobe Flash Live, Telestream Wirecast и транскодеры Tricaster. Переданные потоки проходят через каналы без дополнительной обработки. При получении запроса службы мультимедиа предоставляют потоки клиентам.

- Односкоростной поток (в одном из следующих форматов: RTP (MPEG-TS), RTMP или Smooth Streaming (фрагментированный формат MP4)) передается в канал, который может осуществлять кодирование в реальном времени с помощью служб мультимедиа. Затем канал кодирует входящий односкоростной поток в реальном времени в многоскоростной (адаптивный) видеопоток. При получении запроса службы мультимедиа предоставляют потоки клиентам.

###Канал

В службах мультимедиа [каналы](https://msdn.microsoft.com/library/azure/dn783458.aspx) отвечают за обработку обновляющегося содержимого потоковой трансляции. Канал предоставляет входную конечную точку, которая затем передается динамическому кодировщику. Канал получает входные потоковые трансляции от кодировщика и предоставляет их для потоковой передачи по одной или нескольким StreamingEndpoint. Каналы также предоставляют конечную точку предварительного просмотра (URL-адрес предварительного просмотра), используемого для предварительного просмотра и проверки вашего потока перед дальнейшей обработкой и доставкой.

URL-адрес приема и URL-адрес предварительного просмотра можно получить при создании канала. Получить эти URL-адреса можно только тогда, когда канал не запущен. Когда все готово для начала передачи данных из динамического транскодера в канал, канал должен быть запущен. После запуска приема данных динамического транскодера можно выполнить предварительный просмотр потока.

Каждая учетная запись служб мультимедиа может содержать множество каналов, программ и конечных служб StreamingEndpoint. В зависимости от пропускной способности и потребностей безопасности службы StreamingEndpoint могут быть выделены одному или нескольким каналам. Любая служба StreamingEndpoint может извлекать данные из любого канала.


###Программа

[Программа](https://msdn.microsoft.com/library/azure/dn783463.aspx) позволяет управлять публикацией и хранением сегментов в динамическом потоке. Каналы управляют программами. Отношение между каналом и программой очень похоже на традиционные мультимедиа, где канал передает постоянный поток контента, а программа ограничена временным событием на этом канале. Можно указать количество часов, в течение которого записанный содержимого должен сохраняться для программы, установив свойство **ArchiveWindowLength**. Это значение может быть задано в диапазоне от 5 минут до 25 часов.

Оно также указывает максимальное время, на которое клиенты могут вернуться назад от текущей позиции. Программы могут выходить за указанный промежуток времени, но содержимое за пределами этого промежутка постоянно удаляется. Значение этого свойства также определяет максимальный размер манифестов клиентов.

Каждая программа связана с ресурсом. Чтобы опубликовать программу, необходимо создать указатель для связанного ресурса. С помощью этого указателя можно сформировать URL-адрес потоковой передачи данных, который предоставляется клиентам.

Канал поддерживает одновременную потоковую трансляцию до трех программ, поэтому можно создавать по несколько архивов одного и того же входящего потока. Благодаря этому можно публиковать и архивировать разные части транслируемого мероприятия. Например ваш бизнес-требование — архивировать 6 часов программы, но для передачи только оставить последние 10 минут. Для этого необходимо создать две одновременно работающие программы. Для одной из них настроено архивирование 6 часов транслируемого мероприятия, но без публикации. Для второй программы настроено архивирование 10 минут с публикацией.


Дополнительные сведения см. в следующих статьях:

- [Работа с каналами, выполняющими кодирование в реальном времени с помощью служб мультимедиа Azure](media-services-manage-live-encoder-enabled-channels.md)
- [Работа с каналами, получающими динамические многоскоростные потоки данных от локальных кодировщиков](media-services-live-streaming-with-onprem-encoders.md)
- [Квоты и ограничения](media-services-quotas-and-limitations.md)

##Защита содержимого

###Динамическое шифрование

Службы мультимедиа Azure позволяют защитить данные мультимедиа, покидающие ваш компьютер, на этапах их хранения, обработки и доставки. Службы мультимедиа позволяют доставлять содержимое, зашифрованное динамически с помощью AES (с использованием 128-битных ключей шифрования) и общим шифрованием (CENC), используя PlayReady и (или) Widevine DRM. Они также обеспечивают службы доставки ключей AES и лицензий PlayReady авторизованным клиентам.

В настоящее время поддерживается шифрование для следующих форматов потоковой передачи: HLS, MPEG DASH и Smooth Streaming. Шифрование формата потоковой передачи HDS и последовательных скачиваний не поддерживается.

Если требуется, чтобы службы мультимедиа зашифровали ресурс, необходимо связать ключ шифрования (CommonEncryption или EnvelopeEncryption) с ресурсом, а также настроить политики авторизации для ключа.

Для потоковой передачи ресурса из зашифрованного хранилища необходимо настроить политику доставки ресурсов, указав способ доставки этого ресурса.

Когда поток запрашивается проигрывателем, службы мультимедиа используют указанный ключ для динамического шифрования содержимого с помощью конвертного (AES) или общего (PlayReady или Widevine) шифрования. Чтобы расшифровать поток, проигрыватель запросит ключ у службы доставки ключей. Чтобы определить, есть ли у пользователя право на получение ключа, служба оценивает политики авторизации, заданные для ключа.


###Ограничение по маркеру

Для политики авторизации ключа содержимого можно задать одно или несколько из ограничений авторизации: открытая авторизация, с ограничением по маркеру или с ограничением по IP-адресу. При ограничении по маркеру к политике должен прилагаться маркер, выданный службой маркеров безопасности (STS). Службы мультимедиа поддерживают маркеры в формате простого веб-маркера (SWT) и формате веб-маркера JSON (JWT). Службы мультимедиа не предоставляют службы маркеров безопасности. Для выдачи маркеров можно создать пользовательскую службу STS или использовать службу Microsoft Azure ACS. Чтобы создать маркер, подписанный указанным ключом, и получить утверждения, указанные в конфигурации ограничения по маркерам, должна быть настроена служба маркеров безопасности. Служба доставки ключей служб мультимедиа возвращает клиенту запрошенный ключ (или лицензию), если маркер является допустимым, а его утверждения соответствуют утверждениям, настроенным для ключа (или лицензии).

При настройке политики ограничения по маркеру необходимо задать такие параметры, как основной ключ проверки, издатель и аудитория. Основной ключ проверки содержит ключ, которым подписан маркер, а издатель — это служба маркеров безопасности, которая выдает маркер. Аудитория (иногда называется областью) описывает назначение маркера или ресурс, доступ к которому обеспечивает маркер. Служба доставки ключей служб мультимедиа проверяет, соответствуют ли эти значения в маркере значениям в шаблоне.

Дополнительные сведения см. в следующих статьях:

[Общие сведения о защите содержимого](media-services-content-protection-overview.md) [Защита с помощью AES-128](media-services-protect-with-aes128.md) [Защита с помощью DRM](media-services-protect-with-drm.md)

##Доставка содержимого

###<a id="dynamic_packaging"></a>Динамическая упаковка

При работе со службами мультимедиа рекомендуется всегда кодировать мезонинные файлы в набор MP4 с адаптивной скоростью, а затем преобразовать их в нужный формат с помощью [динамической упаковки](media-services-dynamic-packaging-overview.md).


###Конечная точка потоковой трансляции

StreamingEndpoint представляет собой службу потоковой трансляции, способную передавать контент непосредственно в приложение проигрывателя клиента или в сеть доставки содержимого для дальнейшего распределения. Исходящий поток из службы StreamingEndpoint может быть потоком трансляции или активом видео по запросу в учетной записи служб мультимедиа. Кроме того, вы можете управлять емкостью службы StreamingEndpoint для обработки растущих требований к пропускной способности, изменив единицы масштабирования (также известные как единицы потоковой передачи). Рекомендуем выделить одну или несколько единиц масштабирования для приложения в рабочей среде. Единицы масштабирования предоставляют как выделенные мощности исходящего трафика, которые могут быть приобретены с шагом 200 Мбит/с, так и дополнительную функциональность, которая в настоящее время включает возможности динамической упаковки.

Рекомендуется использовать динамическую упаковку или динамическое шифрование. Для этого нужна хотя бы одна единица потоковой трансляции для конечной точки, из которой планируется организовать потоковую трансляцию. Дополнительную информацию см. в разделе [Масштабирование единиц потоковой передачи](media-services-portal-manage-streaming-endpoints.md).

По умолчанию в учетную запись служб мультимедиа можно добавить до 2 конечных точек потоковой передачи. Информацию о том, как увеличить максимальное значение, см. в статье [Квоты и ограничения](media-services-quotas-and-limitations.md).

Плата взимается, только когда служба StreamingEndpoint используется.

###Политика доставки ресурсов

Один из шагов в рабочем процессе доставки содержимого служб мультимедиа — настройка [политик доставки ресурсов](https://msdn.microsoft.com/library/azure/dn799055.aspx), для которых необходимо выполнить потоковую передачу. Политика доставки ресурсов сообщает службам мультимедиа способ доставки ресурса: какие протоколы передачи следует использовать для динамической упаковки ресурса (например, MPEG DASH, HLS, Smooth Streaming или все), следует ли использовать динамическое шифрование и как (конвертное или общее шифрование).

Перед началом потоковой передачи ресурса сервер потоковой передачи удаляет шифрование хранилища и выполняет потоковую передачу контента с использованием определенной политики доставки. Например, чтобы доставить ресурс, зашифрованный с помощью ключа шифрования AES, установите тип политики DynamicEnvelopeEncryption. Чтобы удалить шифрование хранилища и выполнить потоковую передачу ресурса в незашифрованном виде, задайте для типа политики значение NoDynamicEncryption.

###Прогрессивное скачивание

Прогрессивное скачивание позволяет начать воспроизведение мультимедиа до окончания скачивания всего файла. Допускается только прогрессивное скачивание MP4-файла.

Обратите внимание, что зашифрованные ресурсы необходимо расшифровать, если он должны быть доступны для прогрессивного скачивания.

Чтобы предоставить пользователям URL-адреса прогрессивного скачивания, сначала необходимо создать указатель OnDemandOrigin. При создании указателя будет получен базовый путь к ресурсу. К нему нужно будет добавить имя MP4-файла. Например:

http://amstest1.streaming.mediaservices.windows.net/3c5fe676-199c-4620-9b03-ba014900f214/BigBuckBunny_H264_650kbps_AAC_und_ch2_96kbps.mp4

###URL-адреса потоковой передачи

Потоковая передача контента клиентам Чтобы предоставить пользователям URL-адреса потоковой передачи, сначала необходимо создать указатель OnDemandOrigin. При создании указателя вы получите базовое значение Path для ресурса, который содержит контент для потоковой передачи. Однако, чтобы получить возможность потоковой передачи контента, необходимо изменить этот путь. Чтобы создать полный URL-адрес к файлу манифеста потоковой передачи, необходимо соединить значение Path указателя и имя файла манифеста (filename.ism). Затем добавьте /Manifest и соответствующий формат (если нужно) в путь указателя источника.

Также по SSL-подключению можно выполнять потоковую передачу содержимого. Для этого убедитесь, что URL-адреса потоковой передачи начинаются с HTTPS.

Обратите внимание, что потоковую передачу через SSL-соединение можно выполнять, только если конечная точка потоковой передачи, из которой получено содержимое, была создана после 10 сентября 2014 г. Если URL-адреса потоковой передачи основаны на конечных точках потоковой передачи, созданных после 10 сентября, URL-адрес содержит "streaming.mediaservices.windows.net" (новый формат). URL-адреса потоковой передачи, который содержат "origin.mediaservices.windows.net" (старый формат), не поддерживают SSL. Если URL-адрес имеет старый формат и необходимо организовать передачу через SSL, нужно создать новую конечную точку. Используйте URL-адреса, созданные на основе новой конечной точки потоковой передачи, для потоковой передачи содержимого по SSL.

В следующем списке описываются различные форматы потоковой передачи и приведены примеры:

- Smooth Streaming

{имя конечной точки потоковой передачи - имя учетной записи служб мультимедиа}.streaming.mediaservices.windows.net/{идентификатор указателя}/{имя файла}.ism/Manifest

http://testendpoint-testaccount.streaming.mediaservices.windows.net/fecebb23-46f6-490d-8b70-203e86b0df58/BigBuckBunny.ism/Manifest


- MPEG DASH

{имя конечной точки потоковой передачи - имя учетной записи служб мультимедиа}.streaming.mediaservices.windows.net/{идентификатор указателя}/{имя файла}.ism/Manifest(format=mpd-time-csf)

http://testendpoint-testaccount.streaming.mediaservices.windows.net/fecebb23-46f6-490d-8b70-203e86b0df58/BigBuckBunny.ism/Manifest(format=mpd-time-csf)



- Apple HTTP Live Streaming (HLS) V4

{имя конечной точки потоковой передачи - имя учетной записи служб мультимедиа}.streaming.mediaservices.windows.net/{идентификатор указателя}/{имя файла}.ism/Manifest(format=m3u8-aapl)

http://testendpoint-testaccount.streaming.mediaservices.windows.net/fecebb23-46f6-490d-8b70-203e86b0df58/BigBuckBunny.ism/Manifest(format=m3u8-aapl)



- Apple HTTP Live Streaming (HLS) V3

{имя конечной точки потоковой передачи - имя учетной записи служб мультимедиа}.streaming.mediaservices.windows.net/{идентификатор указателя}/{имя файла}.ism/Manifest(format=m3u8-aapl-v3)

http://testendpoint-testaccount.streaming.mediaservices.windows.net/fecebb23-46f6-490d-8b70-203e86b0df58/BigBuckBunny.ism/Manifest(format=m3u8-aapl-v3)

- HDS (только для лицензиатов Adobe PrimeTime/Access)

{имя конечной точки потоковой передачи - имя учетной записи служб мультимедиа}.streaming.mediaservices.windows.net/{идентификатор указателя}/{имя файла}.ism/Manifest(format=f4m-f4f)

http://testendpoint-testaccount.streaming.mediaservices.windows.net/fecebb23-46f6-490d-8b70-203e86b0df58/BigBuckBunny.ism/Manifest(format=f4m-f4f)


##Схемы обучения работе со службами мультимедиа

[AZURE.INCLUDE [media-services-learning-paths-include](../../includes/media-services-learning-paths-include.md)]

##Отзывы

[AZURE.INCLUDE [media-services-user-voice-include](../../includes/media-services-user-voice-include.md)]

<!---HONumber=AcomDC_0921_2016-->