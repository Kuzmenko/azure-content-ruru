<properties 
   pageTitle="Виртуальное устройство StorSimple с обновлением 2 | Microsoft Azure"
   description="Описание способов создания, развертывания виртуального устройства StorSimple в виртуальной сети Microsoft Azure и управления им. (Применимо к StorSimple с обновлением 2.)"
   services="storsimple"
   documentationCenter=""
   authors="alkohli"
   manager="carmonm"
   editor="" />
<tags 
   ms.service="storsimple"
   ms.devlang="NA"
   ms.topic="hero-article"
   ms.tgt_pltfrm="NA"
   ms.workload="NA"
   ms.date="09/23/2016"
   ms.author="alkohli" />

# Развертывание виртуального устройства StorSimple в Azure и управление им


##Обзор
Виртуальное устройство StorSimple серии 8000 — это дополнительная функция, поставляемая вместе с решением Microsoft Azure StorSimple. Виртуальное устройство StorSimple работает в виртуальной машине в виртуальной сети Microsoft Azure, и вы можете использовать его для резервного копирования и клонирования данных с узлов. В этом учебнике описывается развертывание виртуального устройства и управление им в Azure. Информация касается всех виртуальных устройств c программным обеспечением до версии с обновлением 2.


#### Сравнение моделей виртуального устройства

Виртуальное устройство StorSimple доступно в двух моделях — 8010 (ценовая категория "Стандартный"; ранее представлена как 1100) и 8020 (ценовая категория "Премиум"; впервые представлена в обновлении 2). Сравнение двух моделей приведено в таблице ниже.


| Модель устройства | 8010<sup>1</sup> | 8020 |
|-----------------------|---------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------|
| **Максимальная емкость** | 30 TБ | 64 ТБ |
| **Azure** | Standard\_A3 (4 ядра, 7 ГБ памяти) | Standard\_DS3 (4 ядра, 14 ГБ памяти) |
| **Совместимость версий** | Версии, на которых запущено предварительное обновление 2 или более поздней версии | Версии, на которых запущено обновление 2 или более поздней версии |
| **Регионы доступности** | Все регионы Azure | Регионы Azure, поддерживающие хранилища класса Premium<br></br>Список регионов с поддержкой модели 8020 см. [здесь](#supported-regions-for-8020). |
| **Тип хранилища** | Использует хранилище Azure класса Standard для локальных дисков<br></br> Узнайте, как [создать учетную запись хранения класса Standard](). | Использует хранилище Azure класса Premium для локальных дисков<sup>2</sup> <br></br>Узнайте, как [создать учетную запись хранения класса Premium](storage-premium-storage.md#create-and-use-a-premium-storage-account-for-a-virtual-machine-data-disk). |
| **Руководство по рабочим нагрузкам** | Извлечение файлов уровня элемента из резервных копий | Сценарии разработки и тестирования для облака, низкая задержка, рабочие нагрузки с более высокой производительностью <br></br>Дополнительное устройство для аварийного восстановления |
 
<sup>1</sup> *Ранее известное как 1100*.

<sup>2</sup> *Как 8010, так и 8020 используют для облачного уровня хранилище Azure класса Standard. Разница существует только на локальном уровне в пределах устройства*.

#### Регионы с поддержкой модели 8020

Регионы для хранилища класса Premium, в которых сейчас реализована поддержка модели 8020, отображены ниже. Этот список постоянно обновляется, так как хранилище класса Premium становится доступным и в других регионах.

| Порядковый номер | Регионы, в которых сейчас реализована поддержка |
|---------------------------------------------------------|--------------------------------|
| 1 | Центральный регион США |
| 2 | Восток США |
| 3 | Восток США 2 |
| 4\. | Запад США |
| 5 | Северная Европа |
| 6 | Западная Европа |
| 7 | Юго-Восточная Азия |
| 8 | Восточная часть Японии |
| 9 | Западная часть Японии |
| 10 | Восточная часть Австралии |
| 11 | Юго-Восточная часть Австралии* |
| 12 | Восточная Азия* |
| 13\. | Южно-центральный регион США* |

* В этих регионах хранилище класса Premium запущено недавно.

В этой статье описывается поэтапный процесс развертывания виртуального устройства StorSimple в Azure. После прочтения этой статьи вы узнаете:

- Чем виртуальное устройство отличается от физического.

- Как создавать и настраивать виртуальные устройства.

- Как подключиться к виртуальному устройству.

- Как работать с виртуальным устройством.

Сведения в этом учебнике относятся ко всем виртуальным устройствам StorSimple с обновлением версии 2 или более поздней.

## Отличия виртуального устройства от физического

Виртуальное устройство StorSimple — это программная версия StorSimple, которая выполняется на одном узле в виртуальной машине Microsoft Azure. Виртуальное устройство поддерживает сценарии аварийного восстановления, в которых физическое устройство недоступно. Кроме того, оно подходит для извлечения элементов из резервных копий, локального аварийного восстановления и использования в сценариях облачной разработки и тестирования.

#### Отличия от физического устройства

В следующей таблице приведены основные различия между виртуальными и физическими устройствами StorSimple.

| | Физическое устройство | Виртуальное устройство |
|-----------------------------|----------------------------------------------------------|-------------------------------------------------------------------------------------------|
| **Местоположение.** | Размещается в центре обработки данных. | Выполняется в Azure. |
| **Сетевые интерфейсы** | Включает шесть сетевых интерфейсов: от DATA 0 до DATA 5. | Содержит только один сетевой интерфейс: DATA 0. |
| **Регистрация** | Регистрируется во время настройки. | Регистрация представляет собой отдельную задачу. |
| **Ключ шифрования данных службы** | Повторно создается на физическом устройстве, а затем виртуальное устройство обновляется с помощью нового ключа. | Повторное создание из виртуального устройства невозможно. |


## Предварительные условия (и необходимые компоненты) для виртуального устройства

В следующих разделах разъясняются предварительные условия для настройки виртуального устройства StorSimple. Перед развертыванием виртуального устройства ознакомьтесь с разделом [Рекомендации по безопасности при использовании виртуального устройства](storsimple-security.md#storsimple-virtual-device-security).

#### Требования Azure

Перед подготовкой виртуального устройства вам необходимо будет сделать следующее в среде Azure.

- [Настройте виртуальную сеть в Azure](../virtual-network/virtual-networks-create-vnet-classic-portal.md) для виртуального устройства. При использовании хранилища класса Premium необходимо создать виртуальную сеть в регионе Azure, поддерживающем хранилище класса Premium. Дополнительные сведения о [регионах, которые сейчас поддерживает модель 8020](#supported-regions-for-8020).
- Рекомендуется использовать DNS-сервер по умолчанию, предоставленный Azure, вместо того, чтобы указывать имя собственного DNS-сервера. Если DNS-имя сервера не является допустимым или если DNS-сервер не может правильно разрешать IP-адреса, создание виртуального устройства завершится с ошибкой.
- Подключения типа "точка-сеть" и "сеть-сеть" являются необязательными. При необходимости можно настроить эти параметры для более сложных сценариев.
- Вы можете создать [виртуальные машины Azure](../virtual-machines/virtual-machines-linux-about.md) (серверы узла) в виртуальной сети, которая может использовать тома, предоставляемые виртуальным устройством. Эти серверы должны соответствовать следующим требованиям.
	- Они должны являться виртуальными машинами Windows или Linux с установленным программным обеспечением инициатора iSCSI.
	- Они должны работать в той же виртуальной сети, что и виртуальное устройство.
	- Они должны иметь возможность подключения к платформе iSCSI виртуального устройства по внутреннему IP-адресу виртуального устройства.

- Убедитесь, что вы настроили поддержку iSCSI и облачный трафик в одной виртуальной сети.


#### Требования StorSimple

Внесите следующие изменения в службу Azure StorSimple перед созданием виртуального устройства.


- Добавьте [записи контроля доступа](storsimple-manage-acrs.md) для виртуальных машин, которые будут серверами узла для виртуального устройства.

- Используйте [учетную запись хранения](storsimple-manage-storage-accounts.md#add-a-storage-account), которая находится в том же регионе, что и виртуальное устройство. Если учетные записи хранения находятся в разных регионах, это может привести к сильному понижению производительности. С виртуальным устройством можно использовать учетную запись хранения класса Standard или Premium. Дополнительную информацию о создании новой учетной записи хранения см. в статьях [Учетная запись хранения класса Standard]() и [Учетная запись хранения класса Premium](storage-premium-storage.md#create-and-use-a-premium-storage-account-for-a-virtual-machine-data-disk).

- Для создания виртуального устройства используйте учетную запись хранения, отличную от той, которая используется для ваших данных. Использование той же учетной записи хранения может привести к сильному понижению производительности.

Перед началом работы убедитесь, что у вас есть следующие сведения.

- Учетная запись на классическом портале Azure и учетные данные для доступа.

- Копия ключа шифрования данных службы, полученная с физического устройства.


## Создание и настройка виртуального устройства

Перед выполнением этих процедур убедитесь, что соблюдены [предварительные условия для виртуального устройства](#prerequisites-for-the-virtual-device).

После создания виртуальной сети, настройки службы диспетчера StorSimple и регистрации физического устройства StorSimple в службе вы можете выполнить следующие действия для создания и настройки виртуального устройства StorSimple.

### Шаг 1. Создание виртуального устройства

Выполните указанные ниже действия для создания виртуального устройства StorSimple.

[AZURE.INCLUDE [Создание виртуального устройства](../../includes/storsimple-create-virtual-device-u2.md)]

Если на этом этапе создания виртуального устройства происходит сбой, подключение к Интернету может отсутствовать. Дополнительные сведения см. в разделе о [поиске и устранении ошибок подключения к Интернету](#troubleshoot-internet-connectivity-errors) при создании виртуального устройства.


### Шаг 2. Настройка и регистрация виртуального устройства

Перед тем, как начать эту процедуру, убедитесь, что у вас есть копия ключа шифрования данных службы. Ключ шифрования данных службы был создан при настройке первого устройства StorSimple, и его рекомендовалось сохранить в защищенном месте. Если у вас нет копии ключа шифрования данных службы, следует обратиться в службу поддержки Майкрософт за помощью.

Выполните следующие действия, чтобы настроить и зарегистрировать виртуальное устройство StorSimple.
[AZURE.INCLUDE [Настройка и регистрация виртуального устройства](../../includes/storsimple-configure-register-virtual-device.md)]

### Шаг 3 (необязательный). Изменение параметров конфигурации устройства

В следующем разделе описаны параметры конфигурации устройства, которые необходимо настроить для виртуального устройства StorSimple, если вы хотите использовать CHAP, диспетчер моментальных снимков StorSimple или изменить пароль администратора устройства.

#### Настройка инициатора CHAP

Этот параметр содержит учетные данные, которые виртуальное устройство (целевое устройство) ожидает от инициаторов (серверов), пытающихся получить доступ к томам. Инициаторы предоставят имя пользователя и пароль CHAP для собственной идентификации на устройстве во время проверки подлинности. Подробные инструкции см. в разделе [Настройка CHAP для устройства](storsimple-configure-chap.md#unidirectional-or-one-way-authentication).

#### Настройка целевого устройства CHAP

Этот параметр содержит учетные данные, которые виртуальное устройство использует при запросе взаимной или двунаправленной проверки подлинности инициатором с поддержкой CHAP. Ваше виртуальное устройство будет использовать обратные имя пользователя и пароль CHAP для собственной идентификации в инициаторе во время проверки подлинности. Обратите внимание, что параметры целевого устройства CHAP являются глобальными. При их применении все тома, подключенные к виртуальному устройству для хранения данных, будут использовать проверку подлинности CHAP. Подробные инструкции см. в разделе [Настройка CHAP для устройства](storsimple-configure-chap.md#bidirectional-or-mutual-authentication).

#### Настройка пароля диспетчера моментальных снимков StorSimple

Программное обеспечение диспетчера моментальных снимков StorSimple находится на узле Windows и позволяет администраторам управлять созданием резервных копий для устройства StorSimple в виде локальных и облачных моментальных снимков.

>[AZURE.NOTE] Для виртуального устройства узел Windows — это виртуальная машина Azure.

При настройке устройства в диспетчере моментальных снимков StorSimple вас попросят указать IP-адрес и пароль устройства StorSimple для проверки подлинности устройства для хранения данных. Подробные инструкции см. в разделе [Установка пароля диспетчера моментальных снимков StorSimple](storsimple-change-passwords.md#change-the-storsimple-snapshot-manager-password).

#### Изменение пароля администратора устройства 

При использовании интерфейса Windows PowerShell для доступа к виртуальному устройству вам потребуется ввести пароль администратора устройства. Для обеспечения безопасности ваших данных необходимо изменить этот пароль перед тем, как использовать виртуальное устройство. Подробные инструкции см. в разделе [Установка пароля администратора устройства](storsimple-change-passwords.md#change-the-device-administrator-password).

## Удаленное подключение к виртуальному устройству
Удаленный доступ к виртуальному устройству в интерфейсе Windows PowerShell по умолчанию отключен. Необходимо сначала включить удаленное управление на виртуальном устройстве, а затем включить его в клиенте, который будет использоваться для доступа к виртуальному устройству.

Ниже описаны два этапа для удаленного подключения.

### Шаг 1. Настройка удаленного управления

Выполните следующие действия, чтобы настроить удаленное управление для виртуального устройства StorSimple.

[AZURE.INCLUDE [Настройка удаленного управления по протоколу HTTP для виртуального устройства](../../includes/storsimple-configure-remote-management-http-device.md)]

### Шаг 2. Удаленный доступ к виртуальному устройству

После включения удаленного управления на странице конфигурации устройства StorSimple вы можете использовать удаленное взаимодействие Windows PowerShell для подключения к виртуальному устройству с другой виртуальной машины в той же виртуальной сети; например, вы можете подключиться с виртуальной машины-хоста, которую вы настроили и использовали для подключения iSCSI. В большинстве развертываний у вас уже есть открытая общедоступная конечная точка для доступа к виртуальной машине-хосту, которую можно использовать для доступа к виртуальному устройству.

>[AZURE.WARNING] **Для повышения уровня безопасности настоятельно рекомендуется использовать протокол HTTPS при подключении к конечным точкам и удалении конечных точек после завершения удаленного сеанса PowerShell.**

Процедуры настройки удаленного взаимодействия на виртуальном устройстве описаны в статье [Удаленное подключение к устройству StorSimple](storsimple-remote-connect.md).

## Прямое подключение к виртуальному устройству

Также можно подключиться непосредственно к виртуальному устройству. Если вы хотите подключиться напрямую к виртуальному устройству с другого компьютера, находящегося за пределами виртуальной сети или за пределами среды Microsoft Azure, необходимо создать дополнительные конечные точки, как описано в следующей процедуре.

Выполните следующие действия, чтобы создать общедоступную конечную точку на виртуальном устройстве.

[AZURE.INCLUDE [Создание общедоступных конечных точек на виртуальном устройстве](../../includes/storsimple-create-public-endpoints-virtual-device.md)]

Рекомендуется подключиться с другой виртуальной машины внутри той же виртуальной сети, так как это минимизирует число общедоступных конечных точек в виртуальной сети. При использовании этого метода вы просто подключаетесь к виртуальной машине с помощью сеанса удаленного рабочего стола, а затем настраиваете виртуальную машину так же, как любой другой клиент Windows в локальной сети. Вам не нужно добавлять номер общедоступного порта, так как порт будет уже известен.

## Работа с виртуальным устройством StorSimple

После создания и настройки виртуального устройства StorSimple вы можете начать работу с ним. Работа с контейнерами томов, томами и политиками резервного копирования на виртуальном устройстве аналогична работе с ними на физическом устройстве StorSimple. Единственное отличие состоит в том, что нужно убедиться, что вы выбрали виртуальное устройство из списка устройств. Обратитесь к статье [Управление виртуальным устройством с помощью службы диспетчера StorSimple](storsimple-manager-service-administration.md) для получения пошаговых процедур для различных задач управления виртуальным устройством.

В следующих разделах рассматриваются некоторые отличия, с которыми вы столкнетесь при работе с виртуальным устройством.

### Обслуживание виртуального устройства StorSimple

Так как это программное устройство, обслуживание виртуального устройства сведено к минимуму по сравнению с обслуживанием физического устройства. Доступны следующие варианты:

- **Обновления программного обеспечения** — вы можете просмотреть дату последнего обновления программного обеспечения, а также все сообщения о состоянии обновления. Вы можете нажать кнопку **Проверить наличие обновлений** в нижней части страницы для выполнения проверки вручную, если необходимо проверить наличие обновлений. При их наличии щелкните **Установить обновления**. Так как на виртуальном устройстве есть только один интерфейс, это означает, что при применении обновлений произойдет краткое прерывание в работе служб. Виртуальное устройство будет перезагружено (при необходимости) для применения выпущенных обновлений. Описание пошаговой процедуры см. в статье [Обновление устройства](storsimple-update-device.md#install-regular-updates-via-the-azure-classic-portal).
- **Пакет поддержки** — вы можете создать и отправить пакет поддержки, чтобы помочь службе поддержки Майкрософт в устранении неполадок на виртуальном устройстве. Описание пошаговой процедуры см. в статье [Создание пакетов поддержки и управление ими](storsimple-create-manage-support-package.md).

### Учетные записи хранения для виртуального устройства

Учетные записи хранения используются в службе диспетчера StorSimple, на виртуальных и физических устройствах. При создании учетных записей хранения в понятном имени рекомендуется использовать идентификатор региона, чтобы упростить обеспечение использования одного и тот же региона во всех компонентах системы. Для виртуального устройства важно, чтобы все компоненты находились в одном регионе, чтобы предотвратить понижение производительности.

Описание пошаговой процедуры см. в статье [Добавление учетной записи хранения](storsimple-manage-storage-accounts.md#add-a-storage-account).

### Деактивация виртуального устройства StorSimple

При деактивации виртуального устройства будет удалена виртуальная машина и ресурсы, созданные при ее подготовке. После деактивации виртуального устройства его невозможно вернуть в предыдущее состояние. Перед деактивацией виртуального устройства убедитесь, что остановили или удалили клиенты и узлы, зависящие от него.

Деактивация виртуального устройства приведет к следующим действиям:

- Виртуальное устройство будет удалено.

- Диск ОС и диски данных, созданные для виртуального устройства, будут удалены.

- Размещенная служба и виртуальная сеть, созданные во время подготовки, будут сохранены. Если вы не используете их, удалите их вручную.

- Облачные моментальные снимки, созданные для виртуального устройства, будут сохранены.

Описание пошаговой процедуры см. в статье [Отключение и удаление устройства StorSimple](storsimple-deactivate-and-delete-device.md).

После того как виртуальное устройство будет показано как деактивированное на странице службы диспетчера StorSimple, вы сможете удалить виртуальное устройство из списка устройств на странице **Устройства**.


### Запуск, остановка и перезапуск виртуального устройства
В отличие от физического устройства StorSimple на виртуальном устройстве StorSimple нет кнопки включения и выключения питания. Однако иногда возникают ситуации, когда необходимо остановить и перезапустить виртуальное устройство. Например, для завершения некоторых обновлений может потребоваться перезапуск виртуальной машины. Самый простой способ запуска, остановки и перезапуска виртуального устройства — использовать консоль управления виртуальными машинами.

Состояние виртуального устройства в консоли управления — **Работает**, так как оно запускается по умолчанию после создания. Вы можете запустить, остановить и перезапустить виртуальную машину в любое время.

[AZURE.INCLUDE [Остановка и перезапуск виртуального устройства](../../includes/storsimple-stop-restart-virtual-device.md)]

### Сброс к параметрам по умолчанию

Если вы хотите заново настроить виртуальное устройство, просто деактивируйте и удалите его, а затем создайте новое. Как и при сбросе физического устройства на новом виртуальном устройстве не будут установлены обновления, поэтому прежде чем использовать его, проверьте их наличие.


## Отработка отказа для виртуального устройства

Аварийное восстановление — это один из основных сценариев, для которых разработано виртуальное устройство StorSimple. В этом сценарии физическое устройство StorSimple или весь центр обработки данных могут быть недоступны. Однако вы можете использовать виртуальное устройство для восстановления операций в другом местоположении. Во время аварийного восстановления контейнеры томов из исходного устройства сменят владельца и будут перемещены на виртуальное устройство. Предварительные требования для аварийного восстановления включают создание и настройку виртуального устройства, отключение всех томов в контейнере томов и связь контейнера томов с облачным моментальным снимком.

>[AZURE.NOTE] 
>
> - При использовании виртуального устройства в качестве вторичного устройства для аварийного восстановления следует помнить, что устройство 8010 имеет 30 ТБ в хранилище класса Standard, а устройство 8020 — 64 ТБ в хранилище класса Premium. Виртуальное устройство большей емкости 8020 может лучше подходить для сценария аварийного восстановления.
> - Вы не можете выполнить отработку отказа или клонирование с устройства с обновлением версии 2 на устройство с предварительным обновлением версии 1. Однако отработку отказа с устройства с обновлением версии 2 на устройство с обновлением версии 1 (1.1 или 1.2) выполнить можно.

Описание пошаговой процедуры см. в статье [Отработка отказа на виртуальное устройство](storsimple-device-failover-disaster-recovery.md#fail-over-to-a-storsimple-virtual-device).
 

## Завершение работы или удаление виртуального устройства

Если вы ранее настроили и использовали виртуальное устройство StorSimple, но сейчас хотите остановить выставление счетов за вычисления, связанные с его использованием, можно завершить работу виртуального устройства. При завершении работы виртуального устройства его операционная система и диски с данными в хранилище не удаляются. Начисление расходов для подписки останавливается, но плата за хранилище для ОС и дисков с данными будет взиматься и дальше.

При удалении или завершении работы виртуального устройства оно отобразится на странице «Устройства» службы диспетчера StorSimple как **Автономное**. Вы можете деактивировать или удалить устройство, если необходимо также удалить резервные копии, созданные виртуальным устройством. Дополнительные сведения см. в статье [Отключение и удаление устройства StorSimple](storsimple-deactivate-and-delete-device.md).

[AZURE.INCLUDE [Завершение работы виртуального устройства](../../includes/storsimple-shutdown-virtual-device.md)]

[AZURE.INCLUDE [Удаление виртуального устройства](../../includes/storsimple-delete-virtual-device.md)]

   
## Поиск и устранение ошибок подключения к Интернету 

Если в ходе создания виртуального устройства прерывается подключение к Интернету, этот этап завершается ошибкой. Чтобы проверить, является ли причиной сбоя отсутствие подключения к Интернету, на классическом портале Azure выполните следующие действия.

1. Создайте в Azure виртуальную машину под управлением Windows Server 2012. Важно, чтобы для этой виртуальной машины использовалась та же учетная запись хранения, виртуальная сеть и подсеть, что и для нового виртуального устройства. Если в Azure уже имеется узел Windows Server, использующий ту же учетную запись хранения, виртуальную сеть и подсеть, вы можете использовать его для поиска и устранения ошибок подключения к Интернету.
2. Войдите удаленно на виртуальную машину, созданную на предыдущем этапе.
3. Откройте окно командной строки на виртуальной машине (нажмите Win + R, затем введите `cmd`).
4. Выполните в командной строке следующий командлет.

	`nslookup windows.net`

5. Если командлет `nslookup` завершается ошибкой, это значит, что виртуальное устройство нельзя зарегистрировать в службе диспетчера StorSimple из-за ошибки подключения к Интернету.
6. Внесите необходимые изменения в свою виртуальную сеть, чтобы обеспечить доступ виртуального устройства к сайтам Azure, таким как windows.net.

## Дальнейшие действия

- Узнайте, как [управлять виртуальным устройством с помощью службы диспетчера StorSimple](storsimple-manager-service-administration.md).
 
- Узнайте, как [восстановить том StorSimple из резервного набора данных](storsimple-restore-from-backup-set.md).

<!---HONumber=AcomDC_0928_2016-->