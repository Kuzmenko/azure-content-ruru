<properties
pageTitle="Добавление библиотек Hive во время создания кластера HDInsight | Azure"
description="Узнайте, как добавлять библиотеки Hive (JAR-файлы) в кластер HDInsight во время создания кластера."
services="hdinsight"
documentationCenter=""
authors="Blackmist"
manager="jhubbard"
editor="cgronlun"/>

<tags
ms.service="hdinsight"
ms.devlang="na"
ms.topic="article"
ms.tgt_pltfrm="na"
ms.workload="big-data"
ms.date="09/20/2016"
ms.author="larryfr"/>

#Добавление библиотек Hive во время создания кластера HDInsight

Если у вас есть библиотеки, которые часто используются с Hive в HDInsight, ознакомьтесь с этим документом, содержащим сведения об использовании действия сценария для предварительной загрузки библиотек во время создания кластера. В этом случае библиотеки становятся глобально доступными в рамках Hive (не нужно использовать команду [добавления JAR-файла](https://cwiki.apache.org/confluence/display/Hive/LanguageManual+Cli) для их загрузки).

##Принцип работы

При создании кластера можно указать действие сценария, которое запускает сценарий на узлах кластера во время их создания. Сценарий в этом документе принимает один параметр, которым является расположение WASB с библиотеками (сохраненными как JAR-файлы), которые будут предварительно загружены.

Во время создания кластера сценарий перечисляет файлы, копирует их в каталог `/usr/lib/customhivelibs/` на головных и рабочих узлах, а затем добавляет их в свойство `hive.aux.jars.path` в файле `core-site.xml`. Для кластеров под управлением Linux он также обновляет файл `hive-env.sh` расположением файлов.

> [AZURE.NOTE] В результате использования действий сценариев, приведенных в этой статье, библиотеки будут доступны в следующих случаях.
>
> * __HDInsight под управлением Linux__ — при использовании __командной строки Hive__, __WebHCat__ (Templeton) и __HiveServer2__.
> * __HDInsight под управлением Windows__ — при использовании __командной строки Hive__ и __WebHCat__ (Templeton).

##Сценарий

__Расположение сценария__

Для __кластеров под управлением Linux__: [https://hdiconfigactions.blob.core.windows.net/linuxsetupcustomhivelibsv01/setup-customhivelibs-v01.sh](https://hdiconfigactions.blob.core.windows.net/linuxsetupcustomhivelibsv01/setup-customhivelibs-v01.sh)

Для __кластеров под управлением Windows__: [https://hdiconfigactions.blob.core.windows.net/setupcustomhivelibsv01/setup-customhivelibs-v01.ps1](https://hdiconfigactions.blob.core.windows.net/setupcustomhivelibsv01/setup-customhivelibs-v01.ps1).

__Требования__

* Сценарии необходимо применять к __головным узлам__ и __рабочим узлам__.

* JAR-файлы, которые нужно установить, должны храниться в хранилище BLOB-объектов Azure в __одном контейнере__.

* Учетная запись хранилища, содержащая библиотеку JAR-файлов, __должна__ быть связана с кластером HDInsight во время создания. Существует два способа выполнения этой задачи:

    * В контейнере в учетной записи хранения по умолчанию для кластера.
    
    * В контейнере связанного хранилища. Например, для добавления дополнительного хранилища на портале можно использовать колонку __Необязательная конфигурация__ и параметр __Связанные учетные записи хранения__.

* Путь WASB к контейнеру необходимо указать в виде параметра для действия сценария. Например, если JAR-файлы хранятся в контейнере __libs__ в учетной записи хранения __mystorage__, то параметром будет \_\_wasbs://libs@mystorage.blob.core.windows.net/__.

    > [AZURE.NOTE] В этом документе предполагается, что вы уже создали учетную запись хранения и контейнер BLOB-объектов и отправили в него файлы.
    >
    > Если учетная запись хранения не создана, создайте ее на [портале Azure](https://portal.azure.com). Затем с помощью служебной программы, такой как [обозреватель хранилищ Azure](http://storageexplorer.com/), в учетной записи можно создать контейнер и отправить в него файлы.

##Создание кластера с помощью сценария

> [AZURE.NOTE] В следующей процедуре создается кластер HDInsight под управлением Linux. Чтобы создать кластер под управлением Windows, выберите __Windows__ в качестве ОС кластера и вместо сценария bash используйте сценарий Windows (PowerShell).
> 
> Для создания кластера с помощью этого сценария также можно использовать Azure PowerShell или пакет SDK HDInsight для .NET. Дополнительную информацию об использовании этих методов см. в статье [Настройка кластеров HDInsight с помощью действий сценария](hdinsight-hadoop-customize-cluster-linux.md).

1. Начните подготовку кластера с помощью действий, описанных в статье [Подготовка кластеров HDInsight под управлением Linux](hdinsight-hadoop-provision-linux-clusters.md#portal), но не завершайте ее.

2. В колонке **Необязательная конфигурация** выберите **Действия скрипта** и введите следующие сведения:

    * __ИМЯ__: введите понятное имя для действия сценария.
    * __УНИВЕРСАЛЬНЫЙ КОД РЕСУРСА (URI) СКРИПТА__: https://hdiconfigactions.blob.core.windows.net/linuxsetupcustomhivelibsv01/setup-customhivelibs-v01.sh.
    * __ГОЛОВНОЙ__: установите флажок.
    * __РАБОЧАЯ РОЛЬ__: установите флажок.
    * __ZOOKEEPER__: оставьте это поле пустым.
    * __ПАРАМЕТРЫ__: введите адрес WASB к контейнеру и учетной записи хранения, содержащий JAR-файлы. Например: \_\_wasbs://libs@mystorage.blob.core.windows.net/__.

3. В нижней части раздела **Действия сценария** нажмите кнопку **Выбрать**, чтобы сохранить конфигурацию.

4. В колонке **Необязательная конфигурация** выберите __Связанные учетные записи хранения__ и щелкните ссылку __Добавить ключ хранилища__. Выберите учетную запись, которая содержит JAR-файлы, а затем с помощью кнопок __Выбрать__ сохраните настройки и вернитесь к колонке __Необязательная конфигурация__.

5. Нажмите кнопку **Выбрать** в нижней части колонки **Необязательная конфигурация**, чтобы сохранить необязательную конфигурацию.

6. Продолжите подготовку кластера, как описано в статье [Подготовка кластеров HDInsight под управлением Linux](hdinsight-hadoop-provision-linux-clusters.md#portal).

После создания кластера вы сможете использовать JAR-файлы, добавленные с помощью этого сценария из Hive, без инструкции `ADD JAR`.

##Дальнейшие действия

В этом документе вы узнали, как добавлять библиотеки Hive, содержащиеся в JAR-файлах, в кластер HDInsight во время его создания. Дополнительные сведения о работе с Hive см. в статье [Использование Hive с HDInsight](hdinsight-use-hive.md).

<!---HONumber=AcomDC_0921_2016-->