<properties
pageTitle="Использование средств Microsoft Azure Data Lake для Visual Studio с песочницей Hortonworks | Microsoft Azure"
description="Узнайте, как использовать средства Azure Data Lake для Visual Studio с песочницей Hortonworks (работающей в локальной виртуальной машине). С помощью этих средств можно создавать и выполнять задания Hive и Pig в песочнице и просматривать выходные данные и журнал задания."
services="hdinsight"
documentationCenter=""
authors="Blackmist"
manager="paulettm"
editor="cgronlun"/>

<tags
ms.service="hdinsight"
ms.devlang="na"
ms.topic="article"
ms.tgt_pltfrm="na"
ms.workload="big-data"
ms.date="08/26/2016"
ms.author="larryfr"/>

# Использование средств Azure Data Lake для Visual Studio с песочницей Hortonworks

Средства Azure Data Lake для Visual Studio включают в себя средства для работы с универсальными кластерами Hadoop, а также средства для работы с Azure Data Lake и HDInsight. В этом документе описываются действия, необходимые для использования средств Azure Data Lake с песочницей Hortonworks, работающей в локальной виртуальной машине.

Использование песочницы Hortonworks позволяет работать с Hadoop локально в среде разработки. Если вам необходимо развернуть решение в нужном масштабе после его разработки, можно перейти к кластеру HDInsight.

## Предварительные требования

* Песочница Hortonworks, работающая в виртуальной машине в среде разработки. Описанные здесь сведения протестированы с использованием песочницы, работающей в Oracle VirtualBox, настроенном согласно инструкциям в документе [Начало работы в экосистеме Hadoop с песочницей Hadoop на виртуальной машине](hdinsight-hadoop-emulator-get-started.md).

* Visual Studio 2013 или 2015, любой выпуск.

* [Пакет Azure SDK для .NET](https://azure.microsoft.com/downloads/) версии 2.7.1 или более поздней.

* [Средства Azure Data Lake для Visual Studio](https://www.microsoft.com/download/details.aspx?id=49504).

## Настройка паролей для песочницы

Убедитесь, что песочница Hortonworks работает, а затем следуйте инструкциям в статье [Начало работы в экосистеме Hadoop с песочницей Hadoop на виртуальной машине](hdinsight-hadoop-emulator-get-started.md#set-passwords), чтобы настроить пароль для учетной записи SSH `root` и учетной записи Ambari `admin`. Эти пароли будут использоваться при подключении к песочнице из Visual Studio.

## Подключение инструментов к песочнице

1. Откройте Visual Studio и выберите __Просмотреть__, а затем __Обозреватель серверов__.

2. В окне __Обозреватель серверов__ щелкните правой кнопкой мыши запись __HDInsight__, а затем выберите __Connect to HDInsight Emulator__ (Подключиться к эмулятору HDInsight).

    ![Подключение к эмулятору HDInsight](./media/hdinsight-hadoop-emulator-visual-studio/connect-emulator.png)

3. В диалоговом окне __Connect to HDInsight Emulator__ (Подключение к эмулятору HDInsight) введите пароль, настроенный для Ambari.

    ![Ввод пароля Ambari](./media/hdinsight-hadoop-emulator-visual-studio/enter-ambari-password.png)

    Нажмите кнопку __Далее__, чтобы продолжить.

4. В поле __Пароль__ введите пароль, настроенный для учетной записи `root`. Оставьте в остальных полях значения по умолчанию.

    ![Ввод пароля пользователя root](./media/hdinsight-hadoop-emulator-visual-studio/enter-root-password.png)

    Нажмите кнопку __Далее__, чтобы продолжить.

5. Подождите, пока не завершится проверка служб. В некоторых случаях проверка может завершиться ошибкой, и тогда появится запрос на обновление конфигурации. В этом случае нажмите кнопку __Обновить__ и подождите, пока не завершится настройка и проверка службы.

    ![Ошибки и кнопка "Обновить"](./media/hdinsight-hadoop-emulator-visual-studio/fail-and-update.png)

    > [AZURE.NOTE] В процессе обновления используется Ambari, чтобы изменить конфигурацию песочницы Hortonworks до ожидаемых значений для средств Azure Data Lake для Visual Studio.

    После завершения проверки нажмите кнопку __Готово__, чтобы завершить настройку.

    ![Завершение подключения](./media/hdinsight-hadoop-emulator-visual-studio/finished-connect.png)

    > [AZURE.NOTE] В зависимости от скорости среды разработки и объема памяти, выделенного для виртуальной машины, настройка и проверка служб может занять несколько минут.

После выполнения этих действий в обозревателе серверов в разделе HDInsight появится запись HDInsight local cluster (Локальный кластер HDInsight).

## Написание запроса Hive

Hive предоставляет язык запросов по типу SQL (HiveQL) для работы со структурированными данными. Чтобы узнать, как выполнять ad-hoc-запросы к локальному кластеру, сделайте следующее:

1. На вкладке __Обозреватель серверов__ щелкните правой кнопкой мыши добавленную ранее запись для локального кластера, а затем выберите __Write a Hive query__ (Написать запрос Hive).

    ![Написание запроса Hive](./media/hdinsight-hadoop-emulator-visual-studio/write-hive-query.png)

    Откроется новое окно запроса, в котором можно быстро ввести и отправить запрос в локальный кластер.

2. В новом окне создания запроса введите следующее:

        select count(*) from sample_08;
    
    В верхней части окна запроса выберите конфигурацию для локального кластера, а затем нажмите кнопку __Отправить__. Оставьте в остальных полях (__Пакет__ и "Имя сервера") значения по умолчанию.

    ![Окно запроса и кнопка "Отправить"](./media/hdinsight-hadoop-emulator-visual-studio/submit-hive.png)

    Обратите внимание, что можно также использовать раскрывающееся меню рядом с кнопкой __Отправить__, чтобы открыть меню __Дополнительно__. Откроется диалоговое окно, в котором можно указать дополнительные параметры при отправке задания.

    ![Расширенная отправка](./media/hdinsight-hadoop-emulator-visual-studio/advanced-hive.png)

3. После отправки запроса отобразится состояние задания. В нем содержатся сведения о ходе обработки задания с помощью Hadoop. В записи __Состояние задания__ отображается текущее состояние задания. Это состояние будет периодически обновляться. Его также можно обновить вручную, щелкнув значок обновления.

    ![Состояние задания](./media/hdinsight-hadoop-emulator-visual-studio/job-state.png)

    Как только значение записи __Состояние задания__ изменится на __Завершено__, отобразится направленный ациклический граф. Это путь выполнения, определенный с помощью Tez (механизм выполнения по умолчанию для Hive в локальном кластере).
    
    > [AZURE.NOTE] Tez также используется по умолчанию при использовании кластеров HDInsight под управлением Linux. Он не используется по умолчанию в HDInsight под управлением Windows. Чтобы его использовать, необходимо добавить строку `set hive.execution.engine = tez;` в начало запроса Hive.

    Воспользуйтесь ссылкой __Job Output__ (Выходные данные задания), чтобы просмотреть выходные данные. В данном случае это __823__ — количество строк в таблице sample\_08. Диагностические сведения о задании можно просмотреть, воспользовавшись ссылками __Журнал задания__ и __Download YARN Log__ (Скачать журнал YARN).

4. Кроме того, можно выполнять задания Hive интерактивно. Для этого нужно изменить значение поля __Пакет__ на __Интерактивный__, а затем нажать кнопку __Выполнить__.

    ![Интерактивный запрос](./media/hdinsight-hadoop-emulator-visual-studio/interactive-query.png)

    В результате этого журнал выходных данных, созданный во время обработки, буде передан в окно __HiveServer2 Output__ (Выходные данные HiveServer2).
    
    > [AZURE.NOTE] Это те же сведения, которые можно получить, перейдя по ссылке __Журнал задания__ после завершения задания.

    ![Выходные данные HiveServer2](./media/hdinsight-hadoop-emulator-visual-studio/hiveserver2-output.png)

## Создание проекта Hive

Вы также можете создать проект, который содержит несколько скриптов Hive. Это полезно при наличии связанных скриптов, которые необходимо хранить вместе или поддерживать с помощью систем управления версиями.

1. Откройте Visual Studio, выберите __Файл__, __Создать__, а затем "Проект".

2. В списке проектов разверните список __Шаблоны__, __Azure Data Lake__, а затем выберите __HIVE (HDInsight)__. В списке шаблонов выберите __Hive Sample__ (Пример Hive). Введите имя и расположение, а затем нажмите кнопку __ОК__.

    ![Шаблон Hive (HDInsight)](./media/hdinsight-hadoop-emulator-visual-studio/new-hive-project.png)

Проект __Hive Sample__ (Пример Hive) содержит два скрипта: __WebLogAnalysis.hql__ и __SensorDataAnalysis.hql__. Их можно отправить, нажав все ту же кнопку __Отправить__ в верхней части окна.

## Создание проекта Pig

Тогда как Hive предоставляет язык по типу SQL для работы со структурированными данными, Pig предоставляет язык (Pig Latin), с помощью которого можно разрабатывать конвейер преобразований, применяемых к данным. Чтобы использовать Pig в локальном кластере, сделайте следующее:

1. Откройте Visual Studio, выберите __Файл__, __Создать__, а затем __Проект__. В списке проектов разверните список __Шаблоны__, __Azure Data Lake__, а затем выберите __Pig (HDInsight)__. В списке шаблонов выберите __Pig Application__ (Приложение Pig). Введите имя и расположение, а затем нажмите кнопку __ОК__.

    ![Проект Pig (HDInsight)](./media/hdinsight-hadoop-emulator-visual-studio/new-pig.png)

2. Введите следующее в качестве содержимого файла __script.pig__, созданного с помощью этого проекта.

        a = LOAD '/demo/data/Website/Website-Logs' AS (
            log_id:int, 
            ip_address:chararray, 
            date:chararray, 
            time:chararray, 
            landing_page:chararray, 
            source:chararray);
        b = FILTER a BY (log_id > 100);
        c = GROUP b BY ip_address;
        DUMP c;

    Хотя в Pig и Hive используются разные языки, способ выполнения задания одинаковый для обоих языков (нужно нажать кнопку __Отправить__). Если выбрать раскрывающийся список рядом с кнопкой __Отправить__, отобразится диалоговое окно расширенной отправки для Pig.

    ![Расширенная отправка Pig](./media/hdinsight-hadoop-emulator-visual-studio/advanced-pig.png)
    
3. Состояние задания и выходные данные отображаются так же, как и для запроса Hive.

    ![Изображение завершенного задания Pig](./media/hdinsight-hadoop-emulator-visual-studio/completed-pig.png)

## Просмотр заданий

Средства Azure Data Lake также позволяют с легкостью просмотреть сведения о заданиях, выполненных на Hadoop. Чтобы увидеть задания, выполненные в локальном кластере, сделайте следующее:

1. В окне __Обозреватель серверов__ щелкните правой кнопкой мыши локальный кластер, а затем выберите __Просмотреть задания__. Отобразится список заданий, переданных в кластер.

    ![Просмотр заданий](./media/hdinsight-hadoop-emulator-visual-studio/view-jobs.png)

2. Выберите в этом списке задание, чтобы просмотреть сведения о нем.

    ![Выбор задания](./media/hdinsight-hadoop-emulator-visual-studio/view-job-details.png)

    Отображаемые сведения похожи на сведения, отображаемые после выполнения запроса Pig и Hive, дополненные ссылками для просмотра выходных данных и сведений журнала.

3. Кроме того, на этом этапе можно изменить и повторно отправить задания.

## Просмотр баз данных Hive

1. В окне __Обозреватель серверов__ разверните запись __HDInsight local cluster__ (Локальный кластер HDInsight), а затем — __Hive Databases__ (Базы данных Hive). В результате этого в локальном кластере отобразятся базы данных __По умолчанию__ и __xademo__. Если развернуть базу данных, отобразятся все таблицы, содержащиеся в ней.

    ![Развернутые базы данных](./media/hdinsight-hadoop-emulator-visual-studio/expanded-databases.png)

2. Если развернуть таблицу, отобразятся все столбцы этой таблицы. Чтобы быстро просмотреть данные, можно щелкнуть таблицу правой кнопкой мыши и выбрать __View Top 100 Rows__ (Просмотреть первые 100 строк).

    ![Просмотр баз данных Hive](./media/hdinsight-hadoop-emulator-visual-studio/view-100.png)

### Свойства базы данных и таблицы

Возможно, вы уже заметили, что можно просмотреть __свойства__ базы данных или таблицы. После нажатия соответствующего элемента отобразятся сведения для выбранного объекта в окне "Свойства".

![Свойства](./media/hdinsight-hadoop-emulator-visual-studio/properties.png)

### Создание таблицы

Чтобы создать таблицу, щелкните базу данных правой кнопкой мыши и выберите __Создать таблицу__.

![Создание таблицы](./media/hdinsight-hadoop-emulator-visual-studio/create-table.png)

Затем можно создать таблицу с помощью формы. Вы увидите необработанный скрипт HiveQL, который будет использоваться для создания таблицы в нижней части этой страницы.

![Форма создания таблицы](./media/hdinsight-hadoop-emulator-visual-studio/create-table-form.png)

## Дальнейшие действия

* [Learning the ropes of the Hortonworks Sandbox](http://hortonworks.com/hadoop-tutorial/learning-the-ropes-of-the-hortonworks-sandbox/) (Общие сведения о разработке песочницы Hortonworks)
* [Hadoop tutorial - Getting started with HDP](http://hortonworks.com/hadoop-tutorial/hello-world-an-introduction-to-hadoop-hcatalog-hive-and-pig/) (Руководство по Hadoop. Начало работы с HDP)

<!---HONumber=AcomDC_0921_2016-->