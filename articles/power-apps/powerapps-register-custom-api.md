<properties
	pageTitle="Как использовать пользовательские интерфейсы API с логическими потоками и PowerApps | Microsoft Azure"
	description="Что такое пользовательские интерфейсы API, использование поставщиков OAuth и применение Swagger для добавления пользовательских интерфейсов API в PowerApps и логические потоки"
	services=""
    suite="powerapps"
	documentationCenter="" 
	authors="sunaysv"
	manager="erikre"
	editor=""/>

<tags
   ms.service="powerapps"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na" 
   ms.date="07/12/2016"
   ms.author="mandia"/>

# Что такое пользовательские интерфейсы API

Пользовательские интерфейсы API — это любые интерфейсы API RESTful, которые можно использовать с PowerApps и логическими потоками. Эти API-интерфейсы могут размещаться в любом месте при условии, что доступна хорошо документированная спецификация, которая соответствует стандарту [OpenAPI][1].

>[AZURE.IMPORTANT] Этот раздел перемещен на сайт powerapps.microsoft.com в статью [What are custom APIs](https://powerapps.microsoft.com/tutorials/register-custom-api/) (Что такое пользовательские API). См. последнюю версию на сайте PowerApps. Эта статья Azure архивируется.

## Что необходимо для начала работы

- Пользовательские интерфейсы API доступны всем пользователям PowerApps. PowerApps Enterprise не требуется.
- Необходимы файл Swagger (.json) и значок для пользовательского API. В этом разделе описано несколько вариантов создания файла Swagger. Для значка можно использовать любое изображение.


## Аутентификация

Можно использовать один из следующих способов проверки подлинности:

- Обычная проверка подлинности
- OAuth 2.0: далее перечислены все поставщики OAuth 2.0, которые поддерживаются для пользовательского интерфейса API (поддержка других поставщиков ожидается в ближайшее время).

	- Azure Active Directory
	- Box
	- DropBox
	- Facebook
	- Google
	- Instagram
	- OneDrive
	- SalesForce
	- Slack
	- Yammer

> [AZURE.NOTE] Поддержка проверки подлинности с ключом API ожидается в ближайшее время.


Дополнительные сведения об указании типа проверки подлинности приведены в документе OpenAPI (Swagger) в [спецификации OpenAPI][1].

Если конечная точка API разрешает доступ без проверки подлинности, следует удалить объект ```securityDefintions``` из файла OpenAPI (Swagger). В следующем примере удалите все вхождения объекта ```securityDefintions```:

```
  "securityDefinitions": {
    "AAD": {
      "type": "oauth2",
      "flow": "implicit",
      "authorizationUrl": "https://login.windows.net/common/oauth2/authorize",
      "scopes": []
    }
  },
```

> [AZURE.TIP] В файлах .json нельзя добавлять комментарии. Весь текст в этом файле считается частью данных.

### Примеры проверки подлинности
* [Azure Resource Manager](powerapps-azure-resource-manager-tutorial.md) с проверкой подлинности AAD.
* [Azure WebApp](powerapps-web-api-tutorial.md) с проверкой подлинности AAD.

## Регистрация пользовательского интерфейса API

### Шаг 1. Создайте файл Swagger

Файл Swagger можно создать из **любой** конечной точки API, примеры которых перечислены ниже.

- Любой интерфейс API, который опубликован и общедоступен. Некоторые примеры включают [Spotify][2], [Uber][3], [Slack][4], [Rackspace][5] и т. д.
- Интерфейс API, который создается и развертывается в любой облачной службе, в которой можно развертывать веб-приложения, включая Amazon Web Services (AWS), Heroku, веб-приложения Azure, Google Cloud и многое другое.
- Интерфейс API, развернутый в вашей сети или на вашем компьютере, при условии, что этот интерфейс API публично доступен в Интернете.

Когда вы создаете файл Swagger, создается JSON-файл. Держите этот JSON-файл под рукой.

#### Дополнительные сведения о создании файлов Swagger

- Если вы не имеете достаточно опыта в создании файлов Swagger или никогда не создавали их ранее, см. статью [Get started with Swagger][6] \(Приступая к работе со Swagger).
 
- Для создания собственного API, его развертывания в Azure и создания нового файла Swagger на основе этого нового API-интерфейса обратитесь к [руководству по веб-API](powerapps-web-api-tutorial.md). Выполнив действия из этого учебника, вы получите рабочий файл Swagger. Также воспользуйтесь [примером Hello World][7] в GitHub.

- Чтобы проверить файлы Swagger, используйте [редактор Swagger][8]. В него можно вставлять данные .json, и проверка будет выполнена автоматически.

- Для настройки документа Swagger таким образом, чтобы он работал с PowerApps и логическими последовательностями, см. статью [Настройка определения Swagger для PowerApps и логических потоков](powerapps-how-to-swagger.md).

### Шаг 2. Добавьте подключение для пользовательского интерфейса API
Теперь после создания файла Swagger (JSON-файл) для пользовательского интерфейса API добавьте подключение к PowerApps. Вам также потребуется значок для пользовательского API.

1. Перейдите на [веб-портал][9] PowerApps и войдите с помощью рабочей учетной записи.

	> [AZURE.NOTE] Сейчас пользовательские интерфейсы API могут использоваться только на веб-портале PowerApps. Их нельзя применять в клиенте PowerApps.

2. Выберите **Подключения**, а затем щелкните **Добавить подключение**:  
	![](./media/powerapps-register-custom-api/createnewconnection.png "Создание пользовательского интерфейса API")  

3. Выберите **Add a custom API** (Добавить пользовательский API):  
	![](./media/powerapps-register-custom-api/connecttocustomapi.png "Создание пользовательского интерфейса API")  
	Добавьте свойства API, в том числе файл JSON и файл значка. Затем нажмите кнопку **Далее**:  

	|Свойство|Описание|
|---|---|
|Имя|Введите имя пользовательского интерфейса API. Если это пример веб-API, можно назвать его **MySampleWebAPI**.|
|Определение интерфейса API Swagger|Перейдите к файлу JSON, созданному на основе Swagger.|
|Отправка значка для интерфейса API|Выберите файл значка.|
|Описание|Введите описание для пользовательского интерфейса API. Если это пример веб-API, можно ввести **Пример из руководства по веб-API**.|

4. Укажите все свойства проверки подлинности. Если JSON-файл использует проверку подлинности OAuth2 для объекта ```securityDefintions```, будут запрошены следующие значения:

	|Свойство|Описание|
|---|---|
|Идентификатор клиента|Идентификатор клиента предоставляется с помощью одного из поддерживаемых поставщиков удостоверений OAuth (перечисленных в этом разделе). Введите этот идентификатор клиента.
|Секрет клиента|Введите секрет клиента для выбранного поставщика удостоверений.|  

	В разделе **Примеры проверки подлинности** этой статьи приведены примеры этих свойств OAuth.

	Если в JSON-файле не используется объект ```securityDefintions```, дополнительные параметры могут не потребоваться.

5. Нажмите кнопку **Создать**. Теперь ваш пользовательский API отображается в списке **Доступные подключения**:  

	![](./media/powerapps-register-custom-api/mycustomapi.png "Доступные подключения")  


> [AZURE.TIP] Если не удается проверить файлы Swagger, в них могут отсутствовать необходимые символы. Например, практически все данные, в том числе адреса сайтов, должны быть в кавычках. Поэтому, если адрес `https://mywebapi.mywebsite.com` указан без кавычек, файл не пройдет проверку.


### Шаг 3. Добавление пользовательского интерфейса API в логический поток и PowerApp
Теперь вы можете использовать интерфейс API с PowerApp или логическим потоком. В этом разделе мы рассмотрим пользовательский интерфейс API для погоды.

#### Добавление пользовательского API к логическому потоку
На этом этапе мы создадим очень простой логический поток, чтобы показать, как добавить к нему пользовательский API. Более подробное описание см. в статье [Get started with logic flows][10] \(Приступая к работе с логическими последовательностями).

1. На [веб-портале][9] PowerApps перейдите на вкладку **Home** (Главная).
2. В разделе **Make a logic flow** (Создание логической последовательности) выберите **Get started** (Начать).
3. В этом окне уже есть шаблоны для нескольких логических потоков, использующих некоторые распространенные сценарии. Можно использовать любой из этих шаблонов и добавить к нему свой пользовательский интерфейс API. Или же можно выбрать **Create from blank** (Создать с нуля) для создания логической последовательности с нуля.

	Самый быстрый способ добавления пользовательского API — **создание с нуля**. Откроется следующая логическая последовательность:  
	![](./media/powerapps-register-custom-api/createfromblank.png "Запуск логического потока")    

4. Выберите **Recurrence** (Периодичность) и установите частоту в 1 минуту:    
	![](./media/powerapps-register-custom-api/logicrecurrence.png "Выбор периодичности")  	

5. Выберите значок "плюс" (![](./media/powerapps-register-custom-api/flowplussign.png)), а затем выберите **Периодичность** (Добавить действие). В списке появится ваш пользовательский API-интерфейс:  
![](./media/powerapps-register-custom-api/logicflow.png "Ваш пользовательский интерфейс API") 

Дальнейшие действия определяются тем, что может делать ваш интерфейс API. Например, в примере с погодой ваш интерфейс API может возвращать текущую температуру, а затем отправлять сообщение электронной почты с помощью Office 365:

![](./media/powerapps-register-custom-api/logicflowexample.png "Пример погоды")



#### Добавление пользовательского API к PowerApp
На этом этапе мы создадим очень простое приложение PowerApp, чтобы показать, как добавить к нему пользовательский API. Более подробное описание см. в статье [Create an app from Excel data][11] \(Создание приложения из данных Excel).

> [AZURE.NOTE] Сейчас пользовательские интерфейсы API могут использоваться только на веб-портале PowerApps. Их нельзя применять в клиенте PowerApps.

1. На [веб-портале][9] PowerApps выберите **New PowerApp** (Создать приложение PowerApp):  
	![](./media/powerapps-register-custom-api/newpowerapp.png "Создание нового приложения PowerApp")  
2. В браузере откроется новая вкладка. На этой вкладке будет автоматически создано пустое приложение PowerApp. Выберите **Connect to data** (Подключиться к данным):  
![](./media/powerapps-register-custom-api/blankpowerapp.png "Выбор подключения к данным")  
3. На вкладке **Content** (Содержимое) выберите **Data sources** (Источники данных):  
![](./media/powerapps-register-custom-api/datasources.png "Выбор подключения к данным")  
4. В новом окне в списке **My connections** (Мои подключения) выберите свой пользовательский API:  
![](./media/powerapps-register-custom-api/screencustomapi.png "Выбор пользовательского интерфейса API")
5. Выберите **Add data source** (Добавить источник данных).

После добавления источника данных вы сможете использовать свой интерфейс API в строке функций, текстовом поле и в других элементах. Например, вы можете начать вводить **MySampleWebAPI** в строке функций для просмотра доступных функций. Пример использования API-интерфейса Office 365 приведен в статье [Show data from Office 365][12] \(Отображение данных из Office 365).


## Совместное использование интерфейсов API
Пользовательские интерфейсы API также можно применять совместно. После добавления пользовательского API перейдите на вкладку **Connections** (Подключения), выберите **Custom APIs** (Пользовательские API), а затем щелкните значок общего доступа:

![](./media/powerapps-register-custom-api/sharecustomapi.png "Совместное использование интерфейса API")

> [AZURE.NOTE] Совместное использование интерфейсов API возможно только в пределах вашей организации.

## Квоты и регулирование

- В учетной записи PowerApps можно создать до пяти пользовательских интерфейсов API. Общие пользовательские интерфейсы API не учитываются в вашей квоте.
- Для каждого подключения, созданного для пользовательского интерфейса API, пользователи могут выполнять до 500 запросов в минуту.
- Имейте в виду, что при удалении пользовательского интерфейса API будут удалены все созданные подключения к этому интерфейсу API.

Свои вопросы или комментарии о пользовательских API-интерфейсах отправляйте по электронной почте [customapishelp@microsoft.com](mailto:customapishelp@microsoft.com).

<!--Reference links in article-->
[1]: https://github.com/OAI/OpenAPI-Specification/blob/master/versions/2.0.md#securityDefinitionsObject
[2]: https://developer.spotify.com/
[3]: https://developer.uber.com/
[4]: https://api.slack.com/
[5]: http://docs.rackspace.com/
[6]: http://swagger.io/getting-started/
[7]: https://github.com/OAI/OpenAPI-Specification/wiki/Hello-World-Sample
[8]: http://editor.swagger.io/#/
[9]: https://web.powerapps.com
[10]: https://powerapps.microsoft.com/tutorials/get-started-logic-flow/
[11]: https://powerapps.microsoft.com/tutorials/get-started-create-from-data/
[12]: https://powerapps.microsoft.com/tutorials/show-office-data/

<!-----HONumber=AcomDC_0713_2016-->