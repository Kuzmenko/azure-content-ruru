> [AZURE.SELECTOR]
- [Linux](../articles/iot-hub/iot-hub-linux-gateway-sdk-get-started.md)
- [Windows](../articles/iot-hub/iot-hub-windows-gateway-sdk-get-started.md)

В этой статье содержится пошаговое руководство по [примеру кода Hello World][lnk-helloworld-sample] и демонстрируются основные компоненты архитектуры [пакета SDK для шлюза IoT Azure ][lnk-gateway-sdk]. В примере пакет SDK для шлюза используется для сборки простого шлюза, который каждые пять секунд записывает в файл сообщение "hello world".

В этом руководстве рассматриваются следующие темы.

- **Основные понятия**: общие сведения о компонентах любого шлюза, созданного с использованием пакета SDK для шлюза.
- **Архитектура примера hello World**: описывает, каким образом основные понятия относятся к примеру Hello World и как компоненты работают вместе.
- **Сборка примера**: шаги, необходимые для сборки образца.
- **Запуск примера**: шаги, необходимые для запуска образца.
- **Типовые выходные данные**: пример выходных данных, ожидаемых при выполнении примера.
- **Фрагменты кода**: коллекция фрагментов кода, показывающая, каким образом пример Hello World реализует основные компоненты шлюза.

## Основные понятия пакета SDK для шлюза

Прежде чем изучать пример кода или создавать собственные поля шлюза с использованием пакета SDK для шлюза, необходимо изучить основные понятия, которые лежат в основе архитектуры пакета SDK.

### модули

Шлюз собирается с использованием пакета SDK для шлюза IoT Azure путем создания и сборки *модулей*. Модули обмениваются данным с помощью *сообщений*. Модуль получает сообщение, выполняет с ним определенное действие, при необходимости преобразует их в новое сообщение и публикует его для других модулей. Некоторые модули могут только создавать сообщения и никогда не обрабатывают входящие сообщения. Цепочка модулей создает конвейер обработки данных с каждым модулем, который выполняет преобразование данных в определенной точке этого конвейера.

![][1]
 
Пакет SDK содержит следующее:

- Предварительно написанные модули, которые выполняют общие функции шлюза.
- Интерфейсы, которые разработчик может использовать для написания пользовательских модулей.
- Инфраструктура, необходимая для развертывания и запуска набора модулей.

Пакет SDK включает слой абстракции, который позволяет собирать шлюзы для запуска в различных операционных системах и на разных платформах.

![][2]

### Сообщения

Функционирование шлюза удобно представлять как передачу сообщений между модулями, однако, это не совсем так. Модули используют брокер для связи друг с другом: они публикуют сообщения в брокер (шина, Pub/Sub или другая схема обмена сообщениями), после чего брокер направляет сообщения в модули, подключенные к нему.

Для публикации сообщения в брокер модули используют функцию **Broker\_Publish**. Брокер доставляет сообщения в модуль, вызывая функцию обратного вызова. Сообщение состоит из набора пар ключ-значение, а содержимое передается как блок памяти.

![][3]

### Маршрутизация и фильтрация сообщений

Сообщения направляются в нужные модули двумя способами. В брокер может передаваться набор ссылок, в котором для брокера указывается источник и приемник для каждого модуля, либо модуль может выполнять фильтрацию по свойствам сообщения. Модуль обрабатывает сообщение, только если оно предназначено для него. Ссылки и фильтрация сообщений позволяют создать эффективный конвейер сообщений.

## Архитектура примера Hello World

Пример Hello World иллюстрирует основные понятия, описанные в предыдущем разделе. Пример Hello World реализует шлюз с конвейером, который состоит из двух модулей:

-	Модуль *Hello World* создает сообщение каждые пять секунд и передает его в модуль ведения журнала.
-	Модуль *ведения журнала* записывает полученные сообщения в файл.

![][4]

Как описано в предыдущем разделе, модуль Hello World не передает сообщения непосредственно в модуль ведения журнала каждые пять секунд. Вместо этого он каждые пять секунд публикует сообщение в брокер.

Модуль ведения журнала получает сообщение из брокера и обрабатывают его, записывая содержимое сообщения в файл.

Модуль ведения журнала только обрабатывает сообщения из брокера и никогда не публикует сообщения в брокер.

![][5]

На представленной выше схеме показана архитектура примера Hello World и относительные пути к исходными файлам, которые реализуют различные части примера в [репозитории][lnk-gateway-sdk]. Изучите код самостоятельно или воспользуйтесь приведенными ниже фрагментами кода для справки.

<!-- Images -->
[1]: media/iot-hub-gateway-sdk-getstarted-selector/modules.png
[2]: media/iot-hub-gateway-sdk-getstarted-selector/modules_2.png
[3]: media/iot-hub-gateway-sdk-getstarted-selector/messages_1.png
[4]: media/iot-hub-gateway-sdk-getstarted-selector/high_level_architecture.png
[5]: media/iot-hub-gateway-sdk-getstarted-selector/detailed_architecture.png

<!-- Links -->
[lnk-helloworld-sample]: https://github.com/Azure/azure-iot-gateway-sdk/tree/master/samples/hello_world
[lnk-gateway-sdk]: https://github.com/Azure/azure-iot-gateway-sdk

<!---HONumber=AcomDC_0928_2016-->