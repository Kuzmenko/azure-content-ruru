# Azure и "Интернет вещей"

Добро пожаловать в Microsoft Azure и "Интернет вещей" (IoT). В этой статье рассматривается архитектура решения IoT, описывающая общие характеристики решения IoT, которое можно развернуть с помощью служб Azure. Для решений IoT требуется надежная двухсторонняя связь между устройствами (количество которых может исчисляться миллионами) и серверной частью решения, которое, например, может использовать прогнозную аналитику для анализа данных в потоке событий между устройством и облаком.

Центр IoT Azure является ключевым строительным блоком при реализации этой архитектуры решения IoT с помощью служб Azure. Набор IoT Suite предоставляет полные реализации этой архитектуры для определенных сценариев IoT. Например, решение для *удаленного мониторинга* позволяет отслеживать состояние таких устройств, как торговые автоматы. *Прогнозное обслуживание* помогает прогнозировать время обслуживания таких устройств, как насосы на удаленных насосных станциях, и избегать незапланированных простоев.

## Архитектура решения IoT

На приведенной ниже схеме показана архитектура типичного решения IoT. Обратите внимание, что она не содержит имен определенных служб Azure, а описывает ключевые элементы в архитектуре обобщенного решения IoT. В этой архитектуре устройства IoT собирают данные, которые отправляют в облачный шлюз. Облачный шлюз делает данные доступными для обработки другими службами серверной части. Данные из серверной части предоставляются другим бизнес-приложениям или операторам через панель мониторинга или другое устройство для представления данных.

![Архитектура решения IoT][img-solution-architecture]

> [AZURE.NOTE] Подробный обзор архитектуры IoT см. в документе [Microsoft Azure IoT Reference Architecture][lnk-refarch] \(Эталонная архитектура Microsoft Azure IoT).

### Взаимодействие устройств

В этой архитектуре решения IoT устройства отправляют данные телеметрии, например показания датчика с насосной станции, на конечную точку облака для хранения и обработки. В сценарии прогнозирования обслуживания серверная часть может использовать поток данных датчика, чтобы определить время обслуживания конкретного насоса. Устройства также могут принимать команды, передаваемые из облака на устройство, и отвечать на них путем считывания сообщений из конечной точки облака. Например, в сценарии прогнозирования обслуживания серверная часть может отправлять команды другим насосам на станции начинать перенаправление потоков непосредственно перед началом обслуживания. Благодаря этой подготовке инженер технической поддержки может приступать к работе сразу по приезде на станцию.

Одной из крупнейших задач, стоящих перед проектами IoT, является обеспечение надежного и безопасного подключения устройств к серверной части решения, чтобы устройства могли отправлять данные телеметрии и получать команды. Характеристики устройств IoT отличаются от характеристик других клиентов, таких как браузеры и мобильные приложения. Устройства IoT:

- часто представляют собой встраиваемые системы, у которых отсутствует оператор;
- могут развертываться в удаленных расположениях, где физический доступ слишком дорог;
- могут быть доступны только через серверную часть решения; другого способа взаимодействия с устройством нет.
- могут иметь ограниченную мощность и (или) объем ресурсов для обработки;
- могут иметь временное, медленное или дорогостоящее подключение к сети;
- могут требовать использования закрытых, пользовательских или отраслевых протоколов приложения;
- могут создаваться с помощью большого числа популярных аппаратных и программных платформ.

В дополнение к изложенным выше требованиям любое решение IoT также должно быть масштабируемым, безопасным и надежным. В итоге формируется набор требований к подключению, выполнить которые с помощью традиционных технологий, таких как веб-контейнеры и брокеры сообщений, очень трудно. Центр IoT Azure и пакеты SDK устройства IoT облегчают реализацию решений, соответствующих этим требованиям.

Устройство может взаимодействовать непосредственно с конечной точкой облачного шлюза или (если устройство не может использовать протоколы связи, поддерживаемые облачным шлюзом) подключаться через промежуточный шлюз, например [шлюз протокола центра IoT][lnk-protocol-gateway], выполняющий преобразование протоколов. Например, преобразование общего промышленного протокола (CIP) в AMQPS.

### Обработка данных и аналитика

Большая часть обработки данных в решении происходит в серверной части решения IoT в облаке. В частности, там выполняются фильтрация и статистическая обработка данных телеметрии и их маршрутизация к другим службам. Серверная часть решения IoT:

- Принимает данные телеметрии в необходимом объеме с устройств и определяет способ обработки и хранения полученных данных. 
- В некоторых случаях позволяет передавать команды из облака на определенное устройство.
- Предоставляет возможность регистрации устройств в решении IoT, позволяющей подготавливать их к работе и управлять доступом устройств к инфраструктуре.
- Позволяет отслеживать состояние устройств и отслеживать выполняемые ими операции.

В сценарии прогнозирования обслуживания серверная часть решения хранит данные журнала телеметрии, которые используются для определения шаблонов и анализа данных телеметрии по мере их поступления, чтобы выявить закономерности, которые указывают на необходимость обслуживания конкретного насоса.

Решения IoT могут включать в себя циклы автоматической обратной связи. Например, на основании данных телеметрии модуль аналитики в серверной части решения может выявить, что температура определенного устройства выше общего нормального уровня, и отправить на это устройство команду с инструкциями для выполнения корректирующих действий.

### Представление и бизнес-подключение

Уровень представления и бизнес-подключения позволяет конечным пользователям взаимодействовать с решением IoT и устройствами. Это дает пользователям возможность просматривать и анализировать данные, собираемые с их устройств. Эти представления могут принимать форму панелей мониторинга и отчетов бизнес-аналитики, которые могут отображаться как данные журнала или данные в режиме реального времени. Например, оператор может проверить состояние конкретной насосной станции и увидеть все предупреждения, созданные системой. Этот уровень также обеспечивает интеграцию серверной части решения IoT с существующими бизнес-приложениями для привязки к корпоративным бизнес-процессам или рабочим процессам. Например, решение прогнозного обслуживания может интегрироваться с системой планирования, резервирующей инженера, который должен посетить насосную станцию, когда решение определит, что насос нуждается в обслуживании.

![Панель мониторинга решения IoT][img-dashboard]

[img-solution-architecture]: ./media/iot-azure-and-iot/iot-reference-architecture.png
[img-dashboard]: ./media/iot-azure-and-iot/iot-suite.png

[lnk-machinelearning]: http://azure.microsoft.com/documentation/services/machine-learning/
[Azure IoT Suite]: http://azure.microsoft.com/solutions/iot
[lnk-protocol-gateway]: ../articles/iot-hub/iot-hub-protocol-gateway.md
[lnk-refarch]: http://download.microsoft.com/download/A/4/D/A4DAD253-BC21-41D3-B9D9-87D2AE6F0719/Microsoft_Azure_IoT_Reference_Architecture.pdf

<!---HONumber=AcomDC_0601_2016-->