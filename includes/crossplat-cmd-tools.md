#Использование средств командной строки Azure для Mac и Linux

В этом руководстве рассматривается, как использовать программы командной строки Mac и Linux для создания и управления службами в Azure. Рассмотрены следующие сценарии: **Установка средств**, **Импорт параметров публикации**, **Создание и управление веб-сайтами Azure** и **Создание и управление виртуальными машинами Azure**. Полную справочную документацию см. в разделе [Средства командной строки Azure для Mac и Linux][reference-docs].

##Оглавление
* [Программы командной строки Azure для Mac и Linux](#Overview)
* [Установка программ командной строки Azure для Mac и Linux](#Download)
* [Создание учетной записи Azure](#CreateAccount)
* [Скачивание и импорт параметров публикации](#Account)
* [Создание веб-сайта Azure и управление им](#WebSites)
* [Создание виртуальной машины Azure и управление ей](#VMs)


<h2><a id="Overview"></a>Программы командной строки Microsoft Azure для Mac и Linux</h2>

Программы командной строки Azure для Mac и Linux — это программы командной строки для развертывания служб Azure и управления ими.
 
Ниже перечислены поддерживаемые задачи:

* Импорт параметров публикации
* Создание нового веб-сайта Azure
* Создание и управление виртуальными машинами Azure.

Для получения полного списка поддерживаемых команд введите `azure -help` в командной строке после установки средств или обратитесь к [справочной документации][reference-docs].

<h2><a id="Download">Установка программ командной строки Azure для Mac и Linux</a></h2>

Следующий список содержит сведения по установке программ командной строки в зависимости от операционной системы:

* **Mac**: скачайте [установщик пакета SDK для Azure][mac-installer]. Откройте загруженный файл .pkg и выполните установку.

* **Linux**: установите последнюю версию [Node.js][nodejs-org] \(см. раздел [Установка Node.js через диспетчер пакетов][install-node-linux]), а затем выполните следующую команду:

		npm install azure-cli -g

	**Примечание**. Возможно, будет необходимо выполнить эту команду с повышенными привилегиями:

		sudo npm install azure-cli -g

* **Windows**: запустите установщик Windows (файл .msi), который доступен здесь: [Программы командной строки Microsoft Azure][windows-installer].


Чтобы проверить правильность установки, введите `azure` в командной строке. Если установка прошла успешно, вы увидите список всех доступных команд `azure`.

<h2>— <a id="CreateAccount"></a>Как создавать учетную запись хранения</h2>

Чтобы использовать программы командной строки Azure для Mac и Linux, будет необходима учетная запись Azure.

Откройте браузер, перейдите к [http://www.windowsazure.com][windowsazuredotcom] и щелкните **Бесплатное пробное использование** в правом верхнем углу.

![Веб-сайт Azure][Azure Web Site]

Следуйте инструкциям по созданию учетной записи.

<h2><a id="Account"></a>Загрузка и импорт параметров публикации</h2>

Чтобы начать работу, необходимо сначала загрузить и импортировать параметры публикации. Это позволит вам использовать средства для создания и управления службами Azure. Чтобы загрузить параметры публикации, используйте команду `account download`:

	azure account download

Откройте браузер по умолчанию и войдите на портал управления. После входа будет скачан файл `.publishsettings`. Запишите место сохранения этого файла.

Затем импортируйте файл `.publishsettings`. Для этого выполните следующую команду и замените параметр `{path to .publishsettings file}` на путь к файлу `.publishsettings`:

	azure account import {path to .publishsettings file}

Все сведения, сохраненные командой <code>import</code>, можно удалить с помощью команды <code>account clear</code>:

	azure account clear

Чтобы просмотреть список параметров для команд `account`, используйте параметр `-help`:

	azure account -help

После импорта параметров публикации необходимо удалить файл `.publishsettings` из соображений безопасности.

> [AZURE.NOTE]При импорте параметров публикации учетные данные для доступа к подписке Azure хранятся внутри папки `user`. Папка `user` защищена операционной системой. Тем не менее рекомендуется принять дополнительные меры для шифрования папки `user`. Это можно сделать одним из следующих способов:
> 
> - На Windows измените свойства папки или используйте BitLocker.
> - На Mac включите FileVault для папки.
> - В ОС Ubuntu используйте функцию каталога Encrypted Home. В других дистрибутивах Linux есть аналогичные функции.

Теперь можно приступать к созданию и управлению веб-сайтами Azure и виртуальными машинами Azure.

<h2><a id="WebSites"></a>Создание и управление веб-сайтом Azure</h2>

###Создание веб-сайта

Чтобы создать веб-сайт Azure, необходимо сначала создать пустой каталог с именем `MySite` и открыть его.

Затем выполните следующую команду:

	azure site create MySite --git

Вывод этой команды будет содержать URL-адрес по умолчанию созданного веб-сайта. Параметр `--git` позволяет использовать git для публикации на веб-сайте путем создания репозиториев git в каталоге локального приложения и центре данных веб-сайта. Обратите внимание, что если локальная папка уже является репозиторием git, команда добавит новый удаленный к существующему репозиторию, с указанием на репозиторий в центре обработки данных веб-сайта.

Обратите внимание, что команду `azure site create` можно выполнять с любыми из следующих параметров.

* `--location [location name]`. Этот параметр позволяет указать расположение центра обработки данных, в котором создается веб-сайт (например, "Запад США"). Если этот параметр опущен, появится запрос выбрать расположение.
* `--hostname [custom host name]`. Этот параметр позволяет задать пользовательское имя узла для веб-сайта.

Затем можно добавить содержимое в каталог веб-сайта. Используйте обычный поток git (`git add`, `git commit`) для фиксации комментария. Используйте следующую команду git для передачи контента веб-сайта на Azure:

	git push azure master

###Настройка публикации из GitHub

Чтобы настроить непрерывную публикацию из репозитория GitHub, используйте параметр `--GitHub` при создании сайта:

	auzre site create MySite --github --githubusername username --githubpassword password --githubrepository githubuser/reponame

Если у вас есть локальная копия репозитория GitHub или если репозиторий со ссылкой на один удаленный репозиторий GitHub, эта команда автоматически опубликует код в репозитории GitHub для веб-сайта. В дальнейшем любые изменения в репозитории GitHub автоматически публикуются на сайте.

При настройке публикации из GitHub ветвь по умолчанию является главной ветвью. Чтобы указать другую ветвь, выполните следующую команду из локального репозитория:

	azure site repository <branch name>

###Настройка параметров приложения

Параметры приложения являются парами "ключ/значение", доступными для приложения в среде выполнения. При установке для веб-сайта Azure значения параметров приложения переопределяют параметры с тем же ключом, который определен в файле Web.config сайта. Для приложений Node.js и PHP параметры приложений доступны как переменные среды. В следующем примере показано, как задать пару "ключ/значение":

	azure site config add <key>=<value> 

Чтобы просмотреть список всех пар "ключ/значение", используйте следующее:

	azure site config list 

Или если вы знаете ключ и желаете посмотреть, можете использовать:

	azure site config get <key> 

Чтобы изменить значение существующего ключа, необходимо сначала удалить существующий ключ и повторно добавить его. Команда "Очистить":

	azure site config clear <key> 

###Отображение сайтов

Чтобы просмотреть список веб-сайтов, введите следующую команду:

	azure site list

Чтобы получить подробные сведения о веб-сайте, используйте команду `site show`. В следующем примере отображаются сведения для `MySite`:

	azure site show MySite

###Остановка, запуск и перезапуск сайта

Остановить, запустить или перезапустить веб-сайт можно с помощью команд `site stop`, `site start` или `site restart`:

	azure site stop MySite
	azure site start MySite
	azure site restart MySite

###Удаление сайта

Сайт можно удалить с помощью команды `site delete`:

	azure site delete MySite

Обратите внимание, что при выполнении перечисленных выше команд в папке, где выполняется `site create`, указывать имя сайта `MySite` как последний параметр не нужно.

Чтобы просмотреть весь список команд `site`, используйте параметр `-help`:

	azure site -help 

<h2><a id="VMs"></a>Создание и управление виртуальной машиной Azure</h2>

Виртуальная машина Azure создается из образа виртуальной машины (VHD-файл), предоставленного пользователем или доступного в коллекции образов. Чтобы просмотреть доступные образы, используйте команду `vm image list`:

	azure vm image list

Виртуальную машину можно готовить и запускать из доступных образов с помощью команды `vm create`. В следующем примере показано, как создать виртуальную машину Linux (с именем `myVM`) из образа в коллекции (CentOS 6.2). Имя пользователя root и пароль для виртуальной машины: `myusername` и `Mypassw0rd`. (Обратите внимание что параметр `--location` указывает центр обработки данных, в котором создается виртуальная машина. Если параметр `--location` опущен, появится запрос выбрать расположение.)

	azure vm create myVM OpenLogic__OpenLogic-CentOS-62-20120509-ru-RU-30GB.vhd myusername --location "West US"

Вы можете передать флажок `--ssh` (Linux) или `--rdp` (Windows) `vm create`, чтобы включить удаленные подключения к новой виртуальной машине.

Если необходимо подготовить виртуальную машину из образа, можно создать образ из VHD-файла с помощью команды `vm image create`, то используйте команду `vm create` для подготовки виртуальной машины. В следующем примере показано, как создать образ Linux (с именем `myImage`) из локального VHD-файла. (Параметр `--location` указывает данные, в которых хранится образ.)

	azure vm image create myImage /path/to/myImage.vhd --os linux --location "West US"

Вместо создания образа из локального VHD-файла можно создать образ из VHD-файла, хранящегося в хранилище BLOB-объектов Azure. Это можно сделать с помощью параметра `blob-url`:

	azure vm image create myImage --blob-url <url to .vhd in Blob Storage> --os linux

После создания образа можно подготовить виртуальную машину из образа с помощью команды `vm create`. Эта команда создает виртуальную машину с именем `myVM` из ранее созданного образа (`myImage`).

	azure vm create myVM myImage myusername --location "West US"

После подготовки виртуальной машины можно создать конечные точки, чтобы разрешить удаленный доступ к виртуальной машине (например). В следующем примере команда `vm create endpoint` используется для открытия внешнего порта 22 и локального порта 22 на `myVM`:

	azure vm endpoint create myVM 22 22

Подробные сведения о виртуальной машине (включая IP-адрес, DNS-имя и сведения о конечной точке) можно получить с помощью команды `vm show`:

	azure vm show myVM

Для завершения работы, запуска или перезапуска виртуальной машины используйте одну из следующих команд:

	azure vm shutdown myVM
	azure vm start myVM
	azure vm restart myVM

И, наконец, чтобы удалить виртуальную машину, используйте команду `vm delete`:

	azure vm delete myVM

Для отображения полного списка команд для создания и управления виртуальными машинами используйте параметр `-h`:

	azure vm -h

<!-- IMAGES -->
[Azure Web Site]: ./media/crossplat-cmd-tools/freetrial.png

<!-- LINKS -->
[nodejs-org]: http://nodejs.org/
[install-node-linux]: https://github.com/joyent/node/wiki/Installing-Node.js-via-package-manager
[mac-installer]: http://go.microsoft.com/fwlink/?LinkId=252249
[windows-installer]: http://go.microsoft.com/fwlink/?LinkID=275464
[reference-docs]: http://go.microsoft.com/fwlink/?LinkId=252246
[windowsazuredotcom]: http://www.windowsazure.com

<!---HONumber=Oct15_HO3-->